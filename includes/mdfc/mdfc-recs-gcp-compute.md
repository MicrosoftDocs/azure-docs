---
author: elazark
ms.service: defender-for-cloud
ms.topic: include
ms.date: 11/09/2022
ms.author: elkrieger
ms.custom: generated
---

There are **26** GCP recommendations in this category.

|Recommendation |Description |Severity |
|---|---|---|
|[Compute Engine VMs should use the Container-Optimized OS](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/3e33004b-f0b8-488d-85ed-61336c7ad4ca) |This recommendation evaluates the config property of a node pool for the key-value pair, 'imageType': 'COS'. |Low |
|[Ensure 'Block Project-wide SSH keys' is enabled for VM instances](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/00f8a6a6-cf69-4c11-822e-3ebf4910e545) |It is recommended to use Instance specific SSH key(s) instead of using common/shared project-wide SSH key(s) to access Instances. <br />Project-wide SSH keys are stored in Compute/Project-meta-data. Project wide SSH keys can be used to login into all the instances within project. Using project-wide SSH keys eases the SSH key management but if compromised, poses the security risk which can impact all the instances within project. <br> It is recommended to use Instance specific SSH keys which can limit the attack surface if the SSH keys are compromised. |Medium |
|[Ensure Compute instances are launched with Shielded VM enabled](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/1a4b3b3a-7de9-4aa4-a29b-580d59b43f79) |To defend against against advanced threats and ensure that the boot loader and firmware on your VMs are signed and untampered, it is recommended that Compute instances are launched with Shielded VM enabled.<br>Shielded VMs are virtual machines (VMs) on Google Cloud Platform hardened by a set of security controls that help defend against rootkits and bootkits.<br>Shielded VM offers verifiable integrity of your Compute Engine VM instances, so you can be confident your instances haven't been compromised by boot- or kernel-level malware or rootkits.<br>Shielded VM's verifiable integrity is achieved through the use of Secure Boot, virtual trusted platform module (vTPM)-enabled Measured Boot, and integrity monitoring.<br>Shielded VM instances run firmware which is signed and verified using Google's Certificate Authority, ensuring that the instance's firmware is unmodified and establishing the root of trust for Secure Boot.<br>Integrity monitoring helps you understand and make decisions about the state of your VM instances and the Shielded VM vTPM enables Measured Boot by performing the measurements needed to create a known good boot baseline, called the integrity policy baseline.<br>The integrity policy baseline is used for comparison with measurements from subsequent VM boots to determine if anything has changed.<br>Secure Boot helps ensure that the system only runs authentic software by verifying the digital signature of all boot components, and halting the boot process if signature verification fails. |High |
|[Ensure 'Enable connecting to serial ports' is not enabled for VM Instance](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/7e060336-2c9e-4289-a2a6-8d301bad47bb) |Interacting with a serial port is often referred to as the serial console, which is similar to using a terminal window, in that input and output is entirely in text mode and there is no graphical interface or mouse support.<br>If you enable the interactive serial console on an instance, clients can attempt to connect to that instance from any IP address. Therefore interactive serial console support should be disabled.<br>A virtual machine instance has four virtual serial ports. Interacting with a serial port is similar to using a terminal window, in that input and output is entirely in text mode and there is no graphical interface or mouse support.<br>The instance's operating system, BIOS, and other system-level entities often write output to the serial ports, and can accept input such as commands or answers to prompts.<br>Typically, these system-level entities use the first serial port (port 1) and serial port 1 is often referred to as the serial console.<br>The interactive serial console does not support IP-based access restrictions such as IP allowlists. If you enable the interactive serial console on an instance, clients can attempt to connect to that instance from any IP address.<br>This allows anybody to connect to that instance if they know the correct SSH key, username, project ID, zone, and instance name.<br>Therefore interactive serial console support should be disabled. |Medium |
|[Ensure 'log_duration' database flag for Cloud SQL PostgreSQL instance is set to 'on'](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/272820a7-06ce-44b3-8318-4ec1f82237dc) |Enabling the log_hostname setting causes the duration of each completed statement to be logged.<br> This does not logs the text of the query and thus behaves different from the log_min_duration_statement flag.<br> This parameter cannot be changed after session start.<br> Monitoring the time taken to execute the queries can be crucial in identifying any resource hogging queries and assessing the performance of the server.<br> Further steps such as load balancing and use of optimized queries can be taken to ensure the performance and stability of the server.<br> This recommendation is applicable to PostgreSQL database instances. |Low |
|[Ensure 'log_executor_stats' database flag for Cloud SQL PostgreSQL instance is set to 'off'](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/19711549-76eb-4f1f-b43b-b1048e66c1f0) |The PostgreSQL executor is responsible to execute the plan handed over by the PostgreSQL planner.<br> The executor processes the plan recursively to extract the required set of rows.<br> The "log_executor_stats" flag controls the inclusion of PostgreSQL executor performance statistics in the PostgreSQL logs for each query.<br> The "log_executor_stats" flag enables a crude profiling method for logging PostgreSQL executor performance statistics which even though can be useful for troubleshooting, it may increase the amount of logs significantly and have performance overhead.<br> This recommendation is applicable to PostgreSQL database instances.<br>  |Low |
|[Ensure 'log_min_error_statement' database flag for Cloud SQL PostgreSQL instance is set to 'Error' or stricter](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/50a1058e-925b-4998-9d93-5eaa8f7021a3) |The "log_min_error_statement" flag defines the minimum message severity level that are considered as an error statement.<br> Messages for error statements are logged with the SQL statement.<br> Valid values include "DEBUG5", "DEBUG4", "DEBUG3", "DEBUG2", "DEBUG1", "INFO", "NOTICE", "WARNING", "ERROR", "LOG", "FATAL", and "PANIC".<br> Each severity level includes the subsequent levels mentioned above.<br> Ensure a value of ERROR or stricter is set.<br> Auditing helps in troubleshooting operational problems and also permits forensic analysis.<br> If "log_min_error_statement" is not set to the correct value, messages may not be classified as error messages appropriately.<br> Considering general log messages as error messages would make is difficult to find actual errors and considering only stricter severity levels as error messages may skip actual errors to log their SQL statements.<br> The "log_min_error_statement" flag should be set to "ERROR" or stricter.<br> This recommendation is applicable to PostgreSQL database instances.  |Low |
|[Ensure 'log_parser_stats' database flag for Cloud SQL PostgreSQL instance is set to 'off'](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/a6efc275-b1c1-4003-8e85-2f30b2eb56e6) |The PostgreSQL planner/optimizer is responsible to parse and verify the syntax of each query received by the server.<br> If the syntax is correct a "parse tree" is built up else an error is generated.<br> The "log_parser_stats" flag controls the inclusion of parser performance statistics in the PostgreSQL logs for each query.<br> The "log_parser_stats" flag enables a crude profiling method for logging parser performance statistics which even though can be useful for troubleshooting, it may increase the amount of logs significantly and have performance overhead.<br> This recommendation is applicable to PostgreSQL database instances.<br>  |Low |
|[Ensure 'log_planner_stats' database flag for Cloud SQL PostgreSQL instance is set to 'off'](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/7d87879a-d498-4e61-b552-b34463f87f83) |The same SQL query can be excuted in multiple ways and still produce different results.<br> The PostgreSQL planner/optimizer is responsible to create an optimal execution plan for each query.<br> The "log_planner_stats" flag controls the inclusion of PostgreSQL planner performance statistics in the PostgreSQL logs for each query.<br> The "log_planner_stats" flag enables a crude profiling method for logging PostgreSQL planner performance statistics which even though can be useful for troubleshooting, it may increase the amount of logs significantly and have performance overhead.<br> This recommendation is applicable to PostgreSQL database instances. |Low |
|[Ensure 'log_statement_stats' database flag for Cloud SQL PostgreSQL instance is set to 'off'](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/c36e73b7-ee30-4684-a1ad-2b878d2b10bf) |The "log_statement_stats" flag controls the inclusion of end to end performance statistics of a SQL query in the PostgreSQL logs for each query.<br> This cannot be enabled with other module statistics ("log_parser_stats", "log_planner_stats", "log_executor_stats").<br> The "log_statement_stats" flag enables a crude profiling method for logging end to end performance statistics of a SQL query.<br> This can be useful for troubleshooting but may increase the amount of logs significantly and have performance overhead.<br> This recommendation is applicable to PostgreSQL database instances.<br>  |Low |
|[Ensure that Compute instances do not have public IP addresses](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/8bdd13ad-a9d2-4910-8b06-9c4cddb55abb) |Compute instances should not be configured to have external IP addresses.<br>To reduce your attack surface, Compute instances should not have public IP addresses. Instead, instances should be configured behind load balancers, to minimize the instance's exposure to the internet.<br>Instances created by GKE should be excluded because some of them have external IP addresses and cannot be changed by editing the instance settings.<br>These VMs have names that start with "gke-" and are labeled "goog-gke-node". |High |
|[Ensure that instances are not configured to use the default service account](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/a107c44c-75e4-4607-b1b0-cd5cfcf249e0) |It is recommended to configure your instance to not use the default Compute Engine service account because it has the Editor role on the project.<br>The default Compute Engine service account has the Editor role on the project, which allows read and write access to most Google Cloud Services.<br>To defend against privilege escalations if your VM is compromised and prevent an attacker from gaining access to all of your project, it is recommended to not use the default Compute Engine service account.<br>Instead, you should create a new service account and assigning only the permissions needed by your instance.<br>The default Compute Engine service account is named <code>[PROJECT_NUMBER]- compute@developer.gserviceaccount.com.</code><br>VMs created by GKE should be excluded. These VMs have names that start with "gke-" and are labeled "goog-gke-node". |High |
|[Ensure that instances are not configured to use the default service account with full access to all Cloud APIs](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/a8c1fcf1-ca66-4fc1-b5e6-51d7f4f76782) |To support principle of least privileges and prevent potential privilege escalation it is recommended that instances are not assigned to default service account "Compute Engine default service account" with Scope "Allow full access to all Cloud APIs".<br>Along with ability to optionally create, manage and use user managed custom service accounts, Google Compute Engine provides default service account "Compute Engine default service account" for an instances to access necessary cloud services.<br>"Project Editor" role is assigned to "Compute Engine default service account" hence, This service account has almost all capabilities over all cloud services except billing.<br>However, when "Compute Engine default service account" assigned to an instance it can operate in 3 scopes.<br>1. Allow default access: Allows only minimum access required to run an Instance (Least Privileges) 2. Allow full access to all Cloud APIs: Allow full access to all the cloud APIs/Services (Too much access) 3. Set access for each API: Allows Instance administrator to choose only those APIs that are needed to perform specific business functionality expected by instance<br>When an instance is configured with "Compute Engine default service account" with Scope "Allow full access to all Cloud APIs", based on IAM roles assigned to the user(s) accessing Instance,<br>it may allow user to perform cloud operations/API calls that user is not supposed to perform leading to successful privilege escalation.<br>VMs created by GKE should be excluded. These VMs have names that start with "gke-" and are labeled "goog-gke-node". |Medium |
|[Ensure that IP forwarding is not enabled on Instances](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/0ba588a6-4539-4e67-bc62-d7b2b51300fb) |Compute Engine instance cannot forward a packet unless the source IP address of the packet matches the IP address of the instance. Similarly, GCP won't deliver a packet whose destination IP address is different than the IP address of the instance receiving the packet. <br> However, both capabilities are required if you want to use instances to help route packets.<br />Forwarding of data packets should be disabled to prevent data loss or information disclosure. <br />Compute Engine instance cannot forward a packet unless the source IP address of the packet matches the IP address of the instance. Similarly, GCP won't deliver a packet whose destination IP address is different than the IP address of the instance receiving the packet. <br> However, both capabilities are required if you want to use instances to help route packets. To enable this source and destination IP check, disable the canIpForward field, which allows an instance to send and receive packets with non-matching destination or source IPs. |Medium |
|[Ensure that the 'log_checkpoints' database flag for Cloud SQL PostgreSQL instance is set to 'on'](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/a2404629-0132-4ab3-839e-8389dbe9fe98) |Ensure that the log_checkpoints database flag for the Cloud SQL PostgreSQL instance is set to on.<br />Enabling log_checkpoints causes checkpoints and restart points to be logged in the server log. Some statistics are included in the log messages, including the number of buffers written and the time spent writing them. <br /> This parameter can only be set in the postgresql.conf file or on the server command line. This recommendation is applicable to PostgreSQL database instances. |Low |
|[Ensure that the 'log_lock_waits' database flag for Cloud SQL PostgreSQL instance is set to 'on'](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/8191f530-fde7-4177-827a-43ce0f69ffe7) |Enabling the "log_lock_waits" flag for a PostgreSQL instance creates a log for any session waits that take longer than the alloted "deadlock_timeout" time to acquire a lock. <br> The deadlock timeout defines the time to wait on a lock before checking for any conditions. Frequent run overs on deadlock timeout can be an indication of an underlying issue. <br> Logging such waits on locks by enabling the log_lock_waits flag can be used to identify poor performance due to locking delays or if a specially-crafted SQL is attempting to starve resources through holding locks for excessive amounts of time. <br> This recommendation is applicable to PostgreSQL database instances. |Low |
|[Ensure that the 'log_min_duration_statement' database flag for Cloud SQL PostgreSQL instance is set to '-1'](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/1c9e237b-419f-4e73-b43a-94b5863dd73e) |The "log_min_duration_statement" flag defines the minimum amount of execution time of a statement in milliseconds where the total duration of the statement is logged. Ensure that "log_min_duration_statement" is disabled, i.e., a value of -1 is set. <br> Logging SQL statements may include sensitive information that should not be recorded in logs. This recommendation is applicable to PostgreSQL database instances. |Low |
|[Ensure that the 'log_min_messages' database flag for Cloud SQL PostgreSQL instance is set appropriately](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/492fed4e-1871-4c12-948d-074ee0f07559) |The "log_min_error_statement" flag defines the minimum message severity level that is considered as an error statement. <br> Messages for error statements are logged with the SQL statement. <br> Valid values include "DEBUG5", "DEBUG4", "DEBUG3", "DEBUG2", "DEBUG1", "INFO", "NOTICE", "WARNING", "ERROR", "LOG", "FATAL", and "PANIC". <br> Each severity level includes the subsequent levels mentioned above. <br> Note: To effectively turn off logging failing statements, set this parameter to PANIC. <br> ERROR is considered the best practice setting. Changes should only be made in accordance with the organization's logging policy. <br>Auditing helps in troubleshooting operational problems and also permits forensic analysis. <br> If "log_min_error_statement" is not set to the correct value, messages may not be classified as error messages appropriately. <br> Considering general log messages as error messages would make it difficult to find actual errors, while considering only stricter severity levels as error messages may skip actual errors to log their SQL statements. <br> The "log_min_error_statement" flag should be set in accordance with the organization's logging policy. <br> This recommendation is applicable to PostgreSQL database instances. |Low |
|[Ensure that the 'log_temp_files' database flag for Cloud SQL PostgreSQL instance is set to '0' ](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/29622fc0-14dc-4d65-a5a8-e9a39ffc4b62) |PostgreSQL can create a temporary file for actions such as sorting, hashing and temporary query results when these operations exceed "work_mem". <br> The "log_temp_files" flag controls logging names and the file size when it is deleted. <br> Configuring "log_temp_files" to 0 causes all temporary file information to be logged, while positive values log only files whose size is greater than or equal to the specified number of kilobytes. <br> A value of "-1" disables temporary file information logging. <br> If all temporary files are not logged, it may be more difficult to identify potential performance issues that may be due to either poor application coding or deliberate resource starvation attempts. |Low |
|[Ensure VM disks for critical VMs are encrypted with Customer-Supplied Encryption Key](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/6ca40f30-2508-4c90-85b6-36564b909364) |Customer-Supplied Encryption Keys (CSEK) are a feature in Google Cloud Storage and Google Compute Engine.<br> If you supply your own encryption keys, Google uses your key to protect the Google-generated keys used to encrypt and decrypt your data.<br> By default, Google Compute Engine encrypts all data at rest.<br> Compute Engine handles and manages this encryption for you without any additional actions on your part.<br> However, if you wanted to control and manage this encryption yourself, you can provide your own encryption keys.<br>By default, Google Compute Engine encrypts all data at rest. Compute Engine handles and manages this encryption for you without any additional actions on your part. <br>However, if you wanted to control and manage this encryption yourself, you can provide your own encryption keys.<br>If you provide your own encryption keys, Compute Engine uses your key to protect the Google-generated keys used to encrypt and decrypt your data. <br>Only users who can provide the correct key can use resources protected by a customer-supplied encryption key.<br>Google does not store your keys on its servers and cannot access your protected data unless you provide the key. <br>This also means that if you forget or lose your key, there is no way for Google to recover the key or to recover any data encrypted with the lost key.<br>At least business critical VMs should have VM disks encrypted with CSEK. |Medium |
|[GCP projects should have Azure Arc auto provisioning enabled](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/1716d754-8d50-4b90-87b6-0404cad9b4e3) |For full visibility of the security content from Microsoft Defender for servers, GCP VM instances should be connected to Azure Arc. To ensure that all eligible VM instances automatically receive Azure Arc, enable auto-provisioning from Defender for Cloud at the GCP project level. Learn more about [Azure Arc](/azure/azure-arc/servers/overview), and [Microsoft Defender for Servers](/azure/security-center/defender-for-servers-introduction). |High |
|[GCP VM instances should be connected to Azure Arc](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/9bbe2f0f-d6c6-48e8-b4d0-cf25d2c50206) |Connect your GCP Virtual Machines to Azure Arc in order to have full visibility to Microsoft Defender for Servers security content. Learn more about [Azure Arc](/azure/azure-arc/), and about [Microsoft Defender for Servers](/azure/security-center/defender-for-servers-introduction) on hybrid-cloud environment. |High |
|[GCP VM instances should have OS config agent installed](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/20622d8c-2a4f-4a03-9896-a5f2f7ede717) |To receive the full Defender for Servers capabilities using Azure Arc auto-provisioning, GCP VMs should have OS config agent enabled |High |
|[GKE cluster's auto repair feature should be enabled](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/6aeb69dc-0d01-4228-88e9-7e610891d5dd) |This recommendation evaluates the management property of a node pool for the key-value pair, 'key': 'autoRepair', 'value': true. |Medium |
|[GKE cluster's auto upgrade feature should be enabled](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/1680e053-2e9b-4e77-a1c7-793ae286155e) |This recommendation evaluates the management property of a node pool for the key-value pair, 'key': 'autoUpgrade', 'value': true. |High |
|[Monitoring on GKE clusters should be enabled](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/6a7b7361-5100-4a8c-b23e-f712d7dad39b) |This recommendation evaluates whether the monitoringService property of a cluster contains the location Cloud Monitoring should use to write metrics. |Medium |
|||
