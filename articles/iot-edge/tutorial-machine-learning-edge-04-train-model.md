---
title: 'Tutorial: Train and deploy a model - Machine Learning on Azure IoT Edge'
description: 'In this tutorial, you will train a machine learning model using Azure Machine Learning and then package the model as a container image that can be deployed as an Azure IoT Edge Module.'
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 1/22/2020
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
---

# Tutorial: Train and deploy an Azure Machine Learning model

> [!NOTE]
> This article is part of a series for a tutorial about using Azure Machine Learning on IoT Edge. If you have arrived at this article directly, we encourage you to begin with the [first article](tutorial-machine-learning-edge-01-intro.md) in the series for the best results.

In this article, we use Azure Notebooks first to train a machine learning model using Azure Machine Learning, and then package that model as a container image to deploy as an Azure IoT Edge Module. The Azure Notebooks take advantage of an Azure Machine Learning workspace, which is a foundational block used to experiment, train, and deploy machine learning models.

The steps in this article might be typically performed by data scientists.

## Set up Azure Notebooks

We use Azure Notebooks to host the two Jupyter Notebooks and supporting files. Here we create and configure an Azure Notebooks project. If you have not used Jupyter and/or Azure Notebooks, here are a couple of introductory documents:

* **Quickstart:** [Create and share a notebook](../notebooks/quickstart-create-share-jupyter-notebook.md)
* **Tutorial:** [Create and run a Jupyter notebook with Python](../notebooks/tutorial-create-run-jupyter-notebook.md)

Using Azure notebooks ensures a consistent environment for the exercise.

> [!NOTE]
> Once set up, the Azure Notebooks service can be accessed from any machine. During setup, you should use the development VM, which has all of the files that you will need.

### Create an Azure Notebooks account

To use Azure Notebooks, you need to create an account. Azure Notebook accounts are independent from Azure subscriptions.

1. Navigate to [Azure notebooks](https://notebooks.azure.com).

1. Click **Sign In** in the upper right corner of the page.

1. Sign in with either your work or school account (Azure Active Directory) or your personal account (Microsoft Account).

1. If you have not used Azure Notebooks before, you will be prompted to grant access for the Azure Notebooks app.

1. Create a user ID for Azure Notebooks.

### Upload Jupyter notebook files

We will uploaded sample notebook files into a new Azure Notebooks project.

1. From the user page of your new account, select **My Projects** from the top menu bar.

1. On the **Create New Project** dialog  box, provide a **Project Name** that also automatically forms the **Project ID**.

1. Leave **Public** and **README** unchecked as there is no need for the project to be public or to have a readme.

1. Select **Create**.

1. Select **Upload** (the up arrow icon) and choose **From Computer**.

1. Select **Choose files**.

1. Navigate to **C:\source\IoTEdgeAndMlSample\AzureNotebooks**. Select all the files in the list and click **Open**.

1. Select **Upload** to begin uploading and then select **Done** once the process is complete.

### Azure notebook files

Let's review the files you uploaded into your Azure Notebooks project. The activities in this portion of the tutorial span across two notebook files and a few supporting files.

* **01-turbofan\_regression.ipynb:** This notebook uses the Machine Learning service workspace to create and run a machine learning experiment. Broadly, the notebook performs the following steps:

  1. Downloads data from the Azure storage account that was generated by the device harness.
  1. Explores and prepare data for training and the classifier ad model.
  1. Evaluate the model from the experiment using a test dataset (Test\_FD003.txt).
  1. Publishes the best classifier model to the Machine Learning service workspace.

* **02-turbofan\_deploy\_model.ipynb:** This notebook takes the model created in the previous notebook and uses it to create a container image ready to be deployed to an Azure IoT Edge device. The notebook performs the following steps:

  1. Creates a scoring script for the model.
  1. Produces a container image using the classifier model that was saved in the Machine Learning service workspace.
  1. Deploys the image as a web service on Azure Container Instance.
  1. Uses the web service to validate the model and the image work as expected. The validated image will be deployed to our IoT Edge device in the [Create and deploy custom IoT Edge modules](tutorial-machine-learning-edge-06-custom-modules.md) portion of this tutorial.

* **Test\_FD003.txt:** This file contains the data we will use as our test set when validating our trained classifier. We chose to use the test data as provided for the original contest as our test set for simplicity of the example.

* **RUL\_FD003.txt:** This file contains the RUL for the last cycle of each device in the Test\_FD003.txt file. See the readme.txt and the Damage Propagation Modeling.pdf files in the C:\\source\\IoTEdgeAndMlSample\\data\\Turbofan for a detailed explanation of the data.

* **Utils.py:** Contains a set of Python utility functions for working with data. The first notebook contains a detailed explanation of the functions.

* **README.md:** Readme describing the use of the notebooks.  

## Run Azure Notebooks

Now that the project is created, run the **01-turbofan\_regression.ipynb** notebook.

1. From your project page, select **01-turbofan\_regression.ipynb**.

    ![Select first notebook to run](media/tutorial-machine-learning-edge-04-train-model/select-turbofan-regression-notebook.png)

2. If prompted, choose the Python 3.6 Kernel from the dialog and select **Set Kernel**.

3. If the notebook is listed as **Not Trusted**, click on the **Not Trusted** widget in the top right of the notebook. When the dialog comes up, select **Trust**.

4. Follow the instructions in the notebook.

    * `Ctrl + Enter` runs a cell.
    * `Shift + Enter` runs a cell and navigates to the next cell.
    * When a cell is running, it has an asterisk between the square brackets, like **[\*]**. When it is complete, the asterisk will be replaced with a number and relevant output may be appear below. Since cells often build on the work of the previous ones, only one cell can run at a time.

5. When you have finished running the **01-turbofan\_regression.ipynb** notebook, return to the project page.

6. Open **02-turbofan\_deploy\_model.ipynb** and repeat the steps in this section to run the second notebook.

## Next steps

In this article, we used two Jupyter Notebooks running in Azure Notebooks to use the data from the turbofan devices to train a remaining useful life (RUL) classifier, to save the classifier as a model, to create a container image, and to deploy and test the image as a web service.

Continue to the next article to create an IoT Edge device.

> [!div class="nextstepaction"]
> [Configure an IoT Edge device](tutorial-machine-learning-edge-05-configure-edge-device.md)
