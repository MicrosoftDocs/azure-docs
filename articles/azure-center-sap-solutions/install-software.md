---
title: Install SAP software (preview)
description: Learn how to install software on your SAP system created using Azure Center for SAP solutions (ACSS).
ms.service: azure-center-sap-solutions
ms.topic: how-to
ms.date: 07/01/2022
author: lauradolan
ms.author: ladolan
---

# Install SAP software (preview)

[!INCLUDE [Preview content notice](./includes/preview.md)]

After you've created infrastructure for your new SAP system using Azure Center for SAP solutions (ACSS), you can download and install the SAP software. After you [set up an Azure Storage account](#set-up-storage-account), you can [download the SAP media](#download-sap-media) using a shell script. Then, you can [install the software through the Azure portal wizard](#install-software).

## Prerequisites

- An Azure subscription.
- An Azure account with **Contributor** and **User Access Administrator** role access to the subscriptions and resource groups in which the VIS exists.
- A [network set up for your infrastructure deployment](create-network.md).
- A deployment of S/4HANA infrastructure.
- The username and password for the SAP system that you created.
- An [installation of the Azure Command-Line Interface (Azure CLI)](/cli/azure/install-azure-cli) on your local computer.

## Supported software

ACSS supports the following SAP software version: **S/4HANA 1909 SPS 03**.

ACSS supports the following operating system (OS) software versions:

| Publisher | Version | Generation SKU | Patch version name |
| --------- | ------- | -------------- | ------------------ |
| Red Hat | RHEL-SAP-HA (8.2 HA Pack) | 82sapha-gen2 | 8.2.2021091202 |
| Red Hat | RHEL-SAP-HA (8.4 HA Pack) | 84sapha-gen2 | 8.4.2021091202 |
| SUSE | sles-sap-15-sp3 | gen2 | 2022.01.26 |
| SUSE | sles-sap-12-sp4 | gen2 | 2022.02.01 

## Required components

The following components are necessary for the SAP installation:

- SAP software installation media (part of the `sapbits` container described later in this article)
    - All essential SAP packages (*SWPM*, *SAPCAR*, etc.)
    - SAP software (for example, *4 HANA 1909 SPS 03*)
- Supporting software packages for the installation process
    - `pip3` version `pip-21.3.1.tar.gz`
    - `wheel` version 0.37.1
    - `jq` version 1.6
    - `ansible` version 2.9.27
    - `zip`
- The SAP Bill of Materials (BOM), as generated by ACSS. These YAML files list all required SAP packages for the SAP software installation. There's a main BOM (`S41909SPS03_v0011ms.yaml`) and dependent BOMs (`HANA_2_00_059_v0002ms.yaml`, `SUM20SP13_latest.yaml`, `SWPM20SP11_latest.yaml`). They provide the following information:
    - The full name of the SAP package (`name`)
    - The package name with its file extension as downloaded (`archive`)
    - The checksum of the package as specified by SAP (`checksum`)
    - The shortened filename of the package (`filename`)
    - The SAP URL to download the software (`url`)
- Template or INI files, which are stack XML files required to run the SAP packages.

## Set up storage account

Before you can download the software, set up an Azure Storage account for the downloads.

1. [Create an Ubuntu 20.04 VM in Azure](/cli/azure/install-azure-cli-linux?pivots=apt).

1. Sign in to the VM.

1. Install the Azure CLI on the VM.

    ```bash
    curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
    ```

1. [Update the Azure CLI](/cli/azure/update-azure-cli) to version 2.30.0 or higher.

1. Install the following packages:

    - `pip3` version `pip-21.3.1.tar.gz`
    - `wheel` version 0.37.1
    - `jq` version 1.6
    - `ansible` version 2.9.27
    - `zip`

1. Sign in to Azure:

    ```azurecli
    az login
    ```

1. [Create an Azure Storage account through the Azure portal](../storage/common/storage-account-create.md). Make sure to create the storage account in the same subscription as your SAP system infrastructure.

1. Create a container within the Azure Storage account named `sapbits`.

    1. On the storage account's sidebar menu, select **Containers** under **Data storage**.

    1. Select **+ Container**.

    1. On the **New container** pane, for **Name**, enter `sapbits`.

    1. Select **Create**.

1. Download the following shell script for the deployer VM packages.

    ```azurecli
    wget "https://raw.githubusercontent.com/Azure/ACSS-preview/main/Installation%20Script/DownloadDeployerVMPackages.sh" -O "DownloadDeployerVMPackages.sh"
    ```

1. Update the shell script's file permissions.

    ```azurecli
    chmod +x DownloadDeployerVMPackages.sh
    ```

1. Run the shell script.

    ```azurecli
    ./DownloadDeployerVMPackages.sh
    ```

1. When asked if you have a storage account, enter `Y`.

1. When asked for the base path to the SAP storage account, enter the container path. To find the container path:
    
    1. Find the storage account that you created in the Azure portal.

    1. Find the container named `sapbits`.

    1. On the container's sidebar menu, select **Properties** under **Settings**.

    1. Copy down the **URL** value. The format is `https://<your-storage-account>.blob.core.windows.net/sapbits`.

1. In the Azure CLI, when asked for the access key, enter your storage account's key. To find the storage account's key:

    1. Find the storage account in the Azure portal.

    1. On the storage account's sidebar menu, select **Access keys** under **Security + networking**.

    1. For **key1**, select **Show key and connection string**.

    1. Copy the **Key** value.

1. In the Azure portal, find the container named `sapbits` in the storage account that you created.

1. Make sure the deployer VM packages are now visible in `sapbits`.

    1. Find the storage account that you created in the Azure portal.

    1. Find the container named `sapbits`.

    1. On the **Overview** page for `sapbits`, look for a folder named **deployervmpackages**.

### Download SAP media

After setting up your Azure Storage account, you can download the SAP installation media required to install the SAP software.

1. Sign in to the Ubuntu VM that you created in the [previous section](#set-up-storage-account).

1. Clone the SAP automation repository from GitHub.

    ```azurecli
    git clone https://github.com/Azure/sap-automation.git
    ```

1. Generate a shared access signature (SAS) token for the `sapbits` container.

    1. In the Azure portal, open the Azure Storage account.
    
    1. Open the `sapbits` container.

    1. On the container's sidebar menu, select **Shared access signature** under **Security + networking**.

    1. On the SAS page, under **Allowed resource types**, select **Container**.

    1. Configure other settings as necessary.

    1. Select **Generate SAS and connection string**.

    1. Copy the **SAS token** value. Make sure to copy the `?` prefix with the token.

1. Run the Ansible script **playbook_bom_download** with your own information.

    - For `<username>`, use your SAP username.
    - For `<password>`, use your SAP password. 
    - For `<storageAccountAccessKey>`, use your storage account's access key. You found this value in the [previous section](#set-up-storage-account). 
    - For `<containerBasePath>`, use the path to your `sapbits` container. You found this value in the [previous section](#set-up-storage-account). 
    - For `<containerSasToken>`, enter the SAS token that you generated in the previous step for `sapbits`.

    ```azurecli
    ansible-playbook ./sap-automation/deploy/ansible/playbook_bom_downloader.yaml -e "bom_base_name=S41909SPS03_v0011ms" -e "deployer_kv_name=abcd" -e "s_user=<username>" -e "s_password=<password>" -e "sapbits_access_key=<storageAccountAccessKey>" -e "sapbits_location_base_path=<containerBasePath>" -e "sapbits_sas_token=<containerSasToken>" 
    ```

##  Install software

To install the SAP software on Azure, use the ACSS installation wizard.

1. Sign in to the [Azure portal](https://portal.azure.com).

1. Search for and select **Virtual Instance for SAP solutions**.

1. Select your Virtual Instance for SAP (VIS) instance.

1. On the **Overview** page for the VIS resource, select **Install SAP software**.

1. In the **Prerequisites** tab of the wizard, review the prerequisites. Then, select **Next**.

1. On the **Software** tab, provide information about your SAP media.

    1. For **Have you uploaded the software to an Azure storage account?**, select **Yes**.

    1. For **Software version**, use the default **SAP S/4 HANA 1909 SPS03**.

    1. For **BOM directory location**, select **Browse** and find the path to your BOM file. For example, `/sapfiles/boms/S41909SPS03_v0010ms.yaml`.

    1. For **SAP FQDN:**, provide a fully qualified domain name (FQDN) for your SAP system. For example, `sap.contoso.com`.

    1. For High Availability (HA) systems only, enter the client identifier for the SONITH Fencing Agent service principal for **Fencing client ID**.

    1. For High Availability (HA) systems only, enter the password for the SONITH Fencing Agent service principal for **Fencing client password**.

    1. For **SSH private key**, provide the SSH private key that you created or selected as part of your infrastructure deployment.

    1. Select **Next**.

1. On the **Review + install** tab, review the software settings. 

1. Select **Install** to proceed with installation. 

1. Wait for the installation to complete. The process takes approximately three hours. You can see the progress, along with estimated times for each step, in the wizard.

1. After the installation completes, sign in with your SAP system credentials.

## Limitations

The following are known limitations and issues.

### SAP package versions

When SAP changes the version of packages for a component in the BOM, you might encounter problems with the automated installation shell script. It's recommended to download your SAP installation media as soon as possible to avoid issues.

If you encounter this problem, follow these steps: 

1. Download a new valid package from the SAP software downloads page.

1. Upload the new package in the `archives` folder of your Azure Storage account.

1. Update the following contents in the BOM file(s) that reference the updated component.

    - `name` to the new package name
    - `archive` to the new package name and extension
    - `checksum` to the new checksum
    - `filename` to the new shortened package name
    - `permissions` to `0755`
    - `url` to the new SAP download URL

1. Reupload the BOM file(s) in the `boms` folder of the storage account.

## Next steps

- [Create network for infrastructure deployment](create-network.md)
