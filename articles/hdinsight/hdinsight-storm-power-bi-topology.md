<properties
 pageTitle="Use Apache Storm with Power BI | Microsoft Azure"
 description="Create a Power BI report using data from a C# topology running on an Apache Storm cluster in HDInsight."
 services="hdinsight"
 documentationCenter=""
 authors="Blackmist"
 manager="paulettm"
 editor="cgronlun"
	tags="azure-portal"/>

<tags
 ms.service="hdinsight"
 ms.devlang="dotnet"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="big-data"
 ms.date="05/27/2016"
 ms.author="larryfr"/>

# Use Power BI to visualize data from an Apache Storm topology

Power BI allows you to visually display data as reports. Using the Visual Studio templates for Storm on HDInsight, you can easily use store data from a topology running on an Apache Storm on HDInsight cluster into SQL Azure, and then visualize the data using Power BI.

In this document, you will learn how to use Power BI to create a report from data generated by an Apache Storm topology and stored in Azure SQL Database.

## Prerequisites

- An Azure subscription. See [Get Azure free trial](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/).

* An Azure Active Directory user with [Power BI](https://powerbi.com) access

* Visual Studio (one of the following versions)

    * Visual Studio 2012 with [update 4](http://www.microsoft.com/download/details.aspx?id=39305)

    * Visual Studio 2013 with [update 4](http://www.microsoft.com/download/details.aspx?id=44921) or [Visual Studio 2013 Community](http://go.microsoft.com/fwlink/?linkid=517284&clcid=0x409)

    * [Visual Studio 2015](https://www.visualstudio.com/downloads/download-visual-studio-vs.aspx)

* The HDInsight Tools for Visual Studio: See [Get started using the HDInsight Tools for Visual Studio](../HDInsight/hdinsight-hadoop-visual-studio-tools-get-started.md) for information on installation information.

## How it works

This example contains a C# Storm topology that randomly generates Internet Information Services (IIS) log data. This data is then written to a SQL Database, and from there it is used to generate reports in Power BI.

The following is a list of the files that implement the main functionality of this example.

* **SqlAzureBolt.cs**: Writes information produced in the Storm topology to SQL Database.

* **IISLogsTable.sql**: The Transact-SQL statements used to generate the database that the data is stored in.

> [AZURE.WARNING] You must create the table in SQL Database before starting the topology on your HDInsight cluster.

## Download the example

Download the [HDInsight C# Storm Power BI example](https://github.com/Azure-Samples/hdinsight-dotnet-storm-powerbi). To download it, either fork/clone it using [git](http://git-scm.com/), or use the **Download** link to download a .zip of the archive.

## Create a database

1. Use the steps in the [SQL Database tutorial](../sql-database/sql-database-get-started.md) document to create a new SQL Database.

2. Connect to the database by following the steps in the [Connect to a SQL Database with Visual Studio](../sql-database/sql-database-connect-query.md) document to connect to the database.

4. Right click on the database in Object Explorer and create a __New Query__. Paste the contents of the __IISLogsTable.sql__ file included in the downloaded project into the query window, and then use Ctrl + Shift + E to execute the query. You should receive a message that the command(s) completed successfully.

    Once this completes, there will be a new table named __IISLOGS__ in the database.

## Configure the sample

1. From the [Azure portal](https://portal.azure.com), select your SQL database. From the __Essentials__ section of the SQL database blade, select __Show database connection strings__. From the list that appears, copy the __ADO.NET (SQL authentication)__ information.

1. Open the sample in Visual Studio. From **Solution Explorer**, open the **App.config** file, and then find the following entry:

        <add key="SqlAzureConnectionString" value="##TOBEFILLED##" />
    
    Replace the __##TOBEFILLED##__ value with the database connection string copied in the previous step. Replace __{your\_username}__ and __{your\_password}__ with the username and password for the database.

2. Save and close the files.

## Deploy the sample

1. From **Solution Explorer**, right-click the **StormToSQL** project and select **Submit to Storm on HDInsight**. Select the HDInsight cluster from the **Storm Cluster** dropdown dialog.

    > [AZURE.NOTE] It may take a few seconds for the **Storm Cluster** dropdown to populate with server names.
    >
    > If prompted, enter the login credentials for your Azure subscription. If you have more than one subscription, log in to the one that contains your Storm on HDInsight cluster.

2. When the topology has been successfully submitted, the Storm Topologies for the cluster should appear. Select the SqlAzureWriterTopology entry from the list to view information about the running topology.

    ![The topologies, with the topology selected](./media/hdinsight-storm-power-bi-topology/topologyview.png)

    You can use this view to see information on the topology, or double-click on entries (such as the SqlAzureBolt) to see information specific to a component in the topology.

3. After the topology has ran for a few minutes, return to the SQL query window you used to create the database. Replace the existing statements with the following.

        select * from iislogs;
    
    Use Ctrl + Shift + E to execute the query, and you should receive results similar to the following.
    
        1	2016-05-27 17:57:14.797	255.255.255.255	/bar	GET	200
        2	2016-05-27 17:57:14.843	127.0.0.1	/spam/eggs	POST	500
        3	2016-05-27 17:57:14.850	123.123.123.123	/eggs	DELETE	200
        4	2016-05-27 17:57:14.853	127.0.0.1	/foo	POST	404
        5	2016-05-27 17:57:14.853	10.9.8.7	/bar	GET	200
        6	2016-05-27 17:57:14.857	192.168.1.1	/spam	DELETE	200

    This is data that has been written from the Storm topology.

## Create a report

1. Connect to the [Azure SQL Database connector](https://app.powerbi.com/getdata/bigdata/azure-sql-database-with-live-connect) for Power BI.

2. Within __Databases__, select __Get__.

3. Select __Azure SQL Database__, and then select __Connect__.

4. Enter the information to connect to your Azure SQL Database. You can find this by visiting the [Azure portal](https://portal.azure.com) and selecting your SQL database.

    > [AZURE.NOTE] You can also set the refresh interval and custom filters by using __Enable Advanced Options__ from the connect dialog.

5. After you've connected, you will see a new dataset with the same name as the database you connected to. Select the dataset to begin designing a report.

3. From __Fields__, expand the __IISLOGS__ entry. Select the checkbox for __URISTEM__. This will create a new report that lists the URI stems (/foo, /bar, etc.) logged in the database.

    ![Creating a report](./media/hdinsight-storm-power-bi-topology/createreport.png)

5. Next, drag __METHOD__ to the report. The report will update to list the stems and the corresponding HTTP method used for the HTTP request.

    ![adding the method data](./media/hdinsight-storm-power-bi-topology/uristemandmethod.png)

4. From the __Visualizations__ column, select the __Fields__ icon, and then select the down arrow next to __METHOD__ in the __Values__ section. From the list that appears, select __Count__. This will change the report to list a count of how many times a specific URI has been accessed.

    ![Changing to a count of methods](./media/hdinsight-storm-power-bi-topology/count.png)

6. Next, select the __Stacked column chart__ to change how the information is displayed.

    ![Changing to a stacked chart](./media/hdinsight-storm-power-bi-topology/stackedcolumn.png)

7. Once you have the report how you want it, use the __Save__ entry on the menu to enter a name and save the report.

## Stop the topology

The topology will continue to run until you stop it or delete the Storm on HDInsight cluster. Perform the following steps to stop the topology.

1. In Visual Studio, return to the topology viewer and select the topology.

2. Select the **Kill** button to stop the topology.

    ![Kill button on the toplogy summary](./media/hdinsight-storm-power-bi-topology/killtopology.png)

## Delete your cluster

[AZURE.INCLUDE [delete-cluster-warning](../../includes/hdinsight-delete-cluster-warning.md)]

## Next steps

In this document, you learned how to send data from a Storm topology to SQL Database, then visualize the data using Power BI. For information on how to work with other Azure technologies using Storm on HDInsight, see the following:

* [Example topologies for Storm on HDInsight](hdinsight-storm-example-topology.md)
