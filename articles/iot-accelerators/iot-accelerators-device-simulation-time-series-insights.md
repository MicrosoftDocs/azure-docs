---
title: Visualize device simulation telemetry with Time Series Insights - Azure | Microsoft Docs
description: Learn how to configure your Time Series Insights environment to explore and analyze telemetry generated by the Device Simulation solution accelerator.
author: dominicbetts
manager: timlt
ms.author: dobett
ms.date: 08/20/2018
ms.topic: conceptual
ms.service: iot-accelerators
services: iot-accelerators
---

# Use Time Series Insights to visualize telemetry sent from the Device Simulation solution accelerator

The Device Simulation solution accelerator lets you generate telemetry from simulated devices to test your IoT solutions. This how-to guide shows you how to visualize and analyze the simulated telemetry using a Time Series Insights environment.

## Prerequisites

To follow the steps in this how-to guide, you need an active Azure subscription. If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) before you begin.

The steps in this how-to guide assume you've deployed the Device Simulation solution accelerator to your Azure subscription. If you haven't deployed the solution accelerator, follow the steps in the [Deploy and run a cloud-based device simulation solution](quickstart-device-simulation-deploy.md) quickstart.

This article assumes the name of your solution accelerator is **contoso-simulation**. Replace **contoso-simulation** with the name of your solution accelerator as you complete the following steps.

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

## Create a consumer group

You need to create a dedicated consumer group in your IoT hub to stream telemetry to Time Series Insights. An event source in Time Series Insights should have the exclusive use of an IoT Hub consumer group.

The following steps use the Azure CLI in the Azure Cloud Shell to create the consumer group:

1. The IoT hub is one of several resources created when you deployed the Device Simulation solution accelerator. Execute the following command find the name of your IoT hub - remember to use the name of your solution accelerator:

    ```azurecli-interactive
    az resource list --resource-group contoso-simulation -o table
    ```

    The IoT hub is the resource of type **Microsoft.Devices/IotHubs**.

1. Add a consumer group called **devicesimulationtsi** to the hub. In the following command use the name of your hub and solution accelerator:

    ```azurecli-interactive
    az iot hub consumer-group create --hub-name contoso-simulation7d894 --name devicesimulationtsi --resource-group contoso-simulation
    ```

    You can now close the Azure Cloud Shell.

## Create a new Time Series Insights environment

[Azure Time Series Insights](../../articles/time-series-insights/time-series-insights-overview.md) is a fully managed analytics, storage, and visualization service for managing IoT-scale time-series data in the cloud. To create a new Time Series Insights environment:

1. Sign in to the [Azure portal](https://portal.azure.com/).

1. Select **Create a resource** > **Internet of Things** > **Time Series Insights**:

    ![New Time Series Insights](./media/iot-accelerators-device-simulation-time-series-insights/new-time-series-insights.png)

1. To create your Time Series Insights environment in the same resource group as your solution accelerator, use the values in the following table:

    | Setting | Value |
    | ------- | ----- |
    | Environment Name | The following screenshot uses the name **Contoso-TSI**. Choose your own unique name when you complete this step. |
    | Subscription | Select your Azure subscription in the drop-down. |
    | Resource group | **contoso-simulation**. Use the name of your solution accelerator. |
    | Location | This example uses **East US**. Create your environment in the same region as your Device simulation accelerator. |
    | Sku |**S1** |
    | Capacity | **1** |

    ![Create Time Series Insights](./media/iot-accelerators-device-simulation-time-series-insights/new-time-series-insights-create.png)

    > [!NOTE]
    > Adding the Time Series Insights environment to the same resource group as the solution accelerator means that it's deleted when you delete the solution accelerator.

1. Click **Create**. It can take a few minutes for the environment to be created.

## Create event source

Create a new event source to connect to your IoT hub. Use the consumer group you created in the previous steps. A Time Series Insights event source requires a dedicated consumer group not in use by another service.

1. In the Azure portal, navigate to your new Time Series Environment.

1. On the left, click **Event Sources**:

    ![View Event Sources](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-event-sources.png)

1. Click **Add**:

    ![Add Event Source](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-event-sources-add.png)

1. To configure your IoT hub as a new event source, use the values in the following table:

    | Setting | Value |
    | ------- | ----- |
    | Event source Name | The following screenshot uses the name **contoso-iot-hub**. Use your own unique name when you complete this step. |
    | Source | **IoT Hub** |
    | Import option | **Use IoT Hub from available subscriptions** |
    | Subscription ID | Select your Azure subscription in the drop-down. |
    | Iot hub name | **contoso-simulation7d894**. Use the name of your IoT hub from your Device Simulation solution accelerator. |
    | Iot hub policy name | **iothubowner** |
    | Iot hub policy key | This field is populated automatically. |
    | Iot hub consumer group | **devicesimulationtsi** |
    | Event serialization format | **JSON** |
    | Timestamp property name | Leave blank |

    ![Create Event Source](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-event-source-create.png)

1. Click **Create**.

> [!NOTE]
> You can [grant additional users access](../../articles/time-series-insights/time-series-insights-data-access.md#grant-data-access) to the Time Series Insights explorer.

## Start a simulation

Before you use Time Series Insights explorer, configure the Device Simulation solution accelerator to generate some telemetry. The following screenshot, shows a running simulation with 10 chiller devices:

![Running device simulation](./media/iot-accelerators-device-simulation-time-series-insights/running-simulation.png)

## Time Series Insights explorer

The Time Series Insights explorer is a web app you can use to visualize your telemetry.

1. In the Azure portal, select the Time Series Insights **Overview** tab.

1. To open the Time Series Insights explorer web app, click **Go to Environment**:

    ![Time Series Insights explorer](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-environment.png)

1. In the time selection panel, select **Last 30 minutes** from the quick times menu and click **Search**:

    ![Time Series Insights explorer search](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-search-time.png)

1. In the terms panel on the left, select **temperature** as the **Measure** and **iothub-connection-device-id** as the **Split By** value:

    ![Time Series Insights explorer query](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-query1.png)

1. Right-click on the chart and select **Explore events**:

    ![Time Series Insights explorer events](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-explore-events.png)

1. The event data shows in a grid:

    ![Time Series Insights explorer table](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-table.png)

1. Click the perspective view button:

    ![Time Series Insights explorer perspective](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-explorer-perspective.png)

1. Click **+** to add a new query to the perspective:

    ![Time Series Insights explorer Add Query](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-new-query.png)

1. Select **Last 30 minutes** as the time span, **Humidity** as the **Measure**, and **iothub-connection-device-id** as the **Split By** value:

    ![Time Series Insights explorer query](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-query2.png)

1. Click the perspective view button to view your device telemetry dashboard:

    ![Time Series Insights explorer dashboard](./media/iot-accelerators-device-simulation-time-series-insights/time-series-insights-dashboard.png)

## Clean up resources

If you plan to explore further, leave the solution accelerator deployed.

If you no longer need the solution accelerator, delete it from the [Provisioned solutions](https://www.azureiotsolutions.com/Accelerators#dashboard) page, by selecting it, and then clicking **Delete Solution**.

If you added the Time Series Insights environment to the solution accelerator's resource group, it is automatically deleted when you delete the solution accelerator. Otherwise you must manually remove the Time Series Insights environment from the Azure portal.

## Next Steps

To learn more about how to explore and query data in the Time Series Insights explorer, see [Azure Time Series Insights explorer](../time-series-insights/time-series-insights-explorer.md).
