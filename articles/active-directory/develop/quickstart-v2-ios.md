---
title: Microsoft identity platform iOS quickstart | Azure
description: Learn how to sign-in users and query Microsoft Graph in an iOS native application.
services: active-directory
documentationcenter: dev-center-name
author: danieldobalian
manager: CelesteDG
editor: ''

ms.assetid: 820acdb7-d316-4c3b-8de9-79df48ba3b06
ms.service: active-directory
ms.subservice: develop
ms.devlang: na
ms.topic: quickstart
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/18/2019
ms.author: dadobali
ms.custom: aaddev 
#Customer intent: As an application developer, I want to learn how to sign in users and call Microsoft Graph from my iOS application.
ms.collection: M365-identity-device-management
---

# Quickstart: Sign in users and call the Microsoft Graph API from an iOS app

[!INCLUDE [active-directory-develop-applies-v2-msal](../../../includes/active-directory-develop-applies-v2-msal.md)]

This quickstart contains a code sample that demonstrates how a native iOS application can sign in personal, work and school accounts, get an access token, and call the Microsoft Graph API.

![Shows how the sample app generated by this quickstart works](media/quickstart-v2-ios/ios-intro.svg)

> [!NOTE]
> **Prerequisites**
> * XCode 10+
> * iOS 10+ 

> [!div renderon="docs"]
> ## Register and download your quickstart app
> You have two options to start your quickstart application:
> * [Express] [Option 1: Register and auto configure your app and then download your code sample](#option-1-register-and-auto-configure-your-app-and-then-download-your-code-sample)
> * [Manual] [Option 2: Register and manually configure your application and code sample](#option-2-register-and-manually-configure-your-application-and-code-sample)
>
> ### Option 1: Register and auto configure your app and then download your code sample
> #### Step 1: Register your application
> To register your app,
> 1. Go to the new [Azure portal - App registrations](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/applicationsListBlade/quickStartType/IosQuickstartPage/sourceType/docs) pane.
> 1. Enter a name for your application and select **Register**.
> 1. Follow the instructions to download and automatically configure your new application with just one click.
>
> ### Option 2: Register and manually configure your application and code sample
>
> #### Step 1: Register your application
> To register your application and add the app's registration information to your solution manually, follow these steps:
>
> 1. Navigate to the Microsoft identity platform for developers [App registrations](https://aka.ms/MobileAppReg) page.
> 1. Select **New registration**.
> 1. When the **Register an application** page appears, enter your application's registration information:
>      - In the **Name** section, enter a meaningful application name that will be displayed to users of the app when they sign in or consent to your app, for example `iOS-Quickstart`.
>      - Hit the `Register` button.
> 1. Go to `Authentication` > `Add Platform` > `iOS`.    
>      - Enter the Bundle Identifier for your application. Select the `TARGETS` for the application you want to configure and the Bundle Identifier will be inside the `General` tab.
> 1. Select `Configure` and save the ***MSAL Configuration*** details for later. 

> [!div renderon="portal" class="sxs-lookup"]
>
> #### Step 1: Configure your application
> For the code sample for this quickstart to work, you need to add a redirect URI compatible with the Auth broker. 
> > [!div renderon="portal" id="makechanges" class="nextstepaction"]
> > [Make this change for me]()
>
> > [!div id="appconfigured" class="alert alert-info"]
> > ![Already configured](media/quickstart-v2-ios/green-check.png) Your application is configured with these attributes

#### Step 2: Download your web server or project

- [Download the Code Sample](https://github.com/Azure-Samples/active-directory-ios-swift-native-v2/archive/master.zip)

#### Step 3: Configure your project

> [!div renderon="docs"]
> If you selected Option 1 above, you can skip these steps. Open the project in XCode and run the app. 

> [!div renderon="portal" class="sxs-lookup"]
> 1. Extract the zip file and open the project in XCode.
> 1. Edit **ViewController.swift** and replace the line starting with 'let kClientID' with the following  code snippet:
>    ```swift
>    let kClientID = "Enter_the_Application_Id_here"
>    let kAuthority = "Enter_the_Authority_here"
>    ```
> 1. Press Control + click **Info.plist** to bring up the contextual menu, and then select **Open As** > **Source Code**.
> 1. Under the dict root node, add the following code:
>
>    ```xml
>    <key>CFBundleURLTypes</key>
>    <array>
>       <dict>
>          <key>CFBundleURLSchemes</key>
>          <array>
>             <string>msauth.Enter_the_Bundle_Id_Here</string>
>          </array>
>       </dict>
>    </array>
>    ```

> [!div renderon="docs"]
>
> 1. Extract the zip file and open the project in XCode.
> 1. Edit **ViewController.swift** and replace the line starting with 'let kClientID' with the following  code snippet:
>
>    ```swift
>    let kClientID = "ENTER_YOUR_APPLICATION/CLIENT_ID"
>    ```
> 1. Press Control + click **Info.plist** to bring up the contextual menu, and then select **Open As** > **Source Code**.
> 1. Under the dict root node, add the following code:
>
>    ```xml
>    <key>CFBundleURLTypes</key>
>    <array>
>       <dict>
>          <key>CFBundleURLSchemes</key>
>          <array>
>             <string>msauth.<ENTER_YOUR_BUNDLE_ID></string>
>          </array>
>       </dict>
>    </array>
>    ```

## More Information

Read these sections to learn more about this quickstart.

### MSAL

MSAL ([MSAL.framework](https://github.com/AzureAD/microsoft-authentication-library-for-objc)) is the library used to sign in users and request tokens used to access an API protected by Microsoft identity platform. You can add MSAL to your application using the following process:

```
$ vi Podfile
```
Add the following to this podfile:

```
 target 'QuickStart' do
   use_frameworks!
 	 pod 'MSAL', '0.4'
 end
```

### MSAL initialization

You can add the reference for MSAL by adding the following code:

```swift
import MSAL
```

Then, initialize MSAL using the following code:

```swift
let authority = try MSALAADAuthority(url: URL(string: kAuthority)!)
            
let msalConfiguration = MSALPublicClientApplicationConfig(clientId: kClientID, redirectUri: nil, authority: authority)
self.applicationContext = try MSALPublicClientApplication(configuration: msalConfiguration)
```

> |Where: ||
> |---------|---------|
> | `clientId` | The Application ID from the application registered in *portal.azure.com* |
> | `authority` | The Microsoft identity platform endpoint. In most of cases this will be *https<span/>://login.microsoftonline.com/common* |
> | `redirectUri` | The redirect URI of the application. You can pass 'nil' to use the default value, or your custom redirect URI. |

Your app must have the following in your `AppDelegate`. This lets MSAL SDK handle token response from the Auth broker app when you perform authentication.

 ```swift
 func application(_ app: UIApplication, open url: URL, options: [UIApplicationOpenURLOptionsKey : Any] = [:]) -> Bool {
         guard let sourceApplication = options[UIApplicationOpenURLOptionsKey.sourceApplication] as? String else {
             return false
         }
         
         return MSALPublicClientApplication.handleMSALResponse(url, sourceApplication: sourceApplication)
     }
```

Finally, your app must has an `LSApplicationQueriesSchemes` entry in your ***Info.plist*** alongside the `CFBundleURLTypes`. The sample comes with this included. 

   ```xml 
   <key>LSApplicationQueriesSchemes</key>
   <array>
      <string>msauth</string>
      <string>msauthv2</string>
   </array>
   ```

### Requesting tokens

MSAL has two methods used to acquire tokens: `acquireToken` and `acquireTokenSilent`.

#### Getting an access token interactively

Some situations require forcing users to interact with Microsoft identity platform endpoint which will result in a context switch to the system browser to either validate users's credentials or for consent. Some examples include:

* The first time users sign in to the application
* When users may need to reenter their credentials because the password has expired
* When your application is requesting access to a resource that the user needs to consent to
* When two factor authentication is required

```swift
let parameters = MSALInteractiveTokenParameters(scopes: kScopes)
applicationContext.acquireToken(with: parameters) { (result, error) in /* Add your handling logic */}
```

> |Where:||
> |---------|---------|
> | `scopes` | Contains the scopes being requested (that is, `[ "user.read" ]` for Microsoft Graph or `[ "<Application ID URL>/scope" ]` for custom Web APIs  (`api://<Application ID>/access_as_user`) |

#### Getting an access token silently

You don't want to require the user to validate their credentials every time they need to access a resource. If the user has already signed in, this method allows you to get SSO from the browser or the Microsoft Authenticator:

```swift
let parameters = MSALSilentTokenParameters(scopes: kScopes, account: applicationContext.allAccounts().first)
applicationContext.acquireTokenSilent(with: parameters) { (result, error) in /* Add your handling logic */}
```

> |Where: ||
> |---------|---------|
> | `scopes` | Contains the scopes being requested (that is, `[ "user.read" ]` for Microsoft Graph or `[ "<Application ID URL>/scope" ]` for custom Web APIs (`api://<Application ID>/access_as_user`) |
> | `account` | The account requesting the token. This quickstart is a single account application (one account signed in at a time).  If you want to build a multi-account app you'll need to incorporate logic to identify a specific account `applicationContext.account(forHomeAccountId: self.homeAccountId)` |

## Next steps

Try out the iOS tutorial for a complete step-by-step guide on building applications and new features, including a full explanation of this quickstart.

### Learn the steps to create the application used in this quickstart

> [!div class="nextstepaction"]
> [Call Graph API iOS tutorial](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-ios)

[!INCLUDE [Help and support](../../../includes/active-directory-develop-help-support-include.md)]