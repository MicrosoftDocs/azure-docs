---
title: "Quickstart: Sign in users and call Microsoft Graph in a Windows desktop application"
description: In this quickstart, learn how a Windows Presentation Foundation (WPF) app can get an access token and call an API protected by the Microsoft identity platform.
services: active-directory
author: OwenRichards1
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 01/14/2022
ms.author: owenrichards
ms.reviewer: jmprieur
ms.custom: aaddev, identityplatformtop40, mode-api
#Customer intent: As an application developer, I want to learn how my Windows Presentation Foundation (WPF) application can get an access token and call an API that's protected by the Microsoft identity platform.
---

# Quickstart: Acquire a token and call Microsoft Graph API from a Windows desktop application

> [!div renderon="docs"]
> Welcome! This probably isn't the page you were expecting. While we work on a fix, this link should take you to the right article:
>
> > [Quickstart: Windows Presentation Foundation (WPF) desktop app that signs in users and calls a web API](desktop-app-quickstart.md?pivots=devlang-windows-desktop)
> 
> We apologize for the inconvenience and appreciate your patience while we work to get this resolved.

> [!div renderon="portal" class="sxs-lookup"]
> In this quickstart, you download and run a code sample that demonstrates how a Windows Presentation Foundation (WPF) application can sign in users and get an access token to call the Microsoft Graph API. 
> 
> See [How the sample works](#how-the-sample-works) for an illustration.
> 
> 
> #### Step 1: Configure your application in Azure portal
> For the code sample in this quickstart to work, add a **Redirect URI** of `https://login.microsoftonline.com/common/oauth2/nativeclient` and `ms-appx-web://microsoft.aad.brokerplugin/{client_id}`.
> > [!div class="nextstepaction"]
> > [Make this change for me]()
> 
> > [!div class="alert alert-info"]
> > ![Already configured](media/quickstart-v2-windows-desktop/green-check.png) Your application is configured with these attributes.
> 
> #### Step 2: Download your Visual Studio project
> 
> Run the project using Visual Studio 2019.
> > [!div class="nextstepaction"]
> > [Download the code sample](https://github.com/Azure-Samples/active-directory-dotnet-desktop-msgraph-v2/archive/msal3x.zip)
> 
> [!INCLUDE [active-directory-develop-path-length-tip](../../../includes/active-directory-develop-path-length-tip.md)]
> 
> #### Step 3: Your app is configured and ready to run
> We have configured your project with values of your app's properties and it's ready to run.
> 
> > [!div class="sxs-lookup"]
> > > [!NOTE]
> > > `Enter_the_Supported_Account_Info_Here`
> 
> ## More information
> 
> ### How the sample works
> ![Shows how the sample app generated by this quickstart works](media/quickstart-v2-windows-desktop/windesktop-intro.svg)
> 
> ### MSAL.NET
> MSAL ([Microsoft.Identity.Client](https://www.nuget.org/packages/Microsoft.Identity.Client)) is the library used to sign in users and request tokens used to access an API protected by Microsoft identity platform. You can install MSAL by running the following command in Visual Studio's **Package Manager Console**:
> 
> ```powershell
> Install-Package Microsoft.Identity.Client -IncludePrerelease
> ```
> 
> ### MSAL initialization
> 
> You can add the reference for MSAL by adding the following code:
> 
> ```csharp
> using Microsoft.Identity.Client;
> ```
> 
> Then, initialize MSAL using the following code:
> 
> ```csharp
> IPublicClientApplication publicClientApp = PublicClientApplicationBuilder.Create(ClientId)
>                 .WithRedirectUri("https://login.microsoftonline.com/common/oauth2/nativeclient")
>                 .WithAuthority(AzureCloudInstance.AzurePublic, Tenant)
>                 .Build();
> ```
> 
> |Where: | Description |
> |---------|---------|
> | `ClientId` | Is the **Application (client) ID** for the application registered in the Azure portal. You can find this value in the app's **Overview** page in the Azure portal. |
> 
> ### Requesting tokens
> 
> MSAL has two methods for acquiring tokens: `AcquireTokenInteractive` and `AcquireTokenSilent`.
> 
> #### Get a user token interactively
> 
> Some situations require forcing users interact with the Microsoft identity platform through a pop-up window to either validate their credentials or to give consent. Some examples include:
> 
> - The first time users sign in to the application
> - When users may need to reenter their credentials because the password has expired
> - When your application is requesting access to a resource that the user needs to consent to
> - When two factor authentication is required
> 
> ```csharp
> authResult = await App.PublicClientApp.AcquireTokenInteractive(_scopes)
>                                       .ExecuteAsync();
> ```
> 
> |Where:| Description |
> |---------|---------|
> | `_scopes` | Contains the scopes being requested, such as `{ "user.read" }` for Microsoft Graph or `{ "api://<Application ID>/access_as_user" }` for custom web APIs. |
> 
> #### Get a user token silently
> 
> You don't want to require the user to validate their credentials every time they need to access a resource. Most of the time you want token acquisitions and renewal without any user interaction. You can use the `AcquireTokenSilent` method to obtain tokens to access protected resources after the initial `AcquireTokenInteractive` method:
> 
> ```csharp
> var accounts = await App.PublicClientApp.GetAccountsAsync();
> var firstAccount = accounts.FirstOrDefault();
> authResult = await App.PublicClientApp.AcquireTokenSilent(scopes, firstAccount)
>                                       .ExecuteAsync();
> ```
> 
> |Where: | Description |
> |---------|---------|
> | `scopes` | Contains the scopes being requested, such as `{ "user.read" }` for Microsoft Graph or `{ "api://<Application ID>/access_as_user" }` for custom web APIs. |
> | `firstAccount` | Specifies the first user in the cache (MSAL support multiple users in a single app). |
> 
> [!INCLUDE [Help and support](../../../includes/active-directory-develop-help-support-include.md)]
> 
> ## Next steps
> 
> Try out the Windows desktop tutorial for a complete step-by-step guide on building applications and new features, including a full explanation of this quickstart.
> 
> > [!div class="nextstepaction"]
> > [Call Graph API tutorial](./tutorial-v2-windows-desktop.md)
