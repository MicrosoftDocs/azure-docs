---
title: Microsoft identity platform Android quickstart | Azure
description: Learn how Android applications can call an API that require access tokens by Microsoft identity platform endpoint.
services: active-directory
documentationcenter: dev-center-name
author: danieldobalian
manager: CelesteDG
editor: ''

ms.assetid: 820acdb7-d316-4c3b-8de9-79df48ba3b06
ms.service: active-directory
ms.subservice: develop
ms.devlang: na
ms.topic: quickstart
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2019
ms.author: ryanwi
ms.custom: aaddev 
#Customer intent: As an application developer, I want to learn how Android native apps can call an API that requires access tokens by Microsoft identity platform endpoint.
ms.collection: M365-identity-device-management
---

# Quickstart: Sign in users and call the Microsoft Graph API from an Android app

[!INCLUDE [active-directory-develop-applies-v2-msal](../../../includes/active-directory-develop-applies-v2-msal.md)]

This quickstart contains a code sample that demonstrates how an Android application can sign in personal or work and school accounts, get an access token, and call the Microsoft Graph API.

![Shows how the sample app generated by this quickstart works](media/quickstart-v2-android/android-intro.svg)

> [!NOTE]
> **Prerequisites**
> * Android Studio 
> * Android 16+ is required 


> [!div renderon="docs"]
> ## Register and download your quickstart app
> You have two options to start your quickstart application:
> * [Express] [Option 1: Register and auto configure your app and then download your code sample](#option-1-register-and-auto-configure-your-app-and-then-download-your-code-sample)
> * [Manual] [Option 2: Register and manually configure your application and code sample](#option-2-register-and-manually-configure-your-application-and-code-sample)
>
> ### Option 1: Register and auto configure your app and then download your code sample
> #### Step 1: Register your application
> To register your app,
> 1. Go to the new [Azure portal - App registrations](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/applicationsListBlade/quickStartType/AndroidQuickstartPage/sourceType/docs) pane.
> 1. Enter a name for your application and select **Register**.
> 1. Follow the instructions to download and automatically configure your new application with just one click.
>
> ### Option 2: Register and manually configure your application and code sample
>
> #### Step 1: Register your application
> To register your application and add the app's registration information to your solution manually, follow these steps:
>
> 1. Navigate to the Microsoft identity platform for developers [App registrations](https://aka.ms/MobileAppReg) page.
> 1. Select **New registration**.
> 1. When the **Register an application** page appears, enter your application's registration information:
>      - In the **Name** section, enter a meaningful application name that will be displayed to users of the app, for example `AndroidQuickstart`.
>      - You can skip other configurations on this page. 
>      - Hit the `Register` button.
> 1. Click on the new app > go to `Authentication` > `Add Platform` > `Android`.    
>      - Enter the Package Name from your Android studio project. 
>      - Generate a Signature Hash. Refer to the portal for instructions.
> 1. Select `Configure` and save the ***MSAL Configuration*** JSON for later. 

> [!div renderon="portal" class="sxs-lookup"]
> #### Step 1: Configure your application
> For the code sample for this quickstart to work, you need to add a redirect URI compatible with the Auth broker. 
> > [!div renderon="portal" id="makechanges" class="nextstepaction"]
> > [Make this change for me]()
>
> > [!div id="appconfigured" class="alert alert-info"]
> > ![Already configured](media/quickstart-v2-android/green-check.png) Your application is configured with these attributes

#### Step 2: Download the project

* [Download the Code Sample](https://github.com/Azure-Samples/active-directory-android-native-v2/archive/master.zip)

#### Step 3: Configure your project

> [!div renderon="docs"]
> If you selected Option 1 above, you can skip these steps. 

> [!div renderon="portal" class="sxs-lookup"]
> 1. Extract and open the Project in Android Studio.
> 1. Inside **app** > **src** > **main** > **res** > **raw**, open **auth_config.json**.
> 1. Edit **auth_config.json** and replace it with the JSON from the Azure portal. If instead you want to manually make the changes:
>    ```javascript
>    {
>       "client_id" : "Enter_the_Application_Id_Here",
>       "authorization_user_agent" : "DEFAULT",
>       "redirect_uri" : "Enter_the_Redirect_Uri_Here",
>       "authorities" : [
>          {
>             "type": "AAD",
>             "audience": {
>                "type": "Enter_the_Audience_Info_Here",
>                "tenant_id": "Enter_the_Tenant_Info_Here"
>             }
>          }
>       ]
>    }
> 1. Inside **app** > **manifests**, open  **AndroidManifest.xml**.
> 1. Paste the following activity to the **manifest\application** node:	
>    ```xml
>    <!--Intent filter to catch Microsoft's callback after Sign In-->
>    <activity
>        android:name="com.microsoft.identity.client.BrowserTabActivity">
>        <intent-filter>
>            <action android:name="android.intent.action.VIEW" />
>            <category android:name="android.intent.category.DEFAULT" />
>            <category android:name="android.intent.category.BROWSABLE" />
>            <data android:scheme="msauth"
>                android:host="Enter_the_Package_Name"
>                android:path="/Enter_the_Signature_Hash" />
>        </intent-filter>
>    </activity>
>    ```
> > 1. Run the app! 

> [!div renderon="docs"]
> 1. Extract and open the Project in Android Studio.
> 1. Inside **app** > **res** > **raw**, open **auth_config.json**.
> 1. Edit **auth_config.json** and replace it with the JSON from the Azure portal. If instead you want to manually make these changes:
>    ```javascript
>    "client_id" : "ENTER_YOUR_APPLICATION_ID",
>    "redirect_uri": "ENTER_YOUR_REDIRECT_URI", 
>     ```
> 1. Inside **app** > **manifests**, open  **AndroidManifest.xml**.
> 1. Add the following activity to the **manifest\application** node. This code snippet registers a **BrowserTabActivity** to allow the OS to resume your application after completing the authentication:
>    ```xml
>    <!--Intent filter to catch Microsoft's callback after Sign In-->
>    <activity
>        android:name="com.microsoft.identity.client.BrowserTabActivity">
>        <intent-filter>
>            <action android:name="android.intent.action.VIEW" />
>            <category android:name="android.intent.category.DEFAULT" />
>            <category android:name="android.intent.category.BROWSABLE" />
>            <data android:scheme="msauth"
>                android:host="Enter_the_Package_Name"
>                android:path="/Enter_the_Decoded_Signature_Hash" />
>        </intent-filter>
>    </activity>
>    ```
> 1. Replace `Enter_the_Package_Name` and `Enter_the_Signature_Hash` with the values you registered in the Azure portal. 
> 1. Run the app! 

## More Information

Read the following sections for more info about this quickstart.

### Getting MSAL

MSAL ([com.microsoft.identity.client](https://javadoc.io/doc/com.microsoft.identity.client/msal)) is the library used to sign in users and request tokens used to access an API protected by Microsoft identity platform. You can use Gradle 3.0+ to install it by adding the following in **Gradle Scripts** > **build.gradle (Module: app)** under **Dependencies**:

```gradle  
implementation 'com.android.volley:volley:1.1.1'
implementation 'com.microsoft.identity.client:msal:0.3.+'
```

### MSAL initialization

You can add the reference for MSAL by adding the following code:

```java
import com.microsoft.identity.client.*;
```

Then, initialize MSAL using the following code:

```java
    sampleApp = new PublicClientApplication(
        this.getApplicationContext(),
        R.raw.auth_config);
```

> |Where: ||
> |---------|---------|
> |`R.raw.auth_config` | This file contains the configurations for your application including your App/Client ID, Sign-in audience, Redirect URI, and several other customization options. |

### Requesting tokens

MSAL has two methods used acquire tokens: `acquireToken` and `acquireTokenSilentAsync`

#### acquireToken: Getting a token interactively

Some situations require users to interact with Microsoft identity platform. In these cases, the end user may be required to select their account, enter their credentials, or consent to the permissions your app has requested. For example, 

* The first time users sign in to the application
* If a user resets their password, they will need to enter their credentials 
* If consent is revoked 
* If your app explicitly requires consent. 
* When your application is requesting access to a resource for the first time
* When MFA or other Conditional Access policies are required

```java
sampleApp.acquireToken(this, SCOPES, getAuthInteractiveCallback());
```

> |Where:||
> |---------|---------|
> | `SCOPES` | Contains the scopes being requested (that is, `{ "user.read" }` for Microsoft Graph or `{ "<Application ID URL>/scope" }` for custom Web APIs (i.e. `api://<Application ID>/access_as_user`) |
> | `getAuthInteractiveCallback` | Callback executed when control is given back to the application after authentication |

#### acquireTokenSilent: Getting a user token silently

Apps shouldn't require their users to sign in every time they request a token. If the user has already signed in, this method allows apps to request tokens silently.

```java
    sampleApp.getAccounts(new PublicClientApplication.AccountsLoadedCallback() {
        @Override
        public void onAccountsLoaded(final List<IAccount> accounts) {

            if (!accounts.isEmpty()) {
                sampleApp.acquireTokenSilentAsync(SCOPES, accounts.get(0), getAuthSilentCallback());
            } else {
                /* No accounts */
            }
        }
    });
```

> |Where:||
> |---------|---------|
> | `SCOPES` | Contains the scopes being requested (that is, `{ "user.read" }` for Microsoft Graph or `{ "<Application ID URL>/scope" }` for custom Web APIs (i.e. `api://<Application ID>/access_as_user`) |
> | `getAccounts(...)` | Contains the Account you're trying to get tokens for silently |
> | `getAuthSilentCallback()` | Callback executed when control is given back to the application after authentication |

## Next steps

### Learn the steps to create the application used in this quickstart

Try out the Android tutorial for a complete step-by-step guide on building applications and new features, including a full explanation of this quickstart.

> [!div class="nextstepaction"]
> [Call Graph API Android tutorial](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-android)

### MSAL for Android library wiki

Read more information about MSAL library for Android:

> [!div class="nextstepaction"]
> [MSAL for Android library wiki](https://github.com/AzureAD/microsoft-authentication-library-for-android/wiki)

[!INCLUDE [Help and support](../../../includes/active-directory-develop-help-support-include.md)]
