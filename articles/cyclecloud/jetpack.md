---
title: Jetpack Reference
description: Read reference information about the Jetpack tool in Azure CycleCloud. Jetpack provides node configuration, distributed synchronization, and HealthCheck.
author: staer
ms.date: 01/06/2020
ms.author: adjohnso
---

# Jetpack

Jetpack is required on every node of a cluster. It is automatically installed by Azure CycleCloud on each virtual machine that is provisioned to become a node in a cluster. Jetpack provides three main functions:

* **Node Configuration** -- CycleCloud uses scripts and [Chef](https://www.chef.io) to automate the configuration of a provisioned VM into a working cluster node. A Chef client as well as the necessary resources for the configuration of the VM are embedded within Jetpack.
* **Distributed Synchronization** -- Jetpack manages communication between the node and the CycleCloud application server. This enables CycleCloud to monitor the status of the provisioning VMs and synchronize the orchestration of multiple nodes in the cluster.
* **HealthCheck** -- Jetpack uses [HealthCheck](./how-to/healthcheck.md) to determine the health of VMs so that unhealthy VMs can be terminated.

## Jetpack Installation

The Jetpack installer is cached in your Azure Storage Account when you first start a cluster using CycleCloud. As cluster VMs are provisioned, a [custom script extension](https://docs.microsoft.com/azure/virtual-machines/extensions/overview) is executed as part of the boot process which downloads the Jetpack installer from your Azure Storage cache and then installs it on the VM.

The Jetpack installer:

* Unpacks the Jetpack files to a single directory tree:
  * Windows: _C:\cycle\jetpack_
  * Linux: _/opt/cycle/Jetpack_
* Creates system init startup scripts which configure a VM as a cluster node
* Installs the [HealthCheck](#healthcheck) service
* Installs the [Jetpack Command Line Tool](#jetpack-command-line-tool) to:
  * Windows: _C:\cycle\jetpack\bin\jetpack_
  * Linux: _/opt/cycle/jetpack/bin/jetpack_
* Creates [udev](https://www.freedesktop.org/wiki/Software/systemd/) rules on Linux
* Sets the environment variable `CYCLECLOUD_HOME`

> [!NOTE] 
> If Jetpack has been [pre-installed on the image](./how-to/install-jetpack.md), the custom script extension **will not** re-install Jetpack. Instead, an initialization step will be run which will validate the node's connection to CycleCloud and start the `healthcheck` and `jetpackd` services before continuing to configure the node.

## Jetpack Subdirectories

| Directory | Description  |
| --------- | ------------ |
| `bin`     | Useful binaries and scripts. |
| `config`  | User defined and cluster defined configuration files and scripts. |
| `logs`    | Logs generated by joining a cluster and converging the node, of particular interest is the *chef-client.log* which contains the results from converging Chef recipes. |
| `run`     | Runtime files generated by the system. We don't recommend directly accessing these files. |
| `system`  | Internal files. We don't recommend directly using any files in this directory as they can significantly change from release to release.  |

## HealthCheck

The HealthCheck service executes user-defined scripts to determine a VM's current viability as a cluster node. Please see the [HealthCheck](./how-to/healthcheck.md) documentation for more information.

## Jetpack Command Line Tool

The **Jetpack** command-line tool provides a useful set of subcommands for manipulating the current VM and interacting with Azure CycleCloud.

| Command             | Description                                              |
| ------------------- | -------------------------------------------------------- |
| `jetpack autoscale` | Autoscale the cluster this node belongs to.              |
| `jetpack config`    | Retrieve a configuration value.                          |
| `jetpack converge`  | Execute a Chef converge.                                 |
| `jetpack download`  | Download a blob resource from a project in Azure Storage.|
| `jetpack keepalive` | Delay system termination by the HealthCheck Service.     |
| `jetpack log`       | Log a message to CycleCloud cluster UI.                  |
| `jetpack send`      | Send an arbitrary AMQP message to the CycleCloud server. |
| `jetpack shutdown`  | Request the shutdown of the VM by CycleCloud.            |
| `jetpack test`      | Run tests associated with projects assigned to the VM.   |
| `jetpack users`     | List users that CycleCloud will manage on this VM.       |

### jetpack autoscale

`jetpack autoscale` sets the autoscaling targets for the cluster that the node belongs to. Clusters can be scaled by cores, instance count or custom definitions.

To scale to 100 cores:

```console
jetpack autoscale --corecount=100
```

To scale the 'gpu' nodearray to 5 nodes:

```console
jetpack autoscale --instancecount 5 --name=gpu
```

To customize autoscale, a json file must be written to disk containing the nodearray definition you would like to scale. To scale by 100 cores:

```json
[
  {
      "Name": "execute",
      "TargetCoreCount": 100
  }
]
```

```console
jetpack autoscale --file=custom-autoscale.json
```

### jetpack config

`jetpack config` fetches information passed into a VM by CycleCloud. It exposes:

* all the system properties made available via [Ohai](https://docs.getchef.com/ohai.html)
* a subset of the VM's [Azure metadata](https://docs.microsoft.com/azure/virtual-machines/windows/instance-metadata-service)
* information about the parent CycleCloud cluster.

### jetpack converge

`jetpack converge` downloads all CycleCloud projects associated with the node, and starts a Chef converge process that runs all the Chef recipes and cluster-init scripts for the node.

### jetpack download

`jetpack download` downloads a blob that was uploaded with a [project](~/how-to/projects.md) to the node. You must specify the project the blob belongs to.

To download the blob big-file.zip that was uploaded as part of the `example-project` project to the current directory:

```console
jetpack download --project example-project big-file.zip .
```

### jetpack keepalive

`jetpack keepalive` interacts with the HealthCheck service to delay the termination of the VM due to a failing HealthCheck. Termination can be delayed for a fixed period or indefinitely. By default, termination is delayed for one hour.

To delay system termination by one hour:

```console
jetpack keepalive
```

To delay system termination by six hours:

```console
jetpack keepalive 6h
```

To disable the HealthCheck service entirely, i.e. delay termination indefinitely:

```console
jetpack keepalive forever
```

> [!NOTE] 
> Only the `forever` option is available for HealthCheck on Windows VMs

### jetpack log

`jetpack log` sends a log message back to CycleCloud. The message will appear in the application server log (typically _/opt/cycle_server/cycle_server.log_), the main event log, and the Cluster UI page.

Each message has two properties: **level** and **priority**.

The **level** property indicates the type of message. Valid levels are 'info', 'warn', and 'error'. The
level does not indicate importance of a given message - for example, some errors are trivial and some informational messages critical.

Priority indicates the importance of the message. Valid **priority** values are 'low', 'medium', and 'high'. Only messages with a priority of medium or higher are displayed on the Cluster UI page to avoid flooding the page with low priority messages.

To send an informational log message that will appear on the Cluster UI page:

```console
jetpack log 'system is now ready'
```

To send a low priority log message that you do not want to appear on the Cluster
UI page:

```console
jetpack log 'system is now ready' --priority low
```

By default, messages with a level of *error* have a high priority. To send an
error message:

```console
jetpack log 'the machine cannot process jobs' --level error
```

To send a trivial error message:

```console
jetpack log 'the machine cannot process jobs' --level error --priority low
```

### jetpack send

`jetpack send` sends an AMQP message to CycleCloud. It is an advanced command that is not recommended unless you are developing plugins for CycleCloud.

You can send arbitrary strings or files with specified AMQP routing keys.

### jetpack shutdown

`jetpack shutdown` requests that CycleCloud terminate the node. Options can be passed to the command to specify the reason for the shutdown request (idle vs unhealthy) as well as how to terminate the node (terminate vs deallocate).

To shutdown an unhealthy node:

```console
jetpack shutdown --unhealthy
```

To deallocate the node:

```console
jetpack shutdown --deallocate
```

### jetpack test

`jetpack test` runs any tests that are included with [projects](~/how-to/projects.md) assigned to the node and prints the results to stdout.

### jetpack users

`jetpack users` lists the users that CycleCloud will manage on the node. This list can change over time as users are assigned and removed to the cluster.

To get a user-friendly print out of the users assigned to the node:

```console
$ jetpack users

Username: test-user
Full Name: Test User
UID: 10201
Is Admin: True
Is Owner: True
```

To get script-friendly JSON output:

```console
$ jetpack users --json

[
    {
        "fullName": "Test User",
        "isAdmin": true,
        "isOwner": true,
        "name": "test-user",
        "publicKeys": [
            "ssh-rsa public-key-goes-here\n"
        ],
        "uid": 10201
    }
]
```
