---
title: Detect Windows workstations and servers with a local script
description: Learn about how to detect Windows workstations and servers on your network using a local script.
ms.date: 07/12/2022
ms.topic: how-to
---

# Detect Windows workstations and servers with a local script

In addition to detecting OT devices on your network, use Defender for IoT to discover Microsoft Windows workstations and servers. Same as other detected devices, detected Windows workstations and servers are displayed in the Device inventory. The **Device inventory** pages on the sensor and on-premises management console show enriched data about Windows devices, including data about the Windows operating system and applications installed, patch-level data, open ports, and more.

This article describes how to use a Defender for IoT Windows-based WMI tool to get extended information from Windows devices, such as workstations, servers, and more. Run the WMI script on your Windows devices to get extended information, increasing your device inventory and security coverage. While you can also use [scheduled WMI scans](configure-windows-endpoint-monitoring.md) to obtain this data, scripts can be run locally for regulated networks with waterfalls and one-way elements if WMI connectivity isn't possible.

The script described in this article returns the following details about each detected device:

- IP address
- MAC address
- Operating system
- Service pack
- Installed programs
- Last knowledge base update

If an OT network sensor has already learned the device, running the script outlined in this article retrieves the device's information and enrichment data.

## Prerequisites

Before performing the procedures in this article, you must have:

- An OT network sensor [installed](ot-deploy/install-software-ot-sensor.md), [activated, and configured](ot-deploy/activate-deploy-sensor.md), and monitoring the network where your device is connected.

- Access to your OT network sensor as an **Admin** user. For more information, see [On-premises users and roles for OT monitoring with Defender for IoT](roles-on-premises.md).

- Administrator permissions on any devices where you intend to run the script.

### Supported operating systems

The script described in this article is supported for the following Windows operating systems:

- Windows XP
- Windows 2000
- Windows NT
- Windows 7
- Windows 10
- Windows Server 2003/2008/2012/2016/2019

## Run the script

This procedure describes how to obtain, deploy, and run the script on the Windows workstation and servers that you want to monitor in Defender for IoT.

The script you run to detect enriched Windows data is run as a utility and not as an installed program. Running the script doesn't affect the endpoint.

1. To acquire the script, [contact customer support](mailto:support.microsoft.com).

1. Deploy the script once, or using ongoing automation, using standard automated deployment methods and tools.

1. Copy the script to a local drive and unzip it. The following files appear:

    - `start.bat`
    - `settings.json`
    - `data.bin`
    - `run.bat`

1. Run the `run.bat` file.

    After the script runs to probe the registry, a CX-snapshot file appears with the registry information. The filename indicates the system name, date, and time of the snapshot with the following syntax: `CX-snaphot_SystemName_Month_Year_Time`

Files generated by the script:

- Remain on the local drive until you delete them.
- Must remain in the same location. Don't separate the generated files.
- Are overwritten if you run the script again.

## Import device details

After having run the script as described [earlier](#run-the-script), import the generated data to your sensor to view the device details in the **Device inventory**.

**To import device details to your sensor**:

1. Use standard, automated methods and tools to move the generated files from each Windows endpoint to a location accessible from your OT sensors.

    Don't update filenames or separate the files from each other.

1. Sign into your OT sensor console, and select **System Settings** > **Import Settings** > **Windows Information**.

1. Select **Import File**, and then select all the files (Ctrl+A).

1. Select **Close**. The device registry information is imported and a successful confirmation message is shown.

    If there's a problem uploading one of the files, you'll be informed which file upload failed.

## Next steps

For more information, see [Detect Windows workstations and servers with a local script](detect-windows-endpoints-script.md) and [Import extra data for detected OT devices](how-to-import-device-information.md).

