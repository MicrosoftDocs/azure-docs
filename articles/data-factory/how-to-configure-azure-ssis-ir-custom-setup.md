---
title: Customize setup for the Azure-SSIS integration runtime
description: "This article describes how to use the custom setup interface for the Azure-SSIS integration runtime to install additional components or change settings"
services: data-factory
documentationcenter: ""
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
author: swinarko
ms.author: sawinark
manager: mflasko
ms.reviewer: douglasl
ms.custom: seo-lt-2019
ms.date: 02/01/2020
---

# Customize setup for the Azure-SSIS integration runtime

[!INCLUDE[appliesto-adf-xxx-md](includes/appliesto-adf-xxx-md.md)]

The custom setup interface for the Azure-SSIS Integration Runtime provides an interface to add your own setup steps during the provisioning or reconfiguration of your Azure-SSIS IR. 

Custom setup lets you alter the default operating configuration or environment (for example, to start additional Windows services or persist access credentials for file shares) or install additional components (for example, assemblies, drivers, or extensions) on each node of your Azure-SSIS IR.

There are two ways to do custom setups on your Azure-SSIS IR: express custom setups without scripts and standard custom setups with scripts.

With express custom setups, you can run some common system configurations/Windows commands or install some popular/recommended additional components without using any scripts.  

With standard custom setups, you need to prepare a script and its associated files, and upload them all together into a blob container in your Azure Storage account. You then provide a Shared Access Signature (SAS) Uniform Resource Identifier (URI) for your container when you provision or reconfigure your Azure-SSIS IR. Each node of your Azure-SSIS IR will then download the script and its associated files from your container and run your custom setup with elevated privileges. When your custom setup is finished, each node will upload the standard output of execution and other logs into your container.

You can install both free/unlicensed and paid/licensed components with express/standard custom setups. If you're an ISV, see our documentation on [how to develop paid or licensed components for Azure-SSIS IR](how-to-develop-azure-ssis-ir-licensed-components.md).

> [!IMPORTANT]
> The v2-series nodes of Azure-SSIS IR are not suitable for custom setup, so please use the v3-series nodes instead.  If you already use the v2-series nodes, please switch to use the v3-series nodes as soon as possible.

## Current limitations

The following limitations applies only to standard custom setups:

- If you want to use `gacutil.exe` in your script to install assemblies in the Global Assembly Cache (GAC), you need to provide `gacutil.exe` as part of your custom setup, or use the copy provided in our Public Preview container below.

- If you want to reference a subfolder in your script, `msiexec.exe` does not support the `.\` notation to reference the root folder. Use a command like `msiexec /i "MySubfolder\MyInstallerx64.msi" ...` instead of `msiexec /i ".\MySubfolder\MyInstallerx64.msi" ...`.

- Administrative shares, i.e. hidden network shares automatically created by Windows, are currently not supported on the Azure-SSIS IR.

- IBM iSeries Access ODBC Driver is not supported on the Azure-SSIS IR. You may see installation errors during your custom setup. Please contact IBM support for assistance.

## Prerequisites

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

To customize your Azure-SSIS IR, you need the following things:

- [Azure subscription](https://azure.microsoft.com/)

- [Provisioning your Azure-SSIS IR](https://docs.microsoft.com/azure/data-factory/tutorial-deploy-ssis-packages-azure)

- [An Azure Storage account](https://azure.microsoft.com/services/storage/). Not required for express custom setups. For standard custom setups, you upload and store your custom setup script and its associated files in a blob container. The custom setup process also uploads its execution logs to the same blob container.

## Instructions

1. If you want to provision or reconfigure your Azure-SSIS IR with PowerShell, download and install [Azure PowerShell](/powershell/azure/install-az-ps). For express custom setups, skip to step 4.

1. Prepare your custom setup script and its associated files (for example, .bat, .cmd, .exe, .dll, .msi, or .ps1 files).

   1. You must have a script file named `main.cmd`, which is the entry point of your custom setup.

   1. You need to make sure the script can be executed silently, it is recommended to test the script on local machine first.

   1. If you want additional logs generated by other tools (for example, `msiexec.exe`) to be uploaded into your container, specify the predefined environment variable, `CUSTOM_SETUP_SCRIPT_LOG_DIR` as the log folder in your scripts (for example,  `msiexec /i xxx.msi /quiet /lv %CUSTOM_SETUP_SCRIPT_LOG_DIR%\install.log`).

1. Download, install, and launch [Azure Storage Explorer](https://storageexplorer.com/).

   1. Under **(Local and Attached)**, right-select **Storage Accounts** and select **Connect to Azure storage**.

      ![Connect to Azure storage](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image1.png)

   1. Select **Use a storage account name and key** and select **Next**.

      ![Use a storage account name and key](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image2.png)

   1. Enter your Azure Storage account name and key, select **Next**, and then select **Connect**.

      ![Provide store account name and key](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image3.png)

   1. Under your connected Azure Storage account, right-click on **Blob Containers**, select **Create Blob Container**, and name the new container.

      ![Create a blob container](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image4.png)

   1. Select the new container and upload your custom setup script and its associated files. Make sure that you upload `main.cmd` at the top level of your container, not in any folder. Please also ensure that your container contains only the necessary custom setup files, so downloading them onto your Azure-SSIS IR later will not take a long time. The maximum period for custom setup is currently set at 45 minutes before it times out and this includes the time to download all files from your container and install them on Azure-SSIS IR. If a longer period is needed, please raise a support ticket.

      ![Upload files to the blob container](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image5.png)

   1. Right-click the container and select **Get Shared Access Signature**.

      ![Get the Shared Access Signature for the container](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image6.png)

   1. Create the SAS URI for your container with a sufficiently long expiry time and with read + write + list permissions. You need the SAS URI to download and run your custom setup script and its associated files whenever any node of your Azure-SSIS IR is reimaged/restarted. You need write permission to upload setup execution logs.

      > [!IMPORTANT]
      > Please ensure that the SAS URI does not expire and custom setup resources are always available during the whole lifecycle of your Azure-SSIS IR, from creation to deletion, especially if you regularly stop and start your Azure-SSIS IR during this period.

      ![Generate the Shared Access Signature for the container](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image7.png)

   1. Copy and save the SAS URI of your container.

      ![Copy and save the Shared Access Signature](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image8.png)

1. When you provision or reconfigure your Azure-SSIS IR with Data Factory UI, you can add/remove custom setups by selecting the **Customize your Azure-SSIS Integration Runtime with additional system configurations/component installations** check box on the **Advanced Settings** section of integration runtime setup panel. 

   If you want to add standard custom setups, enter the SAS URI of your container in the **Custom setup container SAS URI** field. 
   
   If you want to add express custom setups, select **New** to open the **Add express custom setup** panel and then select any types under the **Express custom setup type** dropdown menu:

   1. If you select the **Run cmdkey command** type, you can persist access credentials for your file shares/Azure Files on Azure-SSIS IR by entering your targeted computer/domain name, account name/username, and account key/password in the **/Add**, **/User**, and **/Pass** fields, respectively. This is similar to running Windows [cmdkey](https://docs.microsoft.com/windows-server/administration/windows-commands/cmdkey) command on your local machine.
   
   1. If you select the **Add environment variable** type, you can add Windows environment variables to use in your packages that run on Azure-SSIS IR by entering your environment variable name and value in the **Variable name** and **Variable value** fields, respectively. This is similar to running Windows [set](https://docs.microsoft.com/windows-server/administration/windows-commands/set_1) command on your local machine.

   1. If you select the **Install licensed component** type, you can then select any integrated components from our ISV partners under the **Component name** dropdown menu:

      1. If you select the **SentryOne's Task Factory** component, you can install the [Task Factory](https://www.sentryone.com/products/task-factory/high-performance-ssis-components) suite of components from SentryOne on your Azure-SSIS IR by entering the product license key that you purchased from them in the **License key** field. The current integrated version is **2019.4.3**.

      1. If you select the **oh22's HEDDA.IO** component, you can install the [HEDDA.IO](https://hedda.io/ssis-component/) data quality/cleansing component from oh22 on your Azure-SSIS IR after purchasing their service. The current integrated version is **1.0.13**.

	  1. If you select the **oh22's SQLPhonetics.NET** component, you can install the [SQLPhonetics.NET](https://sqlphonetics.oh22.is/sqlphonetics-net-for-microsoft-ssis/) data quality/matching component from oh22 on your Azure-SSIS IR by entering the product license key that you purchased from them in the **License key** field. The current integrated version is **1.0.43**.
   
   Your added express custom setups will appear on the **Advanced Settings** section. To remove them, you can select their check boxes and then select **Delete**.

   ![Advanced settings with custom setups](./media/tutorial-create-azure-ssis-runtime-portal/advanced-settings-custom.png)

1. When you provision or reconfigure your Azure-SSIS IR with PowerShell, you can add/remove custom setups by running the `Set-AzDataFactoryV2IntegrationRuntime` cmdlet before you start your Azure-SSIS IR.
   
   ```powershell
   $ResourceGroupName = "[your Azure resource group name]"
   $DataFactoryName = "[your data factory name]"
   $AzureSSISName = "[your Azure-SSIS IR name]"
   # Custom setup info: Standard/express custom setups
   $SetupScriptContainerSasUri = "" # OPTIONAL to provide a SAS URI of blob container for standard custom setup where your script and its associated files are stored
   $ExpressCustomSetup = "[RunCmdkey|SetEnvironmentVariable|SentryOne.TaskFactory|oh22is.SQLPhonetics.NET|oh22is.HEDDA.IO or leave it empty]" # OPTIONAL to configure an express custom setup without script

   # Add custom setup parameters if you use standard/express custom setups
   if(![string]::IsNullOrEmpty($SetupScriptContainerSasUri))
   {
       Set-AzDataFactoryV2IntegrationRuntime -ResourceGroupName $ResourceGroupName `
           -DataFactoryName $DataFactoryName `
           -Name $AzureSSISName `
           -SetupScriptContainerSasUri $SetupScriptContainerSasUri
   }
   if(![string]::IsNullOrEmpty($ExpressCustomSetup))
   {
       if($ExpressCustomSetup -eq "RunCmdkey")
	   {
           $addCmdkeyArgument = "YourFileShareServerName or YourAzureStorageAccountName.file.core.windows.net"
           $userCmdkeyArgument = "YourDomainName\YourUsername or azure\YourAzureStorageAccountName"
           $passCmdkeyArgument = New-Object Microsoft.Azure.Management.DataFactory.Models.SecureString("YourPassword or YourAccessKey")
           $setup = New-Object Microsoft.Azure.Management.DataFactory.Models.CmdkeySetup($addCmdkeyArgument, $userCmdkeyArgument, $passCmdkeyArgument)
	   }
	   if($ExpressCustomSetup -eq "SetEnvironmentVariable")
	   {
           $variableName = "YourVariableName"
           $variableValue = "YourVariableValue"
           $setup = New-Object Microsoft.Azure.Management.DataFactory.Models.EnvironmentVariableSetup($variableName, $variableValue)
	   }
	   if($ExpressCustomSetup -eq "SentryOne.TaskFactory")
	   {
           $licenseKey = New-Object Microsoft.Azure.Management.DataFactory.Models.SecureString("YourLicenseKey")
           $setup = New-Object Microsoft.Azure.Management.DataFactory.Models.ComponentSetup($ExpressCustomSetup, $licenseKey)
	   }
	   if($ExpressCustomSetup -eq "oh22is.SQLPhonetics.NET")
	   {
           $licenseKey = New-Object Microsoft.Azure.Management.DataFactory.Models.SecureString("YourLicenseKey")
           $setup = New-Object Microsoft.Azure.Management.DataFactory.Models.ComponentSetup($ExpressCustomSetup, $licenseKey)
	   }
	   if($ExpressCustomSetup -eq "oh22is.HEDDA.IO")
	   {
           $setup = New-Object Microsoft.Azure.Management.DataFactory.Models.ComponentSetup($ExpressCustomSetup)
	   }
       # Create an array of one or more express custom setups
       $setups = New-Object System.Collections.ArrayList
       $setups.Add($setup)

	   Set-AzDataFactoryV2IntegrationRuntime -ResourceGroupName $ResourceGroupName `
           -DataFactoryName $DataFactoryName `
           -Name $AzureSSISName `
           -ExpressCustomSetup $setups
   }
   Start-AzDataFactoryV2IntegrationRuntime -ResourceGroupName $ResourceGroupName `
       -DataFactoryName $DataFactoryName `
       -Name $AzureSSISName `
       -Force
   ```
   
   After your standard custom setup finishes and your Azure-SSIS IR starts, you can find the standard output of `main.cmd` and other execution logs in the `main.cmd.log` folder of your storage container.

1. To see some samples of standard custom setups, connect to our Public Preview container with Azure Storage Explorer.

   1. Under **(Local and Attached)**, right-click **Storage Accounts**, select **Connect to Azure storage**, select **Use a connection string or a shared access signature URI**, and then select **Next**.

      ![Connect to Azure storage with the Shared Access Signature](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image9.png)

   1. Select **Use a SAS URI** and enter the following SAS URI for the Public Preview container. Select **Next**, and then select **Connect**.

      `https://ssisazurefileshare.blob.core.windows.net/publicpreview?sp=rl&st=2018-04-08T14%3A10%3A00Z&se=2020-04-10T14%3A10%3A00Z&sv=2017-04-17&sig=mFxBSnaYoIlMmWfxu9iMlgKIvydn85moOnOch6%2F%2BheE%3D&sr=c`

      ![Provide the Shared Access Signature for the container](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image10.png)

   1. Select the connected Public Preview container and double-click the `CustomSetupScript` folder. In this folder are the following items:

      1. A `Sample` folder, which contains a custom setup to install a basic task on each node of your Azure-SSIS IR. The task does nothing but sleep for a few seconds. The folder also contains a `gacutil` folder, the whole content of which (`gacutil.exe`, `gacutil.exe.config`, and `1033\gacutlrc.dll`) can be copied as is into your container.

      1. A `UserScenarios` folder, which contains several custom setup samples from real user scenarios.

      ![Contents of the public preview container](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image11.png)

   1. Double-click the `UserScenarios` folder to find the following items:

      1. A `.NET FRAMEWORK 3.5` folder, which contains a custom setup to install an earlier version of the .NET Framework that might be required for custom components on each node of your Azure-SSIS IR.

      1. A `BCP` folder, which contains a custom setup to install SQL Server command-line utilities (`MsSqlCmdLnUtils.msi`), including the bulk copy program (`bcp`), on each node of your Azure-SSIS IR.

      1. An `EXCEL` folder, which contains a custom setup script (`main.cmd`) to install C# assemblies/libraries that you can use in Script Tasks to dynamically read/write Excel files on each node of your Azure-SSIS IR. First, download `ExcelDataReader.dll` from [here](https://www.nuget.org/packages/ExcelDataReader/) and `DocumentFormat.OpenXml.dll` from [here](https://www.nuget.org/packages/DocumentFormat.OpenXml/), then upload them all together with `main.cmd` into your container. Alternatively, if you just want to use the standard Excel Connection Manager/Source/Destination, the required Access Redistributable is already preinstalled on your Azure-SSIS IR, so you don't need any custom setup.
	  
	  1. A `MYSQL ODBC` folder, which contains a custom setup script (`main.cmd`) to install the MySQL ODBC drivers on each node of your Azure-SSIS IR. This setup lets you use the ODBC Connection Manager/Source/Destination to connect to MySQL server. First, download the latest 64-bit and 32-bit versions of MySQL ODBC driver installers - for example, `mysql-connector-odbc-8.0.13-winx64.msi` and `mysql-connector-odbc-8.0.13-win32.msi` - from [MySQL](https://dev.mysql.com/downloads/connector/odbc/), then upload them all together with `main.cmd` into your container.

      1. An `ORACLE ENTERPRISE` folder, which contains a custom setup script (`main.cmd`) and silent install config file (`client.rsp`) to install the Oracle connectors and OCI driver on each node of your Azure-SSIS IR Enterprise Edition. This setup lets you use the Oracle Connection Manager/Source/Destination to connect to Oracle server. First, download Microsoft Connectors v5.0 for Oracle (`AttunitySSISOraAdaptersSetup.msi` and `AttunitySSISOraAdaptersSetup64.msi`) from [Microsoft Download Center](https://www.microsoft.com/en-us/download/details.aspx?id=55179) and the latest Oracle client - for example, `winx64_12102_client.zip` - from [Oracle](https://www.oracle.com/technetwork/database/enterprise-edition/downloads/database12c-win64-download-2297732.html), then upload them all together with `main.cmd` and `client.rsp` into your container. If you use TNS to connect to Oracle, you also need to download `tnsnames.ora`, edit it, and upload it into your container, so it can be copied into the Oracle installation folder during setup.

      1. An `ORACLE STANDARD ADO.NET` folder, which contains a custom setup script (`main.cmd`) to install the Oracle ODP.NET driver on each node of your Azure-SSIS IR. This setup lets you use the ADO.NET Connection Manager/Source/Destination to connect to Oracle server. First, download the latest Oracle ODP.NET driver - for example, `ODP.NET_Managed_ODAC122cR1.zip` - from [Oracle](https://www.oracle.com/technetwork/database/windows/downloads/index-090165.html), then upload it together with `main.cmd` into your container.
	   
      1. An `ORACLE STANDARD ODBC` folder, which contains a custom setup script (`main.cmd`) to install the Oracle ODBC driver and configure DSN on each node of your Azure-SSIS IR. This setup lets you use the ODBC Connection Manager/Source/Destination or Power Query Connection Manager/Source with ODBC data source kind to connect to Oracle server. First, download the latest Oracle Instant Client (Basic Package or Basic Lite Package) and ODBC Package - for example, the 64-bit packages from [here](https://www.oracle.com/technetwork/topics/winx64soft-089540.html) (Basic Package: `instantclient-basic-windows.x64-18.3.0.0.0dbru.zip`, Basic Lite Package: `instantclient-basiclite-windows.x64-18.3.0.0.0dbru.zip`, ODBC Package: `instantclient-odbc-windows.x64-18.3.0.0.0dbru.zip`) or the 32-bit packages from [here](https://www.oracle.com/technetwork/topics/winsoft-085727.html) (Basic Package: `instantclient-basic-nt-18.3.0.0.0dbru.zip`, Basic Lite Package: `instantclient-basiclite-nt-18.3.0.0.0dbru.zip`, ODBC Package: `instantclient-odbc-nt-18.3.0.0.0dbru.zip`), then upload them all together with `main.cmd` into your container.

	  1. An `ORACLE STANDARD OLEDB` folder, which contains a custom setup script (`main.cmd`) to install the Oracle OLEDB driver on each node of your Azure-SSIS IR. This setup lets you use the OLEDB Connection Manager/Source/Destination to connect to Oracle server. First, download the latest Oracle OLEDB driver - for example, `ODAC122010Xcopy_x64.zip` - from [Oracle](https://www.oracle.com/partners/campaign/index-090165.html), then upload it together with `main.cmd` into your container.

	  1. A `POSTGRESQL ODBC` folder, which contains a custom setup script (`main.cmd`) to install the PostgreSQL ODBC drivers on each node of your Azure-SSIS IR. This setup lets you use the ODBC Connection Manager/Source/Destination to connect to PostgreSQL server. First, download the latest 64-bit and 32-bit versions of PostgreSQL ODBC driver installers - for example, `psqlodbc_x64.msi` and `psqlodbc_x86.msi` - from [PostgreSQL](https://www.postgresql.org/ftp/odbc/versions/msi/), then upload them all together with `main.cmd` into your container.

      1. A `SAP BW` folder, which contains a custom setup script (`main.cmd`) to install the SAP .NET connector assembly (`librfc32.dll`) on each node of your Azure-SSIS IR Enterprise Edition. This setup lets you use the SAP BW Connection Manager/Source/Destination to connect to SAP BW server. First, upload the 64-bit or the 32-bit version of `librfc32.dll` from the SAP installation folder together with `main.cmd` into your container. The script then copies the SAP assembly into the `%windir%\SysWow64` or `%windir%\System32` folder during setup.

      1. A `STORAGE` folder, which contains a custom setup to install Azure PowerShell on each node of your Azure-SSIS IR. This setup lets you deploy and run SSIS packages that run [PowerShell scripts to manipulate your Azure Storage account](https://docs.microsoft.com/azure/storage/blobs/storage-how-to-use-blobs-powershell). Copy `main.cmd`, a sample `AzurePowerShell.msi` (or use the latest version), and `storage.ps1` to your container. Use PowerShell.dtsx as a template for your packages. The package template combines an [Azure Blob Download Task](https://docs.microsoft.com/sql/integration-services/control-flow/azure-blob-download-task), which downloads `storage.ps1` as a modifiable PowerShell script, and an [Execute Process Task](https://blogs.msdn.microsoft.com/ssis/2017/01/26/run-powershell-scripts-in-ssis/)  that executes the script on each node.

      1. A `TERADATA` folder, which contains a custom setup script (`main.cmd`), its associated file (`install.cmd`), and installer packages (`.msi`). These files install the Teradata connectors, TPT API, and ODBC driver on each node of your Azure-SSIS IR Enterprise Edition. This setup lets you use the Teradata Connection Manager/Source/Destination to connect to Teradata server. First, download the Teradata Tools and Utilities 15.x zip file (for example,  `TeradataToolsAndUtilitiesBase__windows_indep.15.10.22.00.zip`) from [Teradata](http://partnerintelligence.teradata.com), then upload it together with the above `.cmd` and `.msi` files into your container.

      1. A `ZULU OPENJDK` folder, which contains a custom setup script (`main.cmd`) and PowerShell file (`install_openjdk.ps1`) to install Zulu OpenJDK on each node of your Azure-SSIS IR. This setup lets you use Azure Data Lake Store/Flexible File connectors to process ORC/Parquet files, see [here](https://docs.microsoft.com/sql/integration-services/azure-feature-pack-for-integration-services-ssis?view=sql-server-ver15#dependency-on-java) for more info. First, download the latest Zulu OpenJDK - for example, `zulu8.33.0.1-jdk8.0.192-win_x64.zip` - from [here](https://www.azul.com/downloads/zulu/zulu-windows/), then upload it together with `main.cmd` and `install_openjdk.ps1` into your container.

      ![Folders in the user scenarios folder](media/how-to-configure-azure-ssis-ir-custom-setup/custom-setup-image12.png)

   1. To try these custom setup samples, copy and paste the content from selected folder into your container.
   
      When you provision or reconfigure your Azure-SSIS IR with Data Factory UI, select the **Customize your Azure-SSIS Integration Runtime with additional system configurations/component installations** check box on the **Advanced Settings** section and enter the SAS URI of your container in the **Custom setup container SAS URI** field.
   
      When you provision or reconfigure your Azure-SSIS IR with PowerShell, run the `Set-AzDataFactoryV2IntegrationRuntime` cmdlet with the SAS URI of your container as the value for `SetupScriptContainerSasUri` parameter.

## Next steps

-   [Enterprise Edition of the Azure-SSIS Integration Runtime](how-to-configure-azure-ssis-ir-enterprise-edition.md)

-   [How to develop paid or licensed custom components for the Azure-SSIS integration runtime](how-to-develop-azure-ssis-ir-licensed-components.md)
