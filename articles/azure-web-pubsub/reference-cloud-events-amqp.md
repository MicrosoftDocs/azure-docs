---
title: Reference - CloudEvents AMQP extension for Azure Web PubSub
description: The reference describes CloudEvents AMQP extension defined for Azure Web PubSub service
author: ZitongYang
ms.author: zityang
ms.service: azure-web-pubsub
ms.topic: conceptual
ms.date: 09/23/2021
---

# CloudEvents AMQP extension for Azure Web PubSub

Service delivers client events to Event Hub event listeners using [CloudEvents AMQP protocol binding](https://github.com/cloudevents/spec/blob/v1.0.2/cloudevents/bindings/amqp-protocol-binding.md).

The data sending from service to server is always in CloudEvents `binary` format.

## Web PubSub CloudEvents attribute extension

<a name="extension"></a>

This extension defines attributes used by Web PubSub for every event it produces. Please note that each attribute name is prefixed with `cloudEvents:` according to CloudEvents specification.

| Name  | Description  | Example  |
| -- | -- | -- |
| `specversion`  | Cloud events specification version, is always 1.0  | 1.0  |
| `source`  | Indicates the hub and the connection ID where the event comes from, in the format "/hubs/{hub}/client/{connectionId}" | /hubs/chat/client/0bd83792-2a0c-48d3-9fbd-df63aa2ed9db |
| `id`  | An integer generated by the service, unique in the events from the same client connection  | 1  |
| `awpsversion`  | Cloud events Azure Web PubSub specification version, is always 1.0  | 1.0  |
| `hub`  | The hub name where the event comes from  | chat  |
| `eventname`  | The name of the event  | connected  |
| `connectionid`  | The ID of the client connection  | 0bd83792-2a0c-48d3-9fbd-df63aa2ed9db  |
| `time`  | The time when the service send the event, in the format "yyyy-MM-ddTHH:mm:ssZ"  | 2021-01-01T00:00:00Z  |
| `userid`\*  | The ID of user  | user1  |
| `subprotocol`\*  | The subprotocol name  | json.webpubsub.azure.v1  |
| `connectionstate`\* | Defines the state for the connection  | anystring  |
| `type`  | The event type  | azure.webpubsub.sys.connect  |
| `datacontenttype`  | Content type of message body  | application/json  |

The "\*" following the attribute name indicates the attribute is present only when the value is not null or empty.

## Events
<a name="events"></a>

This chapter shows the AMQP message body and the attribute values which depends on the client event type. Attributes whose values don't depend on client event type are omitted here.

- System `connect` event: Not supported by event listeners.
- [System `connected` event](#connected)
- [System `disconnected` event](#disconnected)
- [User events `message` for the simple WebSocket clients](#message)
- [User custom event `{custom_event}` for PubSub WebSocket clients](#custom_event)

### System `connected` event

<a name="connected"></a>

- `cloudEvents:type`: `azure.webpubsub.sys.connected`
- `cloudEvents:datacontenttype`: `application/json`
- `cloudEvents:eventname`: `connected`

The message body is always empty JSON.

```json
{}
```

### System `disconnected` event

<a name="disconnected"></a>

- `cloudEvents:type`: `azure.webpubsub.sys.disconnected`
- `cloudEvents:datacontenttype`: `application/json`
- `cloudEvents:eventname`: `disconnected`

The message body contains the reason why the client disconnects.

```json
{"reason":"{Reason}"}
```

### User events `message` for the simple WebSocket clients

<a name="message"></a>

- `cloudEvents:type`: `azure.webpubsub.user.message`
- `cloudEvents:datacontenttype`: `application/octet-stream` for binary frame; `text/plain` for text frame;

Message body is what the client sends.


### User custom event `{custom_event}` for PubSub WebSocket clients
<a name="custom_event"></a>

- `cloudEvents:type`: `azure.webpubsub.user.<event_name>`
- `cloudEvents:datacontenttype`: `application/octet-stream` for binary frame; `application/json` for JSON frame; `text/plain` for text frame; `application/x-protobuf` for Protobuf frame;

The following cases show how to send events with different data content types.

#### Case 1: send event with text data:
```json
{
    "type": "event",
    "event": "<event_name>",
    "dataType" : "text",
    "data": "text data"
}
```

#### Case 2: send event with JSON data:
```json
{
    "type": "event",
    "event": "<event_name>",
    "dataType" : "json",
    "data": {
        "hello": "world"
    },
}
```

#### Case 3: send event with binary data:
```json
{
    "type": "event",
    "event": "<event_name>",
    "dataType" : "binary",
    "data": "aGVsbG8gd29ybGQ=" // base64 encoded binary
}
```

## Next steps

> [!div class="nextstepaction"]
> [How to configure event listeners](./howto-develop-eventlistener.md)