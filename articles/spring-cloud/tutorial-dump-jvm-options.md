---
title: "Diagnostic settings of JVM options for advanced troubleshooting in Azure Spring Cloud"
description: Several best practice of JVM config to set heap dump, JFR, and GC logs.
author: YinglueZhang-MS
ms.author: yinglzh
ms.service: spring-cloud
ms.topic: how-to
ms.date: 10/31/2021
ms.custom: devx-track-java
---

# Tutorial: diagnostic settings of JVM options for advanced troubleshooting in Azure Spring Cloud

**This article applies to:** ✔️ Java ❌ C#

There are several JVM-based application startup parameters related to heap dump, JFR and GC Logs. In Azure Spring Cloud, we support to config JVM using jvm-options. In this article, we give several examples of them, which might be useful to our customers.

## Prerequisites
To complete this exercise, you need:

* A deployed Azure Spring Cloud service instance. Follow our [quickstart on deploying an app via the Azure CLI](./quickstart.md) to get started.
* At least one application already created in your service instance.
* At least one [persistent storage already bind on your app](how-to-built-in-persistent-storage.md) to save generated diagnostic files.

Users can follow the [deployment doc](https://docs.microsoft.com/cli/azure/spring-cloud/app/deployment?view=azure-cli-latest) to config JVM-based application startup parameters. We will give several examples in the following section. **What you need to do is adding the parameter in jvm-options.**

## Generate a heap dump when out of memory
```heap dump when OOM
   -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<PATH_TO_HEAP_DUMP_FOLDER> 
```
One could also give the specific name of the file. But only giving the folder path is highly recommended. Once the file name is given, it will only generate a heap dump in the first OOM. Due to hprof-format file cannot be covered, users will not be able get heap dump of the following OOM. If users only provide path to the folder, users will get heap dumps of all OOMs with an autogenerated name.

All the path user given below should be under the mount path of user's persistent storage already bind on customer's app.

## GC logs
We just give an example of how to use JVM options related to GC logs. You could go to official JVM doc for more information.
```GC Logs
   -XX:+PrintGCDetails -Xloggc:<PATH_TO_GC_LOG_FILE>
```

## JFR on exit
We just give an example of how to use JVM options related to JFR. You could go to official JVM doc for more information.
```JFR on exit
   -XX:StartFlightRecording=dumponexit=true,dumponexitpath=<PATH_TO_JFR_FILE>
```

## Path of generated file.
Pay attention that you should ensure the target path of your generated file should be in your persistent storage on your app. So that you can get the file in your storage.
For example, customers will give a json file when users firstly create persistent storage in Azure Spring Cloud.
```json
    {
       "customPersistentDisks": [
          {
              "storageName": "<storage-resource-name>",
              "customPersistentDiskProperties": {
                  "type": "AzureFileVolume",
                  "shareName": "<azure-file-share-name>",
                  "mountPath": "<unique-mount-path e.g. /test/Path>",
                  "mountOptions": [
                      "uid=0",
                      "gid=0"
                   ],
                   "readOnly": false 
                }
          },
          {
              "storageName": "<storage-resource-name>",
              "customPersistentDiskProperties": {
                  "type": "AzureFileVolume",
                  "shareName": "<azure-file-share-name>",
                  "mountPath": "<unique-mount-path e.g. /test/anotherPath>",
                  "readOnly": true
              }
          }
       ]
    }
```
Or customer may use the commands below to append the persistent storage.
    
```
   az spring-cloud app append-persistent-storage --persistent-storage-type AzureFileVolume --share-name <azure-file-share-name> --mount-path <unique-mount-path e.g. /test/Path> --storage-name <storage-resource-name> -n <app-name> -g <resource-group-name> -s <spring-instance-name>
```
   
   If customers want to have the dump under their own Azure file given above, please give <PATH_TO_HEAP_DUMP_FOLDER> as "/test/Path". If customers want to use path under mount path, please ensure that the sub-path have already been created.




