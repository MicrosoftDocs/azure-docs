---
author: karlerickson
ms.author: v-shilichen
ms.service: azure-spring-apps
ms.topic: include
ms.date: 10/02/2023
---

<!--
For clarity of structure, a separate markdown file is used to describe how to observe the application with Basic/Standard plan.

[!INCLUDE [application-observability-with-basic-standard-plan](includes/application-observability/application-observability-with-basic-standard-plan.md)]

-->

## Monitor the application

Azure Spring Apps provides several metrics by default, including metrics on availability, performance, HTTP requests, database connections, and more. These metrics are important to clarify goals, find improvements, and formulate specific improvement measures. For more information, see [Metrics for Azure Spring Apps](../../concept-metrics.md).

This section shows you how to use metrics with your application and monitor the metrics in an Azure dashboard using the key metrics charts generated by Azure Spring Apps and Application Insights.

### Add metrics to monitor resource utilization

This section explains how to use the default metrics defined by Spring Boot and custom metrics defined in the application code. These metrics are available for applications running on Azure Spring Apps.

#### Add metrics defined by Spring Boot

Spring Boot registers several metrics, such as JVM, web server, and logging-related metrics. The following steps show you how to add `JVM Memory` as an example, but to add other metrics defined by Spring Boot, you can use the same steps.

1. Go to the Azure Spring Apps instance overview page.

1. On the navigation menu, select **Application Insights** to go to the Application Insights overview page.

1. On the navigation menu, select **Metrics**, select the edit icon in the chart title, and then rename the chart title to *JVM Memory Used*.

1. Select **Add metric**. For **Metric**, open the corresponding dropdown list and select **jvm_memory_used** under the **Log-based metrics** namespace. For **Aggregation**, select **Avg**.

1. Select **Apply splitting**. For **Values**, open the corresponding dropdown list, and then select **Cloud role name**.

:::image type="content" source="../../media/application-observability/jvm-memory-used-chart.png" alt-text="Screenshot of the Azure portal that shows the Application Insights Metrics page with JVM Memory Used chart." lightbox="../../media/application-observability/jvm-memory-used-chart.png":::

> [!NOTE]
> The metrics are available after the application is deployed and running.

#### Add custom metrics defined in application code

In the PetClinic source code, the REST controllers are annotated with the micrometer `@Timed` annotation. This annotation collects metrics like the number of times a method is called or the execution time of a method.

The following list shows the custom metrics details:

- `petclinic.owner` and `petclinic.pet` are defined in the `customers-service` application.
- `petclinic.visit` is defined in the `visits-service` application.

You can define a `REST API access` chart with custom metrics and update the **Aggregation** to **Count** for each metric.

:::image type="content" source="../../media/application-observability/custom-metrics.png" alt-text="Screenshot of the Azure portal that shows the Application Insights Metrics page with REST API access chart." lightbox="../../media/application-observability/custom-metrics.png":::

### Monitor the availability of the application

The availability or liveness of an application is determined using the Spring Boot Actuator. To check the liveness for each app on Azure Spring Apps, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the navigation menu, select **Application Insights** to go to the Application Insights overview page.

1. Select **Availability**, and then select **Add Standard test** to add a test.

1. On the **Create Standard test** page, provide the following information:

   - **Test name**: Enter **api-gateway** for the API gateway app.
   - **URL**: Enter **https://\<your-Azure-Spring-Apps-instance-name>-api-gateway.azuremicroservices.io/actuator/health/liveness** for the corresponding URL.
   - **Success criteria**: Extend the option.
   - **Content match**: Select the checkbox.
   - **Content must contain**: Enter **UP**.

1. Select **Save** to finish the configuration.

1. Use the following table to add other tests with these test names and URLs. Make sure the test name and app name are consistent.

   | Test name           | URL                                                                                                                      | Content must contain   |
   |---------------------|--------------------------------------------------------------------------------------------------------------------------|------------------------|
   | `admin-server`      | `https://<your-Azure-Spring-Apps-instance-name>-admin-server.azuremicroservices.io/actuator/health/liveness`             | `UP`                   |
   | `customers-service` | `https://<your-Azure-Spring-Apps-instance-name>-api-gateway.azuremicroservices.io/api/customer/actuator/health/liveness` | `UP`                   |
   | `vets-service`      | `https://<your-Azure-Spring-Apps-instance-name>-api-gateway.azuremicroservices.io/api/vet/actuator/health/liveness`      | `UP`                   |
   | `visits-service`    | `https://<your-Azure-Spring-Apps-instance-name>-api-gateway.azuremicroservices.io/api/visit/actuator/health/liveness`    | `UP`                   |

### Monitor the dashboard

A dashboard is a cognitive awareness and communication tool designed to help you visually identify trends, patterns, and anomalies, reason about what you see, and make effective decisions. It can aggregate various metric charts, quick links, and other important information.

Use the following steps to create a custom dashboard and pin various quickstart panes and metrics charts to the dashboard. If you choose to use the built-in dashboard for Application Insights created by Azure Spring Apps, you can skip creating the dashboard and customizing the dashboard chart. For more information, see [Application Insights Overview dashboard](/azure/azure-monitor/app/overview-dashboard).

> [!NOTE]
> You can also choose a wizard based on Application Insights to quickly create a default dashboard.

1. From the Azure portal menu, select **Dashboard**. Your default view might already be set to dashboard.

1. Select **Create**, and then select **Custom** to create a custom dashboard.

1. Enter a name for the dashboard, and then select **Save**.

   This action opens the **Tile Gallery** page, from which you can select the tiles, and an empty grid where you can arrange the tiles.

> [!NOTE]
> You can allow other users to view your dashboard using a shared dashboard. For more information, see [Share an Azure dashboard](/azure/azure-portal/azure-portal-dashboard-share-access).

#### Basic monitoring

The most fundamental metrics for an application, especially a microservices application, are CPU usage, memory usage, liveness detection, and network traffic. These metrics provide an important basis for evaluating application scalability.

Use the following instructions to pin the various charts to the dashboard. These steps are similar for each chart. For some charts, additional instructions are provided.

##### Pin the "App CPU Usage" chart

To pin the "App CPU Usage" chart, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the navigation menu, select **Metrics**, select the edit icon in the chart title, and then rename the chart title to *App CPU Usage*.

1. Select **Add metric**. For **Metric**, open the corresponding dropdown list and select **App CPU Usage**. For **Aggregation**, select **Avg**.

1. Select **Apply splitting**. For **Values**, open the corresponding dropdown list and then select **App**.

   :::image type="content" source="../../media/application-observability/chart-app-cpu-usage.png" alt-text="Screenshot of the Azure portal that shows the Azure Spring Apps Metrics page with the App CPU Usage chart." lightbox="../../media/application-observability/chart-app-cpu-usage.png":::

1. Select **Save to dashboard** to open the dropdown list, then select **Pin to dashboard**.

1. On the **Pin to dashboard** page, select the dashboard you created, and then select **Pin** to pin the chart to the dashboard.

##### Pin the "App Memory Usage" chart

To pin the **App Memory Usage** chart to the dashboard, use the steps in the previous section.

:::image type="content" source="../../media/application-observability/chart-app-memory-usage.png" alt-text="Screenshot of the Azure portal that shows the Azure Spring Apps Metrics page with the App Memory Usage chart." lightbox="../../media/application-observability/chart-app-memory-usage.png":::

##### Pin the "App Network In" chart

To pin the "App Network In" chart, use the steps in the [Pin the "App CPU Usage" chart](#pin-the-app-cpu-usage-chart) section, but include the following steps:

1. On the **Metrics** page, select **Add filter**.

1. For **Property**, open the corresponding dropdown list and then select **App**.

1. For **Operator**, select **=**.

1. For **Values**, select **admin-server** and **api-gateway**.

:::image type="content" source="../../media/application-observability/chart-app-network-in-usage.png" alt-text="Screenshot of the Azure portal that shows the Azure Spring Apps Metrics page with the App Network In chart." lightbox="../../media/application-observability/chart-app-network-in-usage.png":::

##### Pin the "Availability" chart

To pin the "Availability" chart, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the navigation menu, select **Application Insights** to go to the Application Insights overview page.

1. On the navigation menu, select **Metrics**, select the edit icon in the chart title, and then rename the chart title to **Availability**.

1. Select **Add metric**.

1. For **Metric**, open the corresponding dropdown list and select **Availability** under the **Application Insights standard metrics** namespace. Then, for **Aggregation**, select **Avg**.

1. Select **Apply splitting**. For **Values**, open the corresponding dropdown, select **Test name**, and then save the **Availability** chart to the dashboard.

:::image type="content" source="../../media/application-observability/chart-availability.png" alt-text="Screenshot of the Azure portal that shows the Application Insights Metrics page with the Availability chart." lightbox="../../media/application-observability/chart-availability.png":::

#### HTTP request monitoring

The key data recorded in the process of the application serving users includes the number of HTTP requests, response time, abnormal requests, and failed requests. This data can help you find out whether the application is providing services normally, which directly affects the service level of the application.

##### Pin the "Server exceptions and Dependency call failures" chart

To pin the "Server exceptions and Dependency call failures" chart, use the steps from the [Pin the "Availability" chart](#pin-the-availability-chart) section. The **Server exception** and **Dependency call failures** metrics are under the **Application Insights standard metrics** namespace.

:::image type="content" source="../../media/application-observability/chart-exceptions-and-failures.png" alt-text="Screenshot of the Azure portal that shows the Application Insights Metrics page with the Server exceptions and Dependency call failures chart." lightbox="../../media/application-observability/chart-exceptions-and-failures.png":::

##### Pin the "Failed requests" chart

To pin the "Failed requests" chart, use the steps from the [Pin the "Availability" chart](#pin-the-availability-chart) section. The **Failed requests** metric is under the **Application Insights standard metrics** namespace.

:::image type="content" source="../../media/application-observability/chart-failed-requests.png" alt-text="Screenshot of the Azure portal that shows the Application Insights Metrics page with the Failed requests chart." lightbox="../../media/application-observability/chart-failed-requests.png":::

##### Pin the "Request count" chart

To pin the "Request count" chart, use the steps from the [Pin the "Availability" chart](#pin-the-availability-chart) section, but include the following steps. The **Server requests** metric is under the **Application Insights standard metrics** namespace.

1. Add a filter to filter the **Cloud role name** with **api-gateway** and **admin-server**.

1. Apply splitting for **Values** with **Cloud role name**.

:::image type="content" source="../../media/application-observability/chart-request-count.png" alt-text="Screenshot of the Azure portal that shows the Application Insights Metrics page with the Request count chart." lightbox="../../media/application-observability/chart-request-count.png":::

##### Pin the "Response time" chart

To pin the "Response time" chart, use the steps from the [Pin the "Availability" chart](#pin-the-availability-chart) section, but add a filter to filter the **Cloud role name** with **api-gateway**. The **Server response time** metric is under the **Application Insights standard metrics** namespace.

:::image type="content" source="../../media/application-observability/chart-response-time.png" alt-text="Screenshot of the Azure portal that shows the Application Insights Metrics page with the Response time chart." lightbox="../../media/application-observability/chart-response-time.png":::

#### Database performance monitoring

Database performance is the cornerstone of normal service for all applications. There are many application performance downgrades caused by a slow database or exhausted database connection pool. It's necessary to ensure that the performance at the database level meets expectations, otherwise, it causes chained issues.

#### Pin the "Active MySQL connections" chart

To pin the "Active MySQL connections" chart, use the steps from the [Pin the "Availability" chart](#pin-the-availability-chart) section. The **hikaricp_connection_active** metric is under the **Log-based metrics** namespace.

:::image type="content" source="../../media/application-observability/chart-connection-active.png" alt-text="Screenshot of the Azure portal that shows the Application Insights Metrics page with the Active MySQL connections chart." lightbox="../../media/application-observability/chart-connection-active.png":::

#### Pin content from a resource page

Pin some commonly used links into the dashboard. These links let you quickly open the operation page on Azure or other resource pages.

To pin common panes of the Azure portal to the dashboard, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the navigation menu, select **Application Insights** to go to the Application Insights overview page.

1. On the navigation menu, select **Application map**, and select the **Pin blade to dashboard** icon in each page header.

1. On the **Pin to dashboard** page, select the dashboard you created, and then select **Pin** to pin the quickstart chart to the dashboard.

   :::image type="content" source="../../media/application-observability/pin-application-map-blade-to-dashboard.png" alt-text="Screenshot of the Azure portal that shows the Application map page with the Pin to dashboard pane open." lightbox="../../media/application-observability/pin-application-map-blade-to-dashboard.png":::

1. Repeat these steps to pin the **Live metrics**, **Failures**, and **Performance** panes to your dashboard as needed.

#### View the dashboard

To view the dashboard, go to your private PetClinic dashboard page to edit the tiles in the dashboard for easy monitoring.

:::image type="content" source="../../media/application-observability/dashboard-page.png" alt-text="Screenshot of the Azure portal that shows the sample application's private dashboard page." lightbox="../../media/application-observability/dashboard-page.png":::

## Manage alerts

Alerts help you detect and address issues before users notice them by proactively notifying you when the metrics or logs indicate there might be a problem with your infrastructure or application.

This section explains how to set up action groups and alert rules to monitor your production application. The alert rules bind metric patterns with the action groups on the target resource. When the metric pattern matches the condition, then the alert rule activates and executes the associated set of actions.

### Set up an action group

To set up an action group, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the navigation menu, select **Alert**, select **Action groups** to go to the action groups list page, and then select **Create** to create an action group.

1. On the **Create action group** page, select the subscription and resource group you want to cover. Enter the following information:

   - **Action group name**: Enter **email-notification**.
   - **Short name**: Enter **email**.
   - **Region**: Select the region you want to use.

1. Navigate to the **Notification** tab on the **Create action group** page. For **Notification type**, select **Email/SMS message/Push/Voice**. For **Name**, enter **email-support**.

1. On the **Email/SMS message/Push/Voice** page, select **Email**, enter your production email address, and then select **OK** to finish the configuration. You can also add other notification types if you want, such as SMS, Azure mobile app notification, Voice, and so on.

   :::image type="content" source="../../media/application-observability/email-action-creation.png" alt-text="Screenshot of the Azure portal that shows the Create action group page with the Email/SMS message/Push/Voice pane open." lightbox="../../media/application-observability/email-action-creation.png":::

1. Select **Review and Create** to review your selections. Select **Create** to create the action group.

### Set up an alert rule

To set up an alert rule, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the navigation menu, select **Alert**, select **Alert rules** to go to the Alert rules list page, and then select **Create** to create an alert rule.

1. On the **Create an alert rule** page, for **signal name**, open the dropdown list, and then select **See all signals**.

1. In the **Metrics** area, select **App CPU Usage**, and then select **Apply**.

1. In the alert logic section, use the following inputs:

   - For threshold type, select **Static**.
   - For **Aggregation type**, select **Average**.
   - For **Operator**, select **Greater than**.
   - For **Threshold value**, enter **90**.

1. In the **Split by dimensions** section, use the following inputs:

   - For **Dimension name**, select **App**.
   - For **Operator**, use the default **=**.
   - For **Dimension values**, select **Select all**.
   - For **When to evaluate**, keep the default value.

   :::image type="content" source="../../media/application-observability/alert-rule-creation-app-cpu-usage.png" alt-text="Screenshot of the Azure portal that shows the Create an alert rule page." lightbox="../../media/application-observability/alert-rule-creation-app-cpu-usage.png":::

1. Navigate to the **Actions** tab on the **Create an alert rule** page, and then select **Select action groups**.

1. On the **Select action groups** page, search for your email action group name, such as **email-notification**. Select the corresponding action group, and then select **Select** to finish the configuration.

1. Navigate to the **Details** tab on the **Create an alert rule** page.

1. For **Alert rule name**, enter **app-cpu-high-alert**.

1. Select **Review and Create** to review your selections. Select **Create** to create the alert rule.

1. To create an alert rule for **App Memory Usage** metric signal, use the following inputs:

   - **Signal name**: *App Memory Usage*
   - **Threshold value**: **90**
   - **Dimension name**: **App**
   - **Dimension values**: Select all
   - **Action group name**: **email-notification**
   - **Alert rule name**: **app-memory-high-alert**

1. To create an alert rule for **App Network In** metric signal, use the following inputs:

   - **Signal name**: *App Network In*
   - **Unit**: **GB**
   - **Threshold value**: **1**
   - **Dimension name**: **App**
   - **Dimension values**: **api-gateway**
   - **Action group name**: **email-notification**
   - **Alert rule name**: **network-in-high-alert**

1. After you've created all the alert rules, you can view the alert rules list.

   :::image type="content" source="../../media/application-observability/alert-rule-list.png" alt-text="Screenshot of the Azure portal that shows the Alert rules page." lightbox="../../media/application-observability/alert-rule-list.png":::

### Pin alerts to the dashboard

To pin the quickstart chart to the dashboard, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the navigation menu, select **Alert**, and then select the **Pin blade to dashboard** icon.
