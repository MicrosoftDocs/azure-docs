---
title: Monitor Azure virtual machines with Azure Monitor
description: Describes how to collect and analyze monitoring data from virtual machines in Azure using Azure Monitor.
ms.service:  azure-monitor
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 10/08/2019

---

# Monitoring Azure virtual machines with Azure Monitor
Virtual machines can be monitored for availability and performance with Azure Monitor like any [other Azure resource](monitor-azure-resource.md), but they're unique from other resources since you also need to monitor the guest operating and system and the workloads that run in it. This article describes how to use Azure Monitor to collect monitoring data from Azure VMs and to analyze and alert on this data to maintain the health and performance of your virtual machines. 

> [!NOTE]
> This article provides a complete overview of the concepts and options for monitoring virtual machines in Azure Monitor. To start monitoring your virtual machines quickly without focusing on the underlying concepts, see [Quickstart: Monitor an Azure virtual machine with Azure Monitor](../learn/quick-monitor-azure-vm.md).


## Differences from other Azure resources
[Monitoring Azure resources with Azure Monitor](monitor-azure-resource.md) describes the monitoring data generated by Azure resources and how you can use the features of Azure Monitor to analyze and alert on this data. You can collect and act on the same monitoring data from Azure virtual machines with the following differences:

- [Platform metrics](../platform/data-platform-metrics.md) are collected automatically collected for virtual machines but only for the [virtual machine host](#host-monitoring). You need an agent to collect performance data from the guest operating system. 
- Virtual machines don't generate [resource logs](platform-logs-overview.md) which provide insight into operations that were performed within an Azure resource. You need an agent to log data from the guest operating system.
- You can create [diagnostic settings](../platform/diagnostic-settings.md) for a virtual machine to send metrics to other destinations such as storage and event hubs, but you can't configure these diagnostic settings in the Azure portal. The **Diagnostics setting** option in the virtual machine menu in the portal is for configuring the [diagnostics extension](), not for configuring diagnostic settings.

## Monitoring data
Virtual machines in Azure in Azure generate [logs](../platform/data-platform-logs.md) and [metrics](../platform/data-platform-metrics.md) shown the following diagram.

![Overview](media/monitor-vm-azure/logs-metrics.png)


### Host
Virtual machines in Azure generate the same Activity log and platform metrics for the host as other Azure resources as described in [Monitoring data](monitor-azure-resource.md#monitoring-data). 

- [Platform metrics](../platform/data-platform-metrics.md) - Numerical values that are automatically collected at regular intervals and describe some aspect of a resource at a particular time. Platform metrics are collected for the virtual machine host, but you require the Azure Diagnostics extension to collect metrics for the guest operating system.
- [Activity log](../platform/platform-logs-overview.md) - Provides insight into the operations on each Azure resource in the subscription from the outside (the management plane). For a virtual machine, this includes such information as when it was started and when any configuration changes were made to the host.


### Guest
To collect data from the guest operating system of a virtual machine, you require an agent. The agent runs locally on each virtual machine and sends data to Azure Monitor. Multiple agents are available for Azure Monitor with each collecting different data and writing data to different locations. Which agents you use will depend on your particular requirements. Get a detailed comparison of the different agents at [Overview of the Azure Monitor agents](../platform/agents-overview.md). 

- [Log Analytics agent](../platform/agents-overview.md#log-analytics-agent) - Available for virtual machines in Azure, other cloud environments, and on-premises. Collects data to Azure Monitor Logs. Supports Azure Monitor for VMs and monitoring solutions. This is the same agent used for System Center Operations Manager.
- [Dependency agent](../platform/agents-overview.md#dependency-agent) - Collects data about the processes running on the virtual machine and their dependencies. Relies on the Log Analytics agent and supports Azure Monitor for VMs and the Service Map solution.
- [Azure Diagnostic extension](../platform/agents-overview.md#azure-diagnostic-extension) - Available for Azure Monitor virtual machines only. Can collect data to mulitple locations but primarily used to collect guest performance data into Azure Monitor Metrics.
- [Telegraf agent](../platform/collect-custom-metrics-linux-telegraf.md) - Collect performance data from Linux VMs into Azure Monitor Metrics.


## Configuration requirements
The typical process for monitoring virtual machines in Azure is as follows:

1. [Enable Azure Monitor for VMs](#enable-azure-monitor-for-vms-preview) which installs the Log Analytics agent and Dependency agent.
2. [Configure Log Analytics workspace](#configure-log-analytics-workspace) to collect additional data from the guest.
3. [Install the diagnostics extension](#enable-diagnostics-extension) to collect data to Azure Metrics and optionally other destinations.
4. Configure collection of platform metrics and Activity logs for the virtual machine host.

### Enable Azure Monitor for VMs (preview)
[Azure Monitor for VMs](vminsights-overview.md) is an [insight](insights-overview.md) in Azure Monitor that is your primary tool for monitoring virtual machines in Azure Monitor. It provides the following additional value over standard Azure Monitor features.

- Simpified onboarding of Log Analytics agent and Dependency agent to enable monitoring of a virtual machine guest operating system and workloads. 
- Pre-defined trending performance charts and workbooks that allow you to analyze core performance metrics from the guest VM operating system.
- Dependency map that displays processes running on each VM the interconnected components with the VM from various resource groups and subscriptions.

See [Enable Azure Monitor for VMs (preview) overview](vminsights-enable-overview.md) for details on enabling Azure monitor for VMs.

![Azure Monitor for VMs](media/monitor-vm-azure/vminsights-01.png)

![Azure Monitor for VMs](media/monitor-vm-azure/vminsights-02.png)

### Configure Log Analytics workspace
Azure Monitor for VMs enables the collection of a predetermined set of performance counters that are written to the *InsightsMetrics* table. This is the same table used by [Azure Monitor for Containers](container-insights-overview.md). 

Enable the collection of additional performance data, events, and other monitoring data from the agent by configuring the Log Analytics workspace. The workspace only needs to be configured once. Any agent connecting to the workspace will automatically download the configuration and immediately start collecting the defined data. 

You can access the advanced settings for the workspace directly from Azure Monitor for VMs by selecting **Workspace configuration** from the **Get Started** tab in **Azure Monitor for VMs**. See [Agent data sources in Azure Monitor] (../platform/agent-data-sources.md) for a list of the data sources available and how you can configure them.

![Workspace configuration](media/monitor-vm-azure/workspace-configuration.png)


> [!NOTE]
> Performance data collected by Azure Monitor for VMs and the Log Analytics agent are sent to a Log Analytics workspace where they can be accessed by all features supported by [Azure Monitor Logs](../platform/data-platform-logs.md). To send this data to [Azure Monitor Metrics](../platform/data-platform-metrics.md), you must install the [diagnostics extension](../platform/diagnostics-extension-overview.md) on the VM in addition to the Log Analytics agent.


### Enable diagnostics extension
Azure Monitor for VMs is based on the Log Analytics agent that collects data into a Log Analytics workspace which supports multiple features of Azure Monitor such as [log queries](), [log alerts](), and [workbooks](). You need to collect data into [Azure Monitor Metrics](../platform/data-platform-metrics.md) to enable other features such as [metrics explorer](../platform/metrics-getting-started.md) and [metrics alerts](../platform/alerts-metric.md). 

The [diagnostics extension](../platform/diagnostics-extension-overview.md) collects performance data from the guest operating system to Azure Storage and optionally sends performance data to Azure Monitor Metrics and events and performance data outside of Azure Monitor using Azure Event Hubs or to Azure Storage data for archiving.

Enable the diagnostics extension for a single VM in the Azure portal from the **Diagnostics setting** option in the VM menu. To enable it from a template or command line for multiple VMs, see [Installation and configuration](../platform/diagnostics-extension-overview.md#installation-and-configuration). Unlike the Log Analytics agent, the data to collect and that data's destination is defined in the configuration for the extension on each VM.

![Diagnostic setting](media/monitor-vm-azure/diagnostic-setting.png)

### Diagnostic settings
[Diagnostic settings](../platform/diagnostic-settings.md) are used by Azure resources to send data to monitoring data to one or more destinations. For the guest operating system of an Azure VM, this functionality is provided by the Log Analytics agent and diagnostics extension. While Azure VMs don't have resource logs like other Azure resources, they do use diagnostic settings to send host metrics and Activity logs to destinations. The only 


## Monitoring in the Azure portal 
You have multiple options for accessing monitoring data collected for virtual machines in the Azure portal. Analyze data for a single virtual machine from its menu in the Azure portal. Use the **Azure Monitor** menu to access data from all monitored resources. Azure Monitor for VMs provides an effective interface for monitoring sets of virtual machines at scale.

The following table lists different options for monitoring each virtual machines in its menu in the Azure portal.

| Menu option | Description |
|:---|:---|
| Overview | Displays [platform metrics]() for the virtual machine host. Click on a graph to work with this data in [metrics explorer](). |
| Activity log | [Activity log]() entries filtered for the current virtual machine. |
| Insights (preview) | Opens [Azure Monitor for VMs]() with the map for the current virtual machine selected. |
| Alerts | Views [alerts](#alerts) for the current virtual machine.  |
| Metrics | Open [metrics explorer]() with the scope set to the current virtual machine. |
| Diagnostic settings | Enable and configure [diagnostics extension]() for the current virtual machine. |
| Advisor recommendations | Recommendations for the currentl virtual machine from [Azure Advisor](/azure/advisor/). |
| Logs | Open [Log Analytics]() with the [scope]() set to the current virtual machine. |
| Connection monitor | Open [Network Watcher Connection Monitor](../network-watcher/connection-monitor-preview.md) to monitor connections between the current virtual machine and other virtual machines. |

## Analyzing metric data
You can analyze metrics for virtual machines using metrics explorer by opening **Metrics** from the virtual machine's menu. See [Getting started with Azure Metrics Explorer](../platform/metrics-getting-started.md) for details on using this tool. 

There are two namespaces used by virtual machines for metrics:

| Namespace | Description |
|:---|:---|
| Virtual Machine Host | Host metrics automatically collected for all Azure virtual machines. Detailed list of metrics at [Microsoft.Compute/virtualMachines](../platform/metrics-supported.md#microsoftcomputevirtualmachines). |
| Virtual Machine Guest | Guest operating system metrics collected from virtual machines with diagnostics extension installed and configured to send to Azure Monitor sink. |

## Analyzing log data
Azure virtual machines will collect the following data to Azure Monitor Logs. Data in Azure Monitor Logs is stored in tables with each table having its own set of unique properties.


| Data source | Requirements | Tables |
|:---|:---|:---|
| Azure Monitor for VMs | InsightsMetrics<br>VMBoundPort<br>VMComputer<br>VMConnection<br>VMProcess<br>See [How to query logs from Azure Monitor for VMs](vminsights-log-search#sample-log-searches.md) for details. |
| Activity log | Diagnostic setting for the subscription. | AzureActivity |
| Host metrics | Diagnostic setting for the virtual machine. | AzureMetrics |
| Data sources from the guest operating system | Enable Log Analytics agent and configure data sources. | See documentation for each data source. |


## Next steps

* See [Supported services, schemas, and categories for Azure Resource Logs](../platform/diagnostic-logs-schema.md) for details of resource logs for different Azure services.  
