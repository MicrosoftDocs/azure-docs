---
title: Use PowerShell to onboard Azure Security Center and protect your network | Microsoft Docs
description: This document walks you through the process of onboarding Azure Security Center using PowerShell cmdlets.
services: security-center
documentationcenter: na
author: rkarlin
manager: MBaldwin
editor: ''

ms.assetid: e400fcbf-f0a8-4e10-b571-5a0d0c3d0c67
ms.service: security-center
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 9/12/2018
ms.author: rkarlin

---
# Onboard Azure Security Center using PowerShell

You can securing your Azure workloads programmatically, using the Azure Security Center  PowerShell module.
Many administrators are looking for ways to automate tasks to both and avoid the human error inherent in manual tasks, and take advantage of the potential for duplicative work. This is especially useful in large-scale deployments that involve dozens of subscriptions with hundreds and thousands of resources – all of which must be secured from the beginning.

Onboarding Azure Security Center using PowerShell enables you to programmatically automate onboarding and management of your Azure resources and add the necessary security controls.

This article provides a sample PowerShell script that can be modified and used in your network to roll out Security Center across your subscriptions. 

In this example, we will enable Security Center on a subscription with ID: d07c0080-170c-4c24-861d-9c817742786c and apply the recommended settings that provide a high level of protection, by implementing the Standard tier of Security Center, which provides advanced threat protection and detection capabilities:
1.	Set the [`ASC standard` level of protection](https://azure.microsoft.com/pricing/details/security-center/). 
2.	Set the Log Analytics workspace to which the Microsoft Monitoring Agent will send the data it collects on the VMs associated with the subscription – in our case, an existing user defined workspace (myWorkspace). (Learn more about this setting)
3.	Activate Security Center’s automatic agent provisioning which deploys to Microsoft Monitoring Agent.  (Learn more about this setting)
4.	Set the organization’s CISO as the security contact for ASC alerts and notable events.  (Learn more about this setting)
5.	Assign Security Center’s default security policies. (Learn more about this setting)

## Pre-requesities

These steps should be performed before you run the Security Center cmdlets:

1.	Run PowerShell as admin
2.	Install-Module -Name PowerShellGet -Force
3.	Set-ExecutionPolicy -ExecutionPolicy AllSigned
4.	Import-Module PowerShellGet
5.	Install-Module -Name AzureRM.profile -RequiredVersion 5.5.0
6.	Restart PowerShell
7.	Install-Module -Name AzureRM.Security -AllowPrerelease -Force

a.	Register your subscriptions to the Security Center Resource Provider
Set-AzureRmContext -Subscription "d07c0080-170c-4c24-861d-9c817742786c”
Register-AzureRmResourceProvider -ProviderNamespace ‘Microsoft.Security’ 

b.	Set the coverage level (pricing tier) of the subscriptions (optional. If not defined, the pricing tier will be free)
Set-AzureRmContext -Subscription "d07c0080-170c-4c24-861d-9c817742786c”
Set-AzureRmSecurityPricing -Name "default" -PricingTier "Standard"

c.	Configure the workspace to which the agents will report to (optional. If not defined, the default workspace will be used)
Prerequisite: Create a Log Analytics workspace to which the subscription’s VMs will report to. You can define multiple subscriptions to report to the same workspace.
Set-AzureRmSecurityWorkspaceSetting -Name "default" -Scope "/subscriptions/d07c0080-170c-4c24-861d-9c817742786c" -WorkspaceId "/subscriptions/d07c0080-170c-4c24-861d-9c817742786c/resourceGroups/myRg/providers/Microsoft.OperationalInsights/workspaces/myWorkspace"
d.	Define automatic provisioning of the Microsoft Monitoring Agent on your Azure VMs (optional. If not automatic, the agent can be manually installed)
Set-AzureRmContext -Subscription "d07c0080-170c-4c24-861d-9c817742786c”
Set-AzureRmSecurityAutoProvisioningSetting -Name "default" -EnableAutoProvision

e.	Define security contact details (optional)
It is highly recommended you define the security contact details for the subscriptions you onboard, as these contacts will be used as the recipients of alerts and notifications generated by Security Center.
Set-AzureRmSecurityContact -Name "default1" -Email "CISO@my-org.com" -Phone "2142754038" -AlertsAdmin -NotifyOnAlert 

f.	Assign the default Security Center policy initiative
Register-AzureRmResourceProvider -ProviderNamespace 'Microsoft.PolicyInsights'
$Policy = Get-AzureRmPolicySetDefinition -Name ' [Preview]: Enable Monitoring in Azure Security Center'
 New-AzureRmPolicyAssignment -Name 'ASC Default <d07c0080-170c-4c24-861d-9c817742786c>' -DisplayName 'Security Center Default <subscription ID>' -PolicySetDefinition $Policy -Scope ‘/subscriptions/d07c0080-170c-4c24-861d-9c817742786c’
You can now use the official PowerShell cmdlets with automation scripts to programmatically iterate on multiple subscriptions/resources , reducing the overheard caused by manually performing these actions, as well as reduce the potential risk of human error resulting from manual actions. You can use this sample script as reference.
To learn more about how you can use PowerShell to automate onboarding to Security Center, visit our documentation





## See also
To learn more about recommendations that apply to other Azure resource types, see the following:

* [Protecting your virtual machines in Azure Security Center](security-center-virtual-machine-recommendations.md)
* [Protecting your applications in Azure Security Center](security-center-application-recommendations.md)
* [Protecting your Azure SQL service in Azure Security Center](security-center-sql-service-recommendations.md)

To learn more about Security Center, see the following:

* [Setting security policies in Azure Security Center](security-center-policies.md) -- Learn how to configure security policies for your Azure subscriptions and resource groups.
* [Managing and responding to security alerts in Azure Security Center](security-center-managing-and-responding-alerts.md) -- Learn how to manage and respond to security alerts.
* [Azure Security Center FAQ](security-center-faq.md) -- Find frequently asked questions about using the service.
