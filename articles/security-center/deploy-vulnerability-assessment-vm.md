---
title: VM vulnerability assessment in Azure Security Center | Microsoft Docs
description: Install a vulnerability assessment solution on your Azure Virtual Machines to get recommendations in Azure Security Center that can help you protect your virtual machines.
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.service: security-center
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/20/2020
ms.author: memildin

---
# Vulnerability assessments for your Azure Virtual Machines

A core component of every cyber risk and security program is the identification and analysis of vulnerabilities. Azure Security Center's standard pricing tier includes vulnerability scanning for your virtual machines at no extra cost. Additionally, Security Center can automatically deploy this tool for you.

This page explains: 

> [!div class="checklist"]
> - The options you have when deciding on a vulnerability assessment solution
> - How the Security Center vulnerability assessment extension (powered by Qualys) included with standard tier works
> - How to deploy any vulnerability assessment solution to your virtual machines (VMs)


## Security Center's recommendation to deploy vulnerability assessment

When Security Center discovers a connected VM without a vulnerability assessment solution deployed, it provides a security recommendation: **A vulnerability assessment solution should be enabled on your virtual machines**.

Use this recommendation to deploy the vulnerability assessment solution that best meets your needs and budget:

- **Standard tier users** - Only customers using Security Center's standard tier have the option to install an integrated vulnerability assessment extension (powered by Qualys) at no additional cost. This extension reports its findings directly back to Security Center. Learn more about the activities of this scanner in [How the integrated vulnerability scanner works](#how-the-integrated-vulnerability-scanner-works).

- **All customers** - If you have a private license (BYOL) for a vulnerability assessment solution from a supported third-party you can deploy your preferred tool. You'll retain responsibility for licensing costs and configuration. The advantages of deploying a BYOL tool through Security Center are:
    - Security Center can monitor for machines that are missing the tool.
    - You'll be able to view findings and manage all of your security issues within Security Center.


## Overview of the integrated vulnerability scanner

The vulnerability scanner included with Azure Security Center is powered by Qualys. Qualys' scanner is the leading tool for real-time identification of vulnerabilities in your Azure Virtual Machines. It's only available to users on the standard pricing tier. You don't need a Qualys license or even a Qualys account - everything's handled seamlessly inside Security Center.

### Availability

- Release state: **Generally Available**
- Required roles: **Resource owner** can deploy the scanner. **Security reader** can view findings.
- Clouds: 
  ✔ Commercial clouds
  ✘ National/Sovereign (US Gov, China Gov, Other Gov)

### How the integrated vulnerability scanner works

The vulnerability scanner extension works as follows:

1. **Deploy** - Azure Security Center deploys the Qualys extension to the selected virtual machine/s.

1. **Gather information** - The extension collects artifacts and sends them for analysis in the Qualys cloud service in the defined region.

1. **Analyze** - Qualys' cloud service conducts the vulnerability assessment and sends its findings to Security Center. 

    > [!IMPORTANT]
    > To ensure the privacy, confidentiality, and security of our customers, Microsoft doesn't share customer details with Qualys. [Learn more about the privacy standards built into Azure](https://www.microsoft.com/trust-center/privacy).


1. **Report** - The findings are available to you in Security Center.

[![Process flow diagram for Azure Security Center's built-in vulnerability scanner](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png)](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png#lightbox)


## Deploying a vulnerability assessment solution to your VMs

1. From the [Azure portal](https://azure.microsoft.com/features/azure-portal/), open **Security Center**.

1. From Security Center's menu, open the **Recommendations** page.

1. Select the recommendation **A vulnerability assessment solution should be enabled on your virtual machines**.

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png" alt-text="The groupings of the machines in the **A vulnerability assessment solution should be enabled on your virtual machines** recommendation page" lightbox="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.jpg":::

    Your VMs will appear in one or more of the following groups:

    * **Healthy resources** – Security Center has detected a vulnerability assessment solution running on these VMs.
    * **Unhealthy resources** – A vulnerability scanner extension can be deployed to these VMs. 
    * **Not applicable resources** – these VMs can't have a vulnerability scanner extension deployed. Your standard tier VM might be in this tab because it's an image in an AKS cluster, it's part of a virtual machine scale set, or it's not running one of the supported OSes for the integrated vulnerability scanner:

        | **Vendor** | **OS** | **Supported versions** |
        |----|----|----|
        |Microsoft|Windows|All|
        |Red Hat|Enterprise Linux|5.4+, 6, 7.0-7.8, 8|
        |Red Hat|CentOS|5.4+, 6, 7.0-7.7|
        |Red Hat|Fedora|22-25|
        |SUSE|Linux Enterprise Server (SLES)|11, 12, 15|
        |SUSE|OpenSUSE|12, 13|
        |SUSE|Leap|42.1|
        |Oracle|Enterprise Linux|5.11, 6, 7.0-7.5|
        |Debian|Debian|7.x-9.x|
        |Ubuntu|Ubuntu|12.04 LTS, 14.04 LTS, 15.x, 16.04 LTS, 18.04 LTS|

1. From the list of unhealthy machines, select the ones to receive a vulnerability assessment solution and select **Remediate**.

    >[!IMPORTANT]
    > Depending on your configuration, you may only see a subset of this list. 
    >
    > - If you haven't got a third-party vulnerability scanner configured, you won't be offered the opportunity to deploy it.
    > - If your selected VMs aren't on the standard tier, you won't be offered the ASC integrated vulnerability scanner.

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-remediation-options.png" alt-text="The options for which type of remediation flow you want to choose when responding to the recommendation **A vulnerability assessment solution should be enabled on your virtual machines** recommendation page":::

    >[!TIP]
    > The BYOL options refer to supported third-party vulnerability assessment solutions. Currently both Qualys and Rapid7 are supported providers. Supported solutions report vulnerability data to the partner's management platform. In turn, that platform provides vulnerability and health monitoring data back to Security Center. You can identify vulnerable VMs on the Security Center dashboard and switch to the partner management console directly from Security Center for additional reports and information.

1. Choose the relevant option, select **Proceed**.

1. If you're deploying the integrated Security Center vulnerability assessment extension, you'll be asked for one further confirmation. Select **Remediate**.

    The scanner extension will be installed on all of the selected VMs within a few minutes.
    
    Scanning begins automatically as soon as the extension is successfully deployed. Scans will then run at four-hour intervals. This interval is hard-coded and not configurable.

    >[!IMPORTANT]
    > If the deployment fails on one or more VMs, ensure the target VMs can communicate with Qualys's cloud service on the following two IP addresses (via port 443 - the default for HTTPS):
    >
    >   - 64.39.104.113 - Qualys' US data center
    >   - 154.59.121.74 - Qualys' European data center
    >
    > If your VM is in a European Azure region, its artifacts will be processed in Qualys' European data center. Artifacts for virtual machines located anywhere else are sent to the US data center. 

1. If you're setting up a new BYOL configuration, enter the details from the provider as follows:

    1. For **Resource group**, select **Use existing**.
    1. For **Location**, select where the solution is geographically located.
    1. For Qualys, enter the license provided by Qualys into the **License code** field.
    1. For Rapid7, upload the **Rapid7 Configuration File**.
    1. In the **Public key** box, enter the public key information provided by the partner.
    1. To automatically install this vulnerability assessment agent on all discovered VMs in the subscription of this solution, select **Auto deploy**.
    1. Select **OK**.

    After the vulnerability assessment solution is installed on the target VM, Security Center scans the VM to detect and identify vulnerabilities in the system and application. It might take a couple of hours for the first scan to complete. After that, it runs hourly.

## Configuring a partner solution (using PowerShell and the REST API)

To programatically deploy your own privately licensed vulnerability assessment solution from [Qualys](https://www.qualys.com/lp/azure) or [Rapid7](https://www.rapid7.com/products/insightvm/), use the supplied script [PowerShell > Vulnerability Solution](https://github.com/Azure/Azure-Security-Center/tree/master/Powershell%20scripts/Vulnerability%20Solution). This script uses the REST API to create a new security solution in ASC. You'll need a license and a key provided by your service provider (Qualys or Rapid7).

> [!IMPORTANT] 
> Only one solution can be created per license. Attempting to create another solution using the same name/license/key will fail.

### Prerequisites

Required PowerShell modules:

- Install-module Az
- Install-module Az.security

### Running the script

To run the script, you'll need the relevant information for the parameters below.

| **Parameter** | **Required** | **Notes** |
|----|:----:|----|
|**SubscriptionId**|✔|The subscriptionID of the Azure Subscription that contains the resources you want to analyze.|
|**ResourceGroupName**|✔|Name of the resource group. Use any existing resource group including the default ("DefaultResourceGroup-xxx"). Since the solution isn't an Azure resource, it won't be listed under the resource group, but still it is attached to it.|
|**vaSolutionName**|✔|The name of the new solution.|
|**vaType**|✔|Qualys or Rapid7.|
|**licenceCode**|✔|Vendor provided license string.|
|**publicKey**|✔|Vendor provided public key.|
|**autoUpdate**|-|Enable (true) or disable (false) auto deploy for this VA solution. When enabled, every new VM on the subscription will automatically attempt to link to the solution.<br/>(Default: False)|
||||

Syntax:

```azurepowershell
.\New-ASCVASolution.ps1 -subscriptionId <Subscription Id> -resourceGroupName <RG Name>
-vaSolutionName <New solution name> -vaType <Qualys / Rapid7> -autoUpdate <true/false>
-licenceCode <License code from vendor> -publicKey <Public Key received from vendor>
```

Example (this example doesn't include valid license details):

```azurepowershell
.\New-ASCVASolution.ps1 -subscriptionId 'f4cx1b69-dtgb-4ch6-6y6f-ea2e95373d3b' -resourceGroupName 'DefaultResourceGroup-WEU' -vaSolutionName 'QualysVa001' -vaType 'Qualys' -autoUpdate 'false' `
-licenceCode 'eyJjaWQiOiJkZDg5OTYzXe4iMTMzLWM4NTAtODM5FD2mZWM1N2Q3ZGU5MjgiLCJgbTYuOiIyMmM5NDg3MS1lNTVkLTQ1OGItYjhlMC03OTRhMmM3YWM1ZGQiLCJwd3NVcmwiOiJodHRwczovL3FhZ3B1YmxpYy1wMDEuaW50LnF1YWx5cy5jb20vQ2xvdSKJY6VudC8iLCJwd3NQb3J0IjoiNDQzIn0=' `
-publicKey 'MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCOiOLXjOywMfLZIBGPZLwSocf1Q64GASLK9OHFEmanBl1nkJhZDrZ4YD5lM98fThYbAx1Rde2iYV1ze/wDlX4cIvFAyXuN7HbdkeIlBl6vWXEBZpUU17bOdJOUGolzEzNBhtxi/elEZLghq9Chmah82me/okGMIhJJsCiTtglVQIDAQAB'
```

## FAQ - Built-in Qualys vulnerability scanner

### Are there any additional charges for the Qualys license?
No. The built-in scanner is free to all standard tier users. The "Enable the built-in vulnerability assessment solution on virtual machines (powered by Qualys)" recommendation deploys the scanner with its licensing and configuration information. No additional licenses are required. 

### What prerequisites and permissions are required to install the Qualys extension?
You'll need write permissions for any VM on which you want to deploy the extension.

The Azure Security Center Vulnerability Assessment extension (powered by Qualys), like other extensions, runs on top of the Azure Virtual Machine agent. So it runs as Local Host on Windows, and Root on Linux.

During setup, Security Center checks to ensure that the VM can communicate with the following two Qualys's data centers (via port 443 - the default for HTTPS):

- 64.39.104.113 - Qualys' US data center
- 154.59.121.74 - Qualys' European data center

In addition, the extension doesn't currently accept any proxy configuration details.

### Can I remove the Security Center Qualys extension? 
If you want to remove the extensions from a VM, you can do it manually or with any of your programmatic tools. 

You'll need the following details:

* On Linux, the extension is called "LinuxAgent.AzureSecurityCenter" and the publisher name is "Qualys"
* On Windows, the extension is called "WindowsAgent.AzureSecurityCenter" and the provider name is "Qualys"

### How does the extension get updated?
Like the Azure Security Center agent itself and all other Azure extensions, minor updates of the Qualys scanner may automatically happen in the background. All agents and extensions are tested extensively before being automatically deployed.

### Why does my VM show as "not applicable" in the recommendation?
The recommendation details page for the **"Enable the built-in vulnerability assessment solution on virtual machines (powered by Qualys)"** recommendation groups your VMs in one or more of the following lists: **Healthy resources**, **Unhealthy resources**, and **Not applicable resources**.

If you have VMs in the **Not applicable resources** group it means Security Center can't deploy the vulnerability scanner extension on those VMs. 

Your VM might be in this tab because:

- It's on the free pricing tier - As explained above, the vulnerability scanner included with Azure Security Center is  only available to users on the standard pricing tier.

- It's an image in an AKS cluster or part of a virtual machine scale set - This extension doesn't support VMs that are PaaS resources.

- It's not running one of the supported OSes:

    | **Vendor** | **OS** | **Supported versions** |
    |----|----|----|
    |Microsoft|Windows|All|
    |Red Hat|Enterprise Linux|5.4+, 6, 7.0-7.8, 8|
    |Red Hat|CentOS|5.4+, 6, 7.0-7.7|
    |Red Hat|Fedora|22-25|
    |SUSE|Linux Enterprise Server (SLES)|11, 12, 15|
    |SUSE|OpenSUSE|12, 13|
    |SUSE|Leap|42.1|
    |Oracle|Enterprise Linux|5.11, 6, 7.0-7.5|
    |Debian|Debian|7.x-9.x|
    |Ubuntu|Ubuntu|12.04 LTS, 14.04 LTS, 15.x, 16.04 LTS, 18.04 LTS|

### What is scanned by the built-in vulnerability scanner?
The scanner is running on your virtual machine and looking for vulnerabilities of the VM itself. From the virtual machine, it can't scan your network.

### Does the scanner integrate with my existing Qualys console?
The Security Center extension is a separate tool from your existing Qualys scanner. Licensing restrictions mean that it can only be used within Azure Security Center.

### Microsoft Defender Advanced Threat Protection also includes Threat & Vulnerability Management (TVM). How is the Security Center Vulnerability Assessment extension different?
Microsoft is actively developing world-class vulnerability management with Microsoft Defender ATP's Threat & Vulnerability Management solution, built into Windows.

Today, Azure Security Center's Vulnerability Assessment extension is powered by Qualys. The Qualys extension ensures support for both Windows and Linux VMs. The extension also benefits from Qualys's own knowledge of vulnerabilities that don't yet have CVEs.

### How quickly will the scanner identify newly disclosed critical vulnerabilities?
Within 48hrs of the disclosure of a critical vulnerability, Qualys incorporates the information into their processing and can identify affected VMs.



## Next steps

Security Center also offers vulnerability analysis for your:

- SQL databases - see [Explore vulnerability assessment reports in the vulnerability assessment dashboard](security-center-iaas-advanced-data.md#explore-vulnerability-assessment-reports)
- Azure Container Registry images - see [Azure Container Registry integration with Security Center](azure-container-registry-integration.md)