---
title: Create and add a virtual machine to a lab
description: Learn how to use the Azure portal to add a virtual machine (VM) to a lab in Azure DevTest Labs. Configure basic settings, artifacts, and advanced settings.
ms.topic: how-to
ms.author: rosemalcolm
author: RoseHJM
ms.date: 09/30/2023
ms.custom: UpdateFrequency2
---

# Create lab virtual machines in Azure DevTest Labs

This article describes how to create Azure virtual machines (VMs) in Azure DevTest Labs by using the Azure portal.

## Prerequisite

You need at least [user](devtest-lab-add-devtest-user.md#devtest-labs-user) access to a lab in DevTest Labs. For more information about creating labs, see [Create a lab in the Azure portal](devtest-lab-create-lab.md).

<a name="create-and-add-virtual-machines"></a>
## Configure basic settings

1. In the [Azure portal](https://portal.azure.com), go to the **Overview** page for the lab.

1. On the lab **Overview** page, select **Add**.

   :::image type="content" source="./media/devtest-lab-add-vm/portal-lab-add-vm.png" alt-text="Lab overview page showing add button.":::

1. On the **Choose a base** page, select an image for the VM. You can choose Marketplace images, custom images, or formulas that the lab owner made available. The following instructions use Windows 11 Pro. Some bases might have different settings.

1. On the **Basics Settings** tab of the **Create lab resource** screen, provide the following information:

   - **Virtual machine name**: Keep the autogenerated name, or enter another unique VM name.
   - **User name**: Keep the user name, or enter another user name to grant administrator privileges on the VM.
   - **Use a saved secret**: Select this checkbox to use a secret from Azure Key Vault instead of a password to access the VM. If you select this option, under **Secret**, select the secret to use from the dropdown list. For more information, see [Store secrets in a key vault](devtest-lab-store-secrets-in-key-vault.md). 
   - **Password**: If you don't choose to use a secret, enter a VM password between 8 and 123 characters long.
   - **Save as default password**: Select this checkbox to save the password in the Key Vault associated with the lab.
   - **Virtual machine size**: Keep the default value for the base, or select **Change Size** to select different sizes.
   - **Hibernation**: Select **Enabled** to enable hibernation for this virtual machine. If you enable Hibernation, you also must select **Public IP** in the Advanced settings as Private and Shared IP are currently not supported if Hibernation is enabled.
   - **OS disk type**: Keep the default value for the base, or select a different option from the dropdown list.
   - **Artifacts**: This field shows the number of artifacts already configured for this VM base. Optionally, select **Add or Remove Artifacts** to select and configure artifacts to add to the VM.

   :::image type="content" source="./media/devtest-lab-add-vm/portal-lab-vm-basic-settings.png" alt-text="Virtual machine basic settings page.":::

<a name="add-artifacts-during-installation"></a>
## Add optional artifacts

Artifacts are tools, actions, or software you can add to lab VMs. You can add artifacts to VMs from the [DevTest Labs public artifact repository](https://github.com/Azure/azure-devtestlab/tree/master/Artifacts), or from private artifact repositories connected to the lab. For more information, see [Add artifacts to DevTest Labs VMs](add-artifact-vm.md).

To add or modify artifacts during VM creation:

1. On the **Basic Settings** tab of the **Create lab resource** screen, select **Add or Remove Artifacts**.

1. On the **Add artifacts** page, select the arrow next to each artifact you want to add to the VM.

1. On each **Add artifact** pane, enter any required and optional parameter values, and then select **OK**. The artifact appears under **Selected artifacts**, and the number of configured artifacts updates.

   :::image type="content" source="./media/devtest-lab-add-vm/portal-add-artifact-during.png" alt-text="Add artifact to virtual machine.":::

1. When you're done adding artifacts, select **OK** on the **Add artifacts** page.

## Configure optional advanced settings

Optionally, select the **Advanced Settings** tab on the **Create lab resource** screen, and change any of the following values:

- **Virtual network**: Select a network from the dropdown list. For more information, see [Add a virtual network](devtest-lab-configure-vnet.md).
- **Subnet**: If necessary, select a different subnet from the dropdown list.
- **IP address**: Leave at **Shared**, or select **Public** or **Private**. For more information, see [Understand shared IP addresses](devtest-lab-shared-ip.md).
- **Expiration date**: Leave at **Will not expire**, or [set an expiration date](devtest-lab-use-resource-manager-template.md#set-vm-expiration-date) and time for the VM.
- **Make this machine claimable**: Leave at **No** to keep yourself as the owner of the VM. Select **Yes** to make the VM claimable by any lab user after creation. For more information, see [Create and manage claimable VMs](devtest-lab-add-claimable-vm.md).
- **Number of instances**: To create more than one VM with this configuration, enter the number of VMs to create.
- **View ARM Template**: Select to view and save the VM configuration as an Azure Resource Manager (ARM) template. You can use the ARM template to [deploy new VMs with Azure PowerShell](../azure-resource-manager/templates/overview.md).

:::image type="content" source="./media/devtest-lab-add-vm/portal-lab-vm-advanced-settings.png" alt-text="Virtual machine advanced settings page.":::

## Complete the VM deployment

After you configure all settings, on the **Basic Settings** tab of the **Create lab resource** screen, select **Create**.

During VM deployment, you can select the **Notifications** icon at the top of the screen to see progress. Creating a VM takes a while.

When the deployment is complete, if you kept yourself as VM owner, the VM appears under **My virtual machines** on the lab **Overview** page. To connect to the VM, select it from the list, and then select **Connect** on the VM's **Overview** page.

Or, if you chose **Make this machine claimable** during VM creation, select **Claimable virtual machines** in the left navigation to see the VM listed on the **Claimable virtual machines** page. Select **Refresh** if your VM doesn't appear. To take ownership of a VM in the claimable list, see [Use a claimable VM](devtest-lab-add-claimable-vm.md#use-a-claimable-vm).

:::image type="content" source="./media/devtest-lab-add-vm/portal-lab-vm-creation-status.png" alt-text="Lab VM creation status page.":::

When you create a VM in DevTest Labs, you're given permission to access that VM. You can view the VM both on the labs page and on the **Virtual Machines** page. Users assigned to the **DevTest Labs Owner** role can see all VMs that were created in the lab on the lab's **All Virtual Machines** page. However, users who have the **DevTest Labs User** role are not automatically granted read access to VM resources that other users have created. So, those VMs are not displayed on the **Virtual Machines** page.

## Move existing Azure VMs into a DevTest Labs lab
To copy your existing VMs to DevTest Labs:
          
   1.	Copy the VHD file of your existing VM by using a [Windows PowerShell script](https://github.com/Azure/azure-devtestlab/blob/master/samples/DevTestLabs/Scripts/CopyVirtualMachines/CopyAzVHDFromVMToLab.ps1).
   2.	Create the [custom image](devtest-lab-create-template.md) inside your DevTest Labs lab.
   3.	Create a VM in the lab from your custom image.
          

<a name="add-artifacts-after-installation"></a>
## Next steps

- [Add artifacts to VMs after creation](add-artifact-vm.md#add-artifacts-to-vms-from-the-azure-portal).
- Create DevTest Labs VMs by using [PowerShell](devtest-lab-vm-powershell.md), [Azure CLI](devtest-lab-vmcli.md), an [ARM template](devtest-lab-use-resource-manager-template.md), or from a [shared image gallery](add-vm-use-shared-image.md).
- Explore the DevTest Labs public repositories of [artifacts](https://github.com/Azure/azure-devtestlab/tree/master/Artifacts), [environments](https://github.com/Azure/azure-devtestlab/tree/master/Environments), and [QuickStart ARM templates](https://github.com/Azure/azure-devtestlab/tree/master/samples/DevTestLabs/QuickStartTemplates).

