---
title: OMS virtual machine extension for Linux | Microsoft Docs
description: Deploy the OMS agent on Linux virtual machine using a virtual machine extension.
services: virtual-machines-linux
documentationcenter: ''
author: neilpeterson
manager: timlt
editor: ''
tags: azure-resource-manager

ms.assetid: c7bbf210-7d71-4a37-ba47-9c74567a9ea6
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 11/29/2016
ms.author: nepeters

---
# OMS virtual machine extension for Linux

## Overview

The OMS Agent virtual machine Linux extension installs the OMS agent and enrolls the virtual machine into an existing OMS workspace.

For general information on Azure virtual machine extensions see, [Virtual Machine extensions overview](./virtual-machines-linux-extensions-features.md).

## Supported Linux Distributions

The OMS Agent extension can be run against these Linux distributions.

- CentOS Linux 5,6, and 7 (x86/x64)
- Oracle Linux 5,6, and 7 (x86/x64)
- Red Hat Enterprise Linux Server 5,6 and 7 (x86/x64)
- Debian GNU/Linux 6, 7, and 8 (x86/x64)
- Ubuntu 12.04 LTS, 14.04 LTS, 15.04 (x86/x64)
- SUSE Linux Enterprise Server 11 and 12 (x86/x64)

## Resource Manager Template and Schema

The following schema demonstrates the available properties and configuration of the OMS Agent VM extension. This JSON can be used in an Azure Resource Manager template to deploy the OMS extensions.

```json
{
  "type": "Microsoft.Compute/virtualMachines/extensions",
  "name": "<extension-deployment-name>",
  "apiVersion": "<api-version>",
  "location": "<location>",
  "dependsOn": [
    "[concat('Microsoft.Compute/virtualMachines/', <vm-name>)]"
  ],
  "properties": {
    "publisher": "Microsoft.EnterpriseCloud.Monitoring",
    "type": "OmsAgentForLinux",
    "typeHandlerVersion": "1.0",
    "settings": {
      "workspaceId": "<workspace id>"
    },
    "protectedSettings": {
      "workspaceKey": "<workspace key>"
    }
  }
}
```

A sample template can be deployed by clicking this button.

<a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2F201-oms-extension-ubuntu-vm%2Fazuredeploy.json" target="_blank">
    <img src="http://azuredeploy.net/deploybutton.png"/>
</a>

### Public configuration

workspaceId: (required, string) the OMS workspace id to onboard to

```json
{
  "workspaceId": "<workspace-id (guid)>"
}
```

### Private configuration

workspaceKey: (required, string) the primary/secondary shared key of the workspace

```json
{
  "workspaceKey": "<workspace-key>"
}
```

## Deploy with Azure CLI

Before deploying OmsAgent Extension, you should configure your public.json and protected.json (in section 1.1 and 1.2 above).

```azurecli
azure vm extension set <resource-group> <vm-name> \
  OmsAgentForLinux Microsoft.EnterpriseCloud.Monitoring <version> \
  --public-config-path public.json  \
  --private-config-path protected.json
```

## Deploy with PowerShell

```PowerShell
$RGName = '<resource-group-name>'
$VmName = '<vm-name>'
$Location = '<location>'

$ExtensionName = 'OmsAgentForLinux'
$Publisher = 'Microsoft.EnterpriseCloud.Monitoring'
$Version = '<version>'

$PublicConf = '{
    "workspaceId": "<workspace id>"
}'
$PrivateConf = '{
    "workspaceKey": "<workspace key>"
}'

Set-AzureRmVMExtension -ResourceGroupName $RGName -VMName $VmName -Location $Location `
  -Name $ExtensionName -Publisher $Publisher `
  -ExtensionType $ExtensionName -TypeHandlerVersion $Version `
  -Settingstring $PublicConf -ProtectedSettingString $PrivateConf
```

## Troubleshoot

- The status of the extension is reported back to Azure so that user can see the status on Azure Portal
- All the execution output and errors generated by the extension are logged into the following directories - /var/lib/waagent/<extension-name-and-version>/packages/, /opt/microsoft/omsagent/bin and the tail of the output is logged into the log directory specified in HandlerEnvironment.json and reported back to Azure
- The operation log of the extension is /var/log/azure/<extension-name>/<version>/extension.log file.

