---
title: Connect Azure Communications Gateway to Microsoft Teams Direct Routing
description:  After deploying Azure Communications Gateway, you can configure it to connect to the Microsoft Phone System for Microsoft Teams Direct Routing.
author: rcdun
ms.author: rdunstan
ms.service: communications-gateway
ms.topic: integration
ms.date: 03/22/2024
ms.custom:
    - template-how-to-pattern
---

# Connect Azure Communications Gateway to Microsoft Teams Direct Routing

After you deploy Azure Communications Gateway and connect it to your core network, you need to connect it to Microsoft Phone System.

This article describes how to start connecting Azure Communications Gateway to Microsoft Teams Direct Routing. After you finish the steps in this article, you can set up test users for test calls and prepare for live traffic.

This article provides detailed guidance equivalent to the following steps in the [Microsoft Teams documentation for configuring an SBC for multiple tenants](/microsoftteams/direct-routing-sbc-multiple-tenants).

- Registering a base domain name in the carrier tenant.
- Creating a trunk in the carrier tenant (a _carrier trunk_).

## Prerequisites

You must [deploy Azure Communications Gateway](deploy.md).

Your organization must [integrate with Azure Communications Gateway's Provisioning API](integrate-with-provisioning-api.md). If you didn't configure the Provisioning API in the Azure portal as part of deploying, you also need to know:
- The IP addresses or address ranges (in CIDR format) in your network that should be allowed to connect to the Provisioning API, as a comma-separated list.
- (Optional) The name of any custom SIP header that Azure Communications Gateway should add to messages entering your network.

You must have **Reader** access to the subscription into which Azure Communications Gateway is deployed.

You must be able to sign in to the Microsoft 365 admin center for your tenant as a Global Administrator.

You must be able to configure your tenant with two user or resource accounts licensed for Microsoft Teams. Lab deployments require one account. For more information on suitable licenses, see the [Microsoft Teams documentation](/microsoftteams/direct-routing-sbc-multiple-tenants#activate-the-domain-name).

## Enable Microsoft Teams Direct Routing support

> [!NOTE]
> If you selected Microsoft Teams Direct Routing when you [deployed Azure Communications Gateway](deploy.md), skip this step and go to [Find your Azure Communication Gateway's domain names for connecting to Microsoft Teams Direct Routing](#find-your-azure-communication-gateways-domain-names-for-connecting-to-microsoft-teams-direct-routing).

1. Sign in to the [Azure portal](https://azure.microsoft.com/).
1. In the search bar at the top of the page, search for your Communications Gateway resource and select it.
1. In the side menu bar, find **Communications services** and select **Teams Direct Routing** to open a page for the service.
1. On the service's page, select **Teams Direct Routing settings**.
1. Fill in the fields, selecting **Review + create** and **Create**.
1. Select the **Overview** page for your resource.
1. Wait for your resource to be updated. When your resource is ready, the **Provisioning Status** field on the resource overview changes to "Complete." We recommend that you check in periodically to see if the Provisioning Status field is "Complete." This step might take up to two weeks.

## Find your Azure Communication Gateway's domain names for connecting to Microsoft Teams Direct Routing

Before starting this step, check that the **Provisioning Status** field for your resource is "Complete".

Microsoft Teams only sends traffic to domains that you confirm that you own. Your Azure Communications Gateway deployment automatically receives an autogenerated fully qualified domain name (FQDN) and regional subdomains of this domain.

1. Sign in to the [Azure portal](https://azure.microsoft.com/).
1. In the search bar at the top of the page, search for your Communications Gateway resource.
1. Select your Communications Gateway resource. Check that you're on the **Overview** of your Azure Communications Gateway resource.
1. Select **Properties**.
1. Find the field named **Domain**. This name is your deployment's _base domain name_.
1. Work out the _per-region domain names_ for connecting to Microsoft Teams Direct Routing. These use the form `1-r<region-number>.<base-domain-name>`.
    - A production deployment has two service regions and therefore two per-region domain names: `1-r1.<base-domain-name>` and `1-r2.<base-domain-name>`
    - A lab deployment has one service region and therefore one per-region domain name: `1-r1.<base-domain-name>`.
1. Note down the base domain name and the per-region domain names. You'll need these values in the next steps.

> [!IMPORTANT]
> The domain names for connecting to Microsoft Teams Direct Routing are different to the domain names for connecting to your network.

## Register the base domain name in your tenant

You need to register the base domain for Azure Communications Gateway in your tenant and verify it. Registering and verifying the base domain proves that you control the domain.

> [!TIP]
> If the base domain name is a subdomain of a domain already registered and verified in this tenant:
> - You must register Azure Communications Gateway's base domain name.
> - Microsoft 365 automatically verifies the base domain name.

Follow the instructions [to add a domain to your tenant](/microsoftteams/direct-routing-sbc-multiple-tenants#add-a-base-domain-to-the-tenant-and-verify-it). Use the base domain name that you found in [Find your Azure Communication Gateway's domain names for connecting to Microsoft Teams Direct Routing](#find-your-azure-communication-gateways-domain-names-for-connecting-to-microsoft-teams-direct-routing).

If Microsoft 365 prompts you to verify the domain name:

1. Select DNS TXT records as your verification method with **Add a TXT record instead**.
1. Select **Next**, and note the TXT value that Microsoft 365 provides.
1. Provide the TXT value to your onboarding team as part of [Provide additional information to your onboarding team](#provide-additional-information-to-your-onboarding-team).

Don't try to finish verifying the domain name until your onboarding team confirms that DNS records with the TXT value have been set up.

## Provide additional information to your onboarding team

Before your onboarding team can finish onboarding you to the Microsoft Teams Direct Routing environment, you need to provide them with some additional information.

1. Wait for your onboarding team to provide you with a form to collect the additional information. 
1. Complete the form and give it to your onboarding team.

If you don't already have an onboarding team, contact azcog-enablement@microsoft.com, providing your Azure subscription ID and contact details.

## Finish verifying the base domain name in Microsoft 365

> [!NOTE]
> If Microsoft 365 did not prompt you to verify the domain in [Register the base domain name in your tenant](#register-the-base-domain-name-in-your-tenant), skip this step.

After your onboarding team confirms that the DNS records have been set up, finish verifying the base domain name in the Microsoft 365 admin center.

1. Sign into the Microsoft 365 admin center as a Global Administrator.
1. Select **Settings** > **Domains**.
1. Select the base domain.
1. On the **Choose your online services** page, clear all options and select **Next**.
1. Select **Finish** on the **Update DNS settings** page.
1. Ensure that the status is **Setup complete**.

## Register the per-region domain names in your tenant

Before you can connect your tenant to Azure Communications Gateway, you need to:
- Register the per-region domain names for connecting to Microsoft Teams Direct Routing in your tenant (this step).
- Activate the domain names in Microsoft 365 by setting up a user or resource account for each domain name and an appropriate license (next step).

Follow the instructions [to add a domain to your tenant](/microsoftteams/direct-routing-sbc-multiple-tenants#add-a-base-domain-to-the-tenant-and-verify-it) once for each per-region domain name. You found these domain names in [Find your Azure Communication Gateway's domain names for connecting to Microsoft Teams Direct Routing](#find-your-azure-communication-gateways-domain-names-for-connecting-to-microsoft-teams-direct-routing).

Microsoft 365 should automatically verify these domain names, because you verified the base domain name.

## Active the per-region domain names in your tenant

To activate the per-region domain names in Microsoft 365, set up at least one user or resource account licensed for Microsoft Teams for each per-region domain name. For information on the licenses you can use and instructions, see [Activate the domain name](/microsoftteams/direct-routing-sbc-multiple-tenants#activate-the-domain-name).

## Connect your tenant to Azure Communications Gateway

You must configure your Microsoft 365 tenant with SIP trunks to Azure Communications Gateway. Each trunk connects to one of the per-region domain names that you found in [Find your Azure Communication Gateway's domain names for connecting to Microsoft Teams Direct Routing](#find-your-azure-communication-gateways-domain-names-for-connecting-to-microsoft-teams-direct-routing).

Use [Connect your Session Border Controller (SBC) to Direct Routing](/microsoftteams/direct-routing-connect-the-sbc) and the following configuration settings to set up the trunks.

- For a production deployment, set up two trunks.
- For a lab deployment, set up one trunk.

| Teams Admin Center setting | PowerShell parameter | Value to use (Admin Center / PowerShell) |
| -------------------------- | -------------------- | ------------ |
| **Add an FQDN for the SBC** | `FQDN` | The regional domain of Azure Communications Gateway |
| **Enabled** | `Enabled` | On / True |
| **SIP signaling port** | `SipSignalingPort` | 5063 |
| **Send SIP options** | `SendSIPOptions` | On / True |
| **Forward call history** | `ForwardCallHistory` | On / True |
| **Forward P-Asserted-identity (PAI) header** | `ForwardPAI` | On / True |
| **Concurrent call capacity** | `MaxConcurrentSessions` | Use default |
| **Failover response codes** | `FailoverResponseCodes` | Use default |
| **Failover times (seconds)** | `FailoverTimeSeconds` | Use default |
| **SBC supports PIDF/LO for emergency calls** | `PidfloSupported` | On / True |
| **Media bypass** | `MediaBypass` | Off / False |

Use the default values for all other settings.

## Confirm that your SIP trunks are active

Confirm that the SIP OPTIONS status of each SIP trunk is Active.

## Next step

> [!div class="nextstepaction"]
> [Configure a test customer](configure-test-customer-teams-direct-routing.md)
