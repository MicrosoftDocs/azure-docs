---
title: Monitoring Azure Event Grid namespaces
description: Learn how to use Azure Monitor to view, analyze, and create alerts on metrics from Azure Event Grid namespaces. 
ms.topic: how-to
ms.custom: subject-monitoring
ms.date: 01/17/2024
---

# Monitor Azure Event Grid namespaces 
When you have critical applications and business processes relying on Azure resources, you want to monitor those resources for their availability, performance, and operation. This article describes the monitoring data generated by Azure Event Grid namespaces and how to analyze and alert on this data with Azure Monitor.

## What is Azure Monitor?
Azure Event Grid creates monitoring data using [Azure Monitor](/azure/azure-monitor/overview), which is a full stack monitoring service in Azure. Azure Monitor provides a complete set of features to monitor your Azure resources. It can also monitor resources in other clouds and on-premises.

Start with the article [Monitoring Azure resources with Azure Monitor](/azure/azure-monitor/essentials/monitor-azure-resource), which describes the following concepts:

- What is Azure Monitor?
- Costs associated with monitoring
- Monitoring data collected in Azure
- Configuring data collection
- Standard tools in Azure for analyzing and alerting on monitoring data

The following sections build on this article by describing the specific data gathered for Azure Event Grid namespaces. These sections also provide examples for configuring data collection and analyzing this data with Azure tools.

> [!TIP]
> To understand costs associated with Azure Monitor, see [Azure Monitor cost and usage](/azure/azure-monitor/cost-usage). To understand the time it takes for your data to appear in Azure Monitor, see [Log data ingestion time](/azure/azure-monitor/logs/data-ingestion-time).

## Monitoring data from Event Grid namespaces
Azure Event Grid collects the same kinds of monitoring data as other Azure resources that are described in [Monitoring data from Azure resources](/azure/azure-monitor/essentials/monitor-azure-resource#monitoring-data). 

See the following monitoring data reference articles for a detailed reference of the logs and metrics created by Azure Event Grid.

- [Monitor data reference for MQTT broker feature](monitor-mqtt-delivery-reference.md) 
- [Monitor data reference for pull delivery](monitor-pull-reference.md)
- [Monitor data reference for Azure Event Grid's push delivery using namespaces](monitor-namespace-push-reference.md)

## Collection and routing
Platform metrics and the activity log are collected and stored automatically, but can be routed to other locations by using a diagnostic setting. Resource Logs aren't collected and stored until you create a diagnostic setting and route them to one or more locations.

See [Create diagnostic setting to collect platform logs and metrics in Azure](/azure/azure-monitor/essentials/diagnostic-settings) for the detailed process for creating a diagnostic setting using the Azure portal, CLI, or PowerShell. When you create a diagnostic setting, you specify which categories of logs to collect. 

The categories for Azure Event Grid's MQTT broker are listed in [Monitor data reference for Azure Event Gridâ€™s MQTT broker feature](monitor-mqtt-delivery-reference.md#resource-logs).

> [!NOTE]
> Azure Monitor doesn't include dimensions in the exported metrics data, that's sent to a destination like Azure Storage, Azure Event Hubs, Log Analytics, etc.

### Azure Storage
If you use **Azure Storage** to store the diagnostic logging information, the information is stored in containers named **insights-logs-operationlogs** and **insights-metrics-pt1m**. Sample URL for an operation log: `https://<Azure Storage account>.blob.core.windows.net/insights-logs-operationallogs/resourceId=/SUBSCRIPTIONS/<Azure subscription ID>/RESOURCEGROUPS/<Resource group name>/PROVIDERS/MICROSOFT.EVENTGRID/NAMESPACES/<Namespace name>/y=<YEAR>/m=<MONTH-NUMBER>/d=<DAY-NUMBER>/h=<HOUR>/m=<MINUTE>/PT1H.json`. The URL for a metric log is similar. 

### Azure Event Hubs
If you use **Azure Event Hubs** to store the diagnostic logging information, the information is stored in event hubs named **insights-logs-operationlogs** and **insights-metrics-pt1m**. You can also select an existing event hub except for the event hub for which you're configuring diagnostic settings. 

### Log Analytics
If you use **Log Analytics** to store the diagnostic logging information, the information is stored in tables named **AzureDiagnostics** / **AzureMetrics** or **resource specific tables**

> [!IMPORTANT]
> Enabling these settings requires additional Azure services (storage account, event hub, or Log Analytics), which may increase your cost. To calculate an estimated cost, visit the [Azure pricing calculator](https://azure.microsoft.com/pricing/calculator).

> [!NOTE]
> When you enable metrics in a diagnostic setting, dimension information is not currently included as part of the information sent to a storage account, event hub, or log analytics.

The metrics and logs you can collect are discussed in the following sections.

## Analyze metrics
You can analyze metrics for Azure Event Grid namespaces by selecting **Metrics** from the **Azure Monitor** section on the home page for your Event Grid namespace. See [Analyze metrics with Azure Monitor metrics explorer](/azure/azure-monitor/essentials/analyze-metrics) for details on using this tool. 

See the following monitoring data reference articles for metrics created by Azure Event Grid.

- [Monitor data reference for MQTT broker feature](monitor-mqtt-delivery-reference.md) 
- [Monitor data reference for pull delivery](monitor-pull-reference.md)
- [Monitor data reference for Azure Event Grid's push delivery using namespaces](monitor-namespace-push-reference.md)

:::image type="content" source="./media/monitor-namespaces/metrics.png" alt-text="Screenshot that shows the Metrics Explorer with Event Grid namespace selected.":::

For reference, you can see a list of [all resource metrics supported in Azure Monitor](/azure/azure-monitor/essentials/metrics-supported).

> [!TIP]
> Azure Monitor metrics data is available for 90 days. However, when creating charts only 30 days can be visualized. For example, if you want to visualize a 90 day period, you must break it into three charts of 30 days within the 90 day period.

### Filter and split
For metrics that support dimensions, you can apply filters using a dimension value. You can also split a metric by dimension to visualize how different segments of the metric compare with each other. For more information of filtering and splitting, see [Advanced features of Azure Monitor](/azure/azure-monitor/essentials/metrics-charts).

:::image type="content" source="./media/monitor-namespaces/metrics-filter-split.png" alt-text="Screenshot that shows filtering and splitting metrics.":::

## Analyze logs
Using Azure Monitor Log Analytics requires you to create a diagnostic configuration and enable __Send information to Log Analytics__. For more information, see the [Collection and routing](#collection-and-routing) section. Data in Azure Monitor Logs is stored in tables, with each table having its own set of unique properties. Azure Event Grid stores data in the following tables: **AzureDiagnostics** and **AzureMetrics**.

See the following monitoring data reference articles for a detailed reference of the logs and metrics created by Azure Event Grid.

- [Monitor data reference for MQTT broker feature](monitor-mqtt-delivery-reference.md) 
- [Monitor data reference for pull delivery](monitor-pull-reference.md)
- [Monitor data reference for Azure Event Grid's push delivery using namespaces](monitor-namespace-push-reference.md)

### Sample Kusto queries

> [!IMPORTANT]
> When you select **Logs** on the left menu of the Azure Event Grid namespace page in the Azure portal, Log Analytics is opened with the query scope set to the current Azure Event Grid namespace. This means that log queries will only include data from that resource. If you want to run a query that includes data from other workspaces or data from other Azure services, select **Logs** from the **Azure Monitor** menu. See [Log query scope and time range in Azure Monitor Log Analytics](/azure/azure-monitor/logs/scope) for details.

Following are sample queries that you can use to help you monitor your Azure Event Grid namespaces: 

+ Disconnections report by reasons

    ```Kusto
    EGNMqttDisconnections
    | summarize count() by ResultSignature
    ```
+ Authentication errors report by session name

    ```Kusto
    EGNFailedMqttConnections
    | where ResultSignature == "AuthenticationError"
    | summarize count() by SessionName
    ```

## Use runtime logs  

Azure Event Grid allows you to monitor and audit data plane interactions of your client applications using runtime audit logs and application metrics logs. 

Using *Runtime audit logs* you can capture aggregated diagnostic information for all data plane access operations such as publishing or consuming events. 
*Application metrics logs* capture the aggregated data on certain runtime metrics (such as consumer lag and active connections) related to client applications are connected to Event Grid. 

### Enable runtime logs
You can enable diagnostic logs by selecting **Diagnostic settings** from the **Monitoring** section on the Event Grid namespace page in Azure portal. Select **Add diagnostic setting** as shown in the following screenshot.  

:::image type="content" source="./media/monitor-namespaces/add-diagnostic-settings.png" alt-text="Screenshot that shows the Diagnostic settings page for an Event Grid namespace.":::

On the **Diagnostic setting** page, you can enable log categories as needed.  

:::image type="content" source="./media/monitor-namespaces/configure-diagnostic-settings.png" alt-text="Screenshot showing the selection of RuntimeAuditLogs and ApplicationMetricsLogs.":::

Once runtime logs are enabled, Event Grid starts collecting and storing them according to the diagnostic setting configuration. 

### Publish and consume sample data 
To collect sample runtime audit logs in your Event Grid namespace, you can publish and consume sample data using client applications. See the following quickstarts:

- MQTT
    - [Quickstart: Publish and subscribe to MQTT messages on Event Grid Namespace with Azure portal](mqtt-publish-and-subscribe-portal.md)
    - [Tutorial: Route MQTT messages to Azure Event Hubs using namespace topics](mqtt-routing-to-event-hubs-portal-namespace-topics.md)
    - [Tutorial: Route MQTT messages to Azure Functions using custom topics](mqtt-routing-to-azure-functions-portal.md)
- Pull model
    - [Publish events to namespace topics using Java](publish-events-to-namespace-topics-java.md)
    - [Receive events using pull delivery with Java](receive-events-from-namespace-topics-java.md)
    - [Quickstart: Send and receive messages from a namespace topic using pull delivery (.NET)](event-grid-dotnet-get-started-pull-delivery.md)
- Push model
    - [Publish and deliver events using namespace topics using push delivery](publish-deliver-events-with-namespace-topics.md)

### Analyze runtime audit logs
You can analyze the collected runtime audit logs using the following sample query. 

+ Connections report by session names

    ```Kusto
    EGNSuccessfulMqttConnections
    | summarize count() by SessionName
    ```
+ Authentication errors report by session name

    ```Kusto
    EGNFailedMqttConnections
    | where ResultSignature == "AuthenticationError"
    | summarize count() by SessionName
    ```


## Alerts
You can access alerts for Azure Event Grid by selecting **Alerts** from the **Azure Monitor** section on the home page for your Event Grid namespace. See [Create, view, and manage metric alerts using Azure Monitor](/azure/azure-monitor/alerts/alerts-metric) for details on creating alerts.


## Next steps

See the following monitoring data reference articles for a detailed reference of the logs and metrics created by Azure Event Grid.

- [Monitor data reference for MQTT broker feature](monitor-mqtt-delivery-reference.md) 
- [Monitor data reference for pull delivery](monitor-pull-reference.md)
- [Monitor data reference for Azure Event Grid's push delivery using namespaces](monitor-namespace-push-reference.md)
