---
title: Use a Microsoft Sentinel playbook to stop potentially compromised users
description: Learn how to use Microsoft Sentinel playbooks and automation rules to automate a sample incident response and remediate security threats.
ms.topic: concept-article
author: batamig
ms.author: bagol
ms.date: 05/01/2024
appliesto:
    - Microsoft Sentinel in the Azure portal
    - Microsoft Sentinel in the Microsoft Defender portal
ms.collection: usx-security
#customerIntent: As a SOC engineer, I'd like to understand a sample scenario of how I might use a playbook and automation rule to help make my SOC team more efficient.
---

# Use a Microsoft Sentinel playbook to stop potentially compromised users

This article describes a sample scenario of how you can use a playbook and automation rule to automate incident response and remediate security threats. Automation rules help you triage incidents in Microsoft Sentinel, and are also used to run playbooks in response to incidents or alerts. For more information, see [Automation in Microsoft Sentinel: Security orchestration, automation, and response (SOAR)](automation.md).

The sample scenario described in this article describes how to use an automation rule and playbook to stop a potentially compromised user when an incident is created.

> [!NOTE]
> Because playbooks make use of Azure Logic Apps, additional charges may apply. Visit the [Azure Logic Apps](https://azure.microsoft.com/pricing/details/logic-apps/) pricing page for more details.

[!INCLUDE [unified-soc-preview](../includes/unified-soc-preview.md)]

## Prerequisites

The following roles are required to use Azure Logic Apps to create and run playbooks in Microsoft Sentinel.

[!INCLUDE [playbooks-roles](../includes/playbooks-roles.md)]

### Extra permissions required to run playbooks on incidents

[!INCLUDE [playbooks-service-account-permissions](../includes/playbooks-service-account-permissions.md)]

## Stop potentially compromised users

SOC teams want to make sure that potentially compromised users can't move around their network and steal information. We recommend that you create an automated, multifaceted response to incidents generated by rules that detect compromised users to handle such scenarios.

**Configure your automation rule and playbook to use the following flow**:

1. An incident is created for a potentially compromised user and an automation rule is triggered to call your playbook.

1. The playbook opens a ticket in your IT ticketing system, such as ServiceNow.

1. The playbook also sends a message to your security operations channel in Microsoft Teams or Slack to make sure your security analysts are aware of the incident.

1. The playbook also sends all the information in the incident in an email message to your senior network admin and security admin. The email message includes **Block** and **Ignore** user option buttons.

1. The playbook waits until a response is received from the admins, then continues with its next steps.

    - If the admins choose **Block**, the playbook sends a command to Microsoft Entra ID to disable the user, and one to the firewall to block the IP address.

    - If the admins choose **Ignore**, the playbook closes the incident in Microsoft Sentinel, and the ticket in ServiceNow.

The following screenshot shows the actions and conditions you would add in creating this sample playbook:

:::image type="content" source="../media/tutorial-respond-threats-playbook/logic-app.png" alt-text="Screenshot of a Logic App showing this playbook's actions and conditions." lightbox="../media/tutorial-respond-threats-playbook/logic-app.png":::

## Related content

- [Automate threat response with playbooks in Microsoft Sentinel](automate-responses-with-playbooks.md)
- [Create and manage Microsoft Sentinel playbooks](create-playbooks.md)
- [Use a Microsoft Sentinel playbook to stop potentially compromised users](tutorial-respond-threats-playbook.md)
