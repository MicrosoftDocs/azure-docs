---
title: Relate alerts to incidents in Microsoft Sentinel | Microsoft Docs
description: This article shows you how to relate alerts to your incidents in Microsoft Sentinel.
author: yelevin
ms.topic: how-to
ms.date: 05/12/2022
ms.author: yelevin
ms.custom: ignite-fall-2021
---

# Relate alerts to incidents in Microsoft Sentinel

[!INCLUDE [Banner for top of topics](./includes/banner.md)]

This article shows you how to relate alerts to your incidents in Microsoft Sentinel. This feature allows you to manually or automatically add alerts to, or remove them from, existing incidents as part of your investigation processes, refining the incident scope as the investigation unfolds. 

> [!IMPORTANT]
> Incident expansion is currently in PREVIEW. The [Azure Preview Supplemental Terms](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) include additional legal terms that apply to Azure features that are in beta, preview, or otherwise not yet released into general availability.
>

## Expand the scope and the power of incidents

One thing that this feature allows you to do is to include alerts from one data source in incidents generated by another data source. For example, you can add alerts from Microsoft Defender for Cloud, or from various third-party data sources, to incidents imported into Microsoft Sentinel from Microsoft 365 Defender.

This feature is built into the latest version of the Microsoft Sentinel API, which means that it's available to the Logic Apps connector for Microsoft Sentinel. So you can use playbooks to automatically add an alert to an incident if certain conditions are met.

You can also use this automation to create custom correlations, or to define custom criteria for grouping alerts into incidents when they're created.

## Add alerts using the investigation graph

The [investigation graph](investigate-cases.md) is a visual, intuitive tool that presents connections and patterns and enables your analysts to ask the right questions and follow leads. You can use it to add alerts to and remove them from your incidents, broadening or narrowing the scope of your investigation.

1. From the Microsoft Sentinel navigation menu, select **Incidents**.

    :::image type="content" source="media/investigate-cases/incident-severity.png" alt-text="Screenshot of incidents queue displayed in a grid." lightbox="media/investigate-cases/incident-severity.png":::

1. Select an incident to investigate. In the incident details panel, select the **Actions** button and choose **Investigate** from the pop-up menu. This will open the investigation graph.

    :::image type="content" source="media/relate-alerts-to-incidents/investigation-map.png" alt-text="Screenshot of incidents with alerts in investigation graph." lightbox="media/investigate-cases/incident-severity.png":::

1. Hover over any entity to reveal the list of **exploration queries** to its side. Select **Related alerts**.

    :::image type="content" source="media/relate-alerts-to-incidents/see-alert-options.png" alt-text="Screenshot of alert exploration queries in investigation graph.":::

    The related alerts will appear connected to the entity by dotted lines.

    :::image type="content" source="media/relate-alerts-to-incidents/related-alerts.png" alt-text="Screenshot of related alerts appearing in investigation graph.":::

1. Hover over one of the related alerts until a menu pops out to its side. Select **Add alert to incident (Preview)**.

    :::image type="content" source="media/relate-alerts-to-incidents/add-alert-to-incident.png" alt-text="Screenshot of adding an alert to an incident in the investigation graph.":::

1. The alert is added to the incident, and for all purposes is part of the incident, along with all its entities and details. You'll see two visual representations of this:

    - The line connecting it to the entity in the investigation graph has changed from dotted to solid, and connections to entities in the added alert have been added to the graph.

        :::image type="content" source="media/relate-alerts-to-incidents/alert-joined-to-incident.png" alt-text="Screenshot showing an alert added to an incident." lightbox="media/relate-alerts-to-incidents/alert-joined-to-incident.png":::

    - The alert now appears in this incident's timeline, together with the alerts that were already there.

        :::image type="content" source="media/relate-alerts-to-incidents/two-alerts.png" alt-text="Screenshot showing an alert added to an incident's timeline.":::

### Special situations

When adding an alert to an incident, depending on the circumstances, you might be asked to confirm your request or to choose between different options. The following are some examples of these situations, the choices you will be asked to make, and their implications.

- The alert you want to add already belongs to another incident.

    In this case you'll see a message that the alert is part of another incident or incidents, and asked if you want to proceed. Select **OK** to add the alert or **Cancel** to leave things as they were.

    Adding the alert to this incident *will not remove it* from any other incidents. Alerts can be related to more than one incident. If you want, you can remove the alert manually from the other incident(s) by following the link(s) in the message prompt above.

- The alert you want to add belongs to another incident, and it's the only alert in the other incident.

    This is different from the case above, since if the alert is alone in the other incident, tracking it in this incident could make the other incident irrelevant. So in this case, you'll see this dialog:

    :::image type="content" source="media/relate-alerts-to-incidents/keep-or-close-other-incident.png" alt-text="Screenshot asking whether to keep or close other incident.":::

    - **Keep other incident** preserves the alert in the other incident while also adding it to this one.

    - **Close other incident** adds the alert to this incident but removes it from the other incident, closing that incident in the process.

    - **Cancel** leaves the status quo. It keeps the alert in its original incident and does not add it to this one.

    Which of these options you choose depends on your particular needs; we don't recommend one choice over the other.

### Limitations

- Microsoft Sentinel imports both alerts and incidents from Microsoft 365 Defender. For the most part, you can treat these alerts and incidents like regular Microsoft Sentinel alerts and incidents. 

    However, you can only add Defender alerts to Defender incidents in the Defender portal, not in the Sentinel portal. If you try doing this in Microsoft Sentinel, you will get an error message. You can pivot to the incident in the Microsoft 365 Defender portal using the link in the Microsoft Sentinel incident.

- An incident can contain a maximum of 150 alerts. If you try to add an alert to an incident with 150 alerts in it, you will get an error message.

## Add/remove alerts using playbooks

Adding and removing alerts to incidents are also available as actions in Logic Apps, and therefore in Microsoft Sentinel playbooks. 

Here's an example of using the **Add alert to incident (Preview)** action in a playbook:

:::image type="content" source="media/relate-alerts-to-incidents/add-alert-using-playbook.png" alt-text="Screenshot of adding an alert to an incident using a playbook action.":::

## Add/remove alerts using the API

You're not limited to the portal to use this feature. It's also accessible through the Microsoft Sentinel API, through the [Incident relations](/rest/api/securityinsights/preview/incident-relations) operation group. It allows you to get, create, update, and delete relationships between alerts and incidents.

### Create a relationship

You add an alert to an incident by creating a relationship between them. Use the following endpoint to add an alert to an existing incident. After this request is made, the alert joins the incident and will be visible in the list of alerts in the incident in the portal.

```http
PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}/providers/Microsoft.SecurityInsights/Incidents/{incidentId}/relations/{incidentId}_{SystemAlertId}?api-version=2019-01-01-preview 

```

The request body looks like this:

```json
{ 
    "properties": { 
        "relatedResourceId": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}/providers/Microsoft.SecurityInsights/entities/{alertSystemId}" 
    } 
} 
```

### Delete a relationship

You remove an alert from an incident by deleting the relationship between them. Use the following endpoint to remove an alert from an existing incident. After this request is made, the alert will no longer be connected to or appear in the incident.

```http
DELETE https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}/providers/Microsoft.SecurityInsights/Incidents/{incidentId}/relations/{incidentId}_{SystemAlertId }?api-version=2019-01-01-preview

```

### List alert relationships

You can also list all the alerts that are related to a particular incident, with this endpoint and request:

```http
GET https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}/providers/Microsoft.SecurityInsights/Incidents/{incidentId}/relations?api-version=2019-01-01-preview

```

### Expected responses

Here are the possible response codes and results of these requests:

| Code    | Response   | Result of operation |
| ------- | ---------- | ------------------- |
| **204** | No content | Success             |
| **400** | BadRequest | Failed to create relation. Different relation type with name {relationName} already exists in incident {incidentIdentifier}. |
| **400** | BadRequest | Failed to create relation. Alert {systemAlertId} already exists in incident {incidentIdentifier}. |
| **400** | BadRequest | Failed to create relation. Related resource and incident should belong to the same workspace. |
| **400** | BadRequest | Failed to create relation. Microsoft 365 Defender alerts cannot be added to Microsoft 365 Defender incidents. |
| **400** | BadRequest | Failed to delete relation. Microsoft 365 Defender alerts cannot be removed from Microsoft 365 Defender incidents. |
| **409** | Conflict   | Failed to create relation. Relation with name {relationName} already exists in incident {incidentIdentifier} to different alert {relationAlertId}. |
| **404** | Not found  | Resource '{alertId}' does not exist. |
| **404** | Not found  | Incident doesnâ€™t exist. |

## Next steps
In this article, you learned how to add alerts to incidents and remove them using the Microsoft Sentinel portal and API. For more information, see:

- [Investigate incidents with Microsoft Sentinel](investigate-cases.md)
- [Incident relations group in the Microsoft Sentinel REST API](/rest/api/securityinsights/preview/incident-relations)
