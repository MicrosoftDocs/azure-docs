### YamlMime:FAQ
metadata:
  title: Azure confidential virtual machines FAQ
  description: Answers to frequently asked questions (FAQs) about confidential virtual machines in Azure Confidential Computing.
  author: michamcr
  ms.topic: faq
  ms.service: azure-virtual-machines
  ms.subservice: azure-confidential-computing
  ms.date: 7/01/2022
  ms.author: RunCai
title: Azure confidential virtual machines FAQ 
summary: |

  This article provides answers to some of the most common questions about [confidential virtual machines (VMs)](confidential-vm-overview.md).

sections:
  - name: General
    questions:
      - question: |
          What are confidential VMs?
        answer: |
          Confidential VMs are an IaaS solution for tenants with high security and confidentiality requirements. Confidential VMs offer:
            -	Encryption for "data in use”, including the processor state and the virtual machine’s memory. The keys are generated by the processor and never leave it.
            -	Host attestation helps you verify the full health and compliance of the server before data processing begins.
            -	Hardware Security Module (HSM) can be attached to guard the keys of confidential VM disks, which the tenant exclusively owns.
            -	New UEFI boot architecture supporting the guest OS for enhanced security settings and capabilities.
            -	A dedicated virtual Trusted Platform Module (TPM) certifies the health of the VM, provides hardened key management, and supports use cases such as BitLocker.
          
      - question: |
          Why should I use confidential VMs?
        answer: |
          Confidential VMs address customer concerns about moving sensitive workloads off-premise into the cloud. 
          Confidential VMs provide elevated protections for customer data from the underlying infrastructure and cloud operators. 
          Unlike other approaches and solutions, you don't have to adapt your existing workloads to fit the platform's technical needs.

      - question: |
          What is AMD SEV-SNP, and how does it relate to Azure confidential VMs?
        answer: |
          SEV-SNP stands for Secure Encrypted Virtualization-Secure Nested Paging. It's a Trusted Execution Environment (TEE) technology provided by AMD and offers multiple protections:
          For example, memory encryption, unique CPU keys, encryption for the processor register state, integrity protection, firmware rollback prevention, side channel hardening, and restrictions on interrupt and exceptions behavior. 
          Collectively, AMD SEV technologies harden guest protections to deny hypervisor and other host management code access to VM memory and state. 
          Confidential VMs leverages AMD SEV-SNP with Azure technologies such as full-disk encryption and [Azure Key Vault Managed HSM](/azure/key-vault/managed-hsm/overview). 
          You can encrypt data in use, in transit, and at rest with keys that you control. 
          With built-in [Azure Attestation](https://azure.microsoft.com/services/azure-attestation/) capabilities, you can independently establish trust in the security, health, and underlying infrastructure of your confidential VMs.
      
      - question: |
          What is Intel TDX technologies and how do they relate to Azure confidential VMs?
        answer: |
          Intel TDX stands for Intel Trust Domain Extensions (Intel TDX) It a Trusted Execution Environment (TEE) technology provided by Intel and offers multiple protections:
          Intel TDX uses hardware extensions for managing and encrypting memory and protects both the confidentiality and integrity of the CPU state.
          Additionally, Intel TDX helps to harden the virtualized environment by denying the hypervisor, other host management code, and administrators access to the VM memory and state.
          Confidential VMs combine Intel TDX with Azure technologies such as full-disk encryption and [Azure Key Vault Managed HSM](/azure/key-vault/managed-hsm/overview). 
          You can encrypt data in use, in transit, and at rest with keys that you control. 
     
      - question: |
          How do Azure confidential VMs offer better protection against threats originating from both within and outside Azure cloud infrastructure? 
        answer: |
          Azure VMs already offer industry leading security and protection against other tenants and malicious intruders. 
          Azure confidential VMs augment these protections by using hardware-based TEEs such as AMD SEV-SNP and Intel TDX to cryptographically isolate and protect your data confidentiality and integrity.
          No host admins, or host services (including the Azure hypervisor) can directly view or modify the memory or CPU state of your confidential VM. 
          Moreover, with full attestation capability, full OS disk encryption, and hardware-protected virtual Trusted Platform Modules, the persistent state is protected such that your private keys, and the contents of your memory are not exposed to the hosting environment unencrypted.

      - question: |
          Are the virtual disks attached to confidential VMs automatically protected?
        answer: |
          Currently OS disks for confidential VMs can be encrypted and secured. 
          For extra security, you can enable guest level encryption (such as BitLocker or dm-crypt) for all data drives.
        
      - question: |
          Does memory written to the Windows swap file (pagefile.sys) get protected by the TEE?
        answer: |
          Yes, but only if the pagefile.sys is located on the encrypted OS disk.
          On confidential VMs with a temp disk, the pagefile.sys file can be moved to the encrypted OS [Tips for moving pagefile.sys to the c:\ drive](/azure/virtual-machines/windows/change-drive-letter).

      - question: | 
          Can I generate a host memory dump from within my confidential VM?
        answer: | 
          No, this capability doesn't exist for confidential VMs.
                  
      - question: |
          How can I deploy Azure confidential VMs?
        answer: |
          Here are some ways you can deploy a confidential VM:
             - [Deploy from the Azure portal](quick-create-confidential-vm-portal.md)
             - [Deploy from the Azure Command-Line Interface (Azure CLI)](quick-create-confidential-vm-arm.md)
             - [Deploy using an ARM Template](quick-create-confidential-vm-arm.md)
             - [Deploy using VMSS and Confidential Disk Encryption](https://github.com/Azure/azure-quickstart-templates/tree/master/demos/vmss-cvm-fde#readme)

      - question: |
          Can I perform attestation for my AMD-based confidential VMs?
        answer: |
          Azure confidential VMs on AMD SEV-SNP undergo attestation as part of their boot phase. This process is opaque to the user and takes place in the cloud operating system with the Microsoft Azure Attestation and Azure Key Vault services.
          Confidential VMs also allow users to perform independent attestation for their confidential VMs. 
          This attestation happens using new tooling called [Azure confidential VM Guest Attestation](https://aka.ms/CVMattestation). Guest attestation allows customers to attest that their confidential VMs are running on AMD processors with SEV-SNP enabled.
      
      - question: |
          Can I perform attestation for my Intel-based confidential VMs?
        answer: |
          Azure confidential VMs using Intel TDX can be attested transparently as part of the boot flow to ensure the platform is compliant and up-to-date. The process is opaque to the user and takes place using Microsoft Azure Attestation and Azure Key Vault.
          If you would like to go further to perform checks post-boot, in-guest platform attestation is available. This allows you to verify that your VM is running on genuine Intel TDX. To access the feature, visit our [preview branch](https://github.com/Azure/confidential-computing-cvm-guest-attestation/tree/tdx-preview).
          Additionally, we support [Intel® Trust Authority](https://www.intel.com/content/www/us/en/security/trust-authority.html) for enterprises seeking operator independent attestation.
          Support for full in-guest [attestation](guest-attestation-confidential-vms.md), similar to AMD SEV-SNP is coming soon. This allows organizations to go deeper, and validate further aspects, even down to the guest application layer. 

      - question: |
          Do all OS images work with confidential VMs?
        answer: |
          To run on a confidential VM, OS images must meet certain security and compatibility requirements. 
          This allows confidential VMs to be securely mounted, attested to, and isolated from the underlying cloud infrastructure. 
          In the future, we plan to provide guidance on how to take a custom Linux build and apply a set of open-source patches to qualify it as a confidential VM image.
          
      - question: |
          Can I customize one of the available confidential VM images?
        answer: |          
          Yes. You can use [Azure Compute Gallery](/azure/virtual-machines/shared-image-galleries) to modify a confidential VM image, such as by installing applications. 
          Then, you can deploy confidential VMs based on your modified image.

      - question: |
          Do I have to use the full-disk encryption scheme? Can I use a standard scheme instead?
        answer: |
          The optional full-disk encryption scheme is Azure's most secure and meets the [Confidential Computing principles](https://azure.microsoft.com/blog/azure-confidential-computing/). 
          However, you can also use other [disk encryption schemes](/azure/virtual-machines/disk-encryption-overview) along with or instead of full-disk encryption.
          If you use multiple disk encryption schemes, double encryption might negatively affect performance.

      - question: |
          Since Azure confidential VMs support virtual TPM, can I seal secrets/keys to my confidential VM virtual TPM?
        answer: | 
          Each Azure confidential VM has its own virtual TPM, where customers can seal their secrets/keys. It's recommended for customers to verify vTPM status (via TPM.msc for Windows VMs).
          If status isn't ready for use, we recommend that you reboot your VMs before sealing secrets/keys to vTPM.
     
      - question: |
          Can I enable or disable the new full-disk encryption scheme after VM creation?
        answer: |
          No. After you've created a confidential VM, you can't deactivate or reactivate full-disk encryption. Create a new confidential VM instead.

      - question: |
          Is it possible to switch between Platform-managed keys and Customer-managed keys after a VM has been created?
        answer: |
          No, the choice of key management (Platform-managed or Customer-managed) is only available during VM creation and cannot be changed afterward.          

      - question: |
          Can I use a Customer-managed key if I don't enable full-disk encryption for the OS disk?
        answer: |
          No, if a Confidential VM is created without full-disk encryption of the OS disk, a Customer-managed key cannot be used. In this case, the VMGS disk, which is always encrypted, will be encrypted using a Platform-managed key (PMK). 
      
      - question: |
          Can I control more aspects of the Trusted Computing Base to enforce operator independent key management, attestation, and disk encryption?
        answer: |
          Developers seeking further "separation of duties" for TCB services from the cloud service provider should use security type "NonPersistedTPM". 
          - This experience is only available as part of the Intel TDX public preview. Organizations that use it, or provide services with it are in control of the TCB and the responsibilities that come along with it. 
          - This experience bypasses the native Azure services, allowing you to bring your own disk encryption, key management, and attestation solution. 
          - Each VM still has a vTPM, which should be used to retrieve hardware evidence, however the vTPM state isn't persisted through reboots, meaning this solution is excellent for ephemeral workloads and organizations wanting decoupling from the cloud service provider.

      - question: |
          Can I convert a non-confidential VM into a confidential VM?
        answer: |
          No. For security reasons, you must create a confidential VM as such from the start.

      - question: |
          Can I convert a DCasv5/ECasv5 CVM into a DCesv5/ECesv5 CVM or a DCesv5/ECesv5 CVM into a DCasv5/ECasv5 CVM?
        answer: |
          Yes, converting from one confidential VM to another confidential VM is allowed on both DCasv5/ECasv5 and DCesv5/ECesv5 in the regions that they share.
          If you're using a Windows image, make sure you have all the most recent updates.
          If you're using an Ubuntu Linux image, make sure you're using the Ubuntu 22.04 LTS confidential image with the minimum kernel version `6.2.0-1011-azure`.

      - question: |
          Why can't I find DCasv5/ECasv5 or DCesv5/ECesv5 VMs in the Azure portal size selector?
        answer: |
          Make sure you've selected an [available region for confidential VMs](https://azure.microsoft.com/global-infrastructure/services/?products=virtual-machines). 
          Also make sure to select **clear all filters** in the size selector. 
          
      - question: |
          Can I enable Azure Accelerated Networking on confidential VMs?
        answer: |
          No. Confidential VMs don't support Accelerated Networking. You can't enable Accelerated Networking for any confidential VM deployment, or any Azure Kubernetes Service cluster deployment that runs on Confidential Computing.

      - question: |
          What does this error mean? "Operation couldn't be completed as it results in exceeding approved standard DCasV5/ECasv5 or DCesv5/ECesv5 Family Cores Quota"
        answer: |
          You might receive the error **Operation could not be completed as it results in exceeding approved standard DCasv5/ECasv5 Family Cores Quota**.
          This Azure Resource Manager template (ARM template) error means the deployment failed because of a lack of Azure compute cores. 
          Azure free trial subscriptions don't have a large enough core quota for confidential VMs. [Create a support request to increase your quota](/azure/azure-portal/supportability/per-vm-quota-requests).  
          
      - question: |
          What's the difference between DCasv5-series/DCesv5-series and ECasv5-series/ECesv5-series VMs?
        answer: |
          ECasv5-series and ECesv5-series are memory-optimized VM sizes, which offer a higher memory-to-CPU ratio. These sizes are especially well-suited for relational database servers, medium to large caches, and in-memory analytics. 
          
      - question: |
          Are confidential VMs available globally?
        answer: |
          No. At this time, these VMs are only available in select regions. For a current list of available regions, see [VM products by region](https://azure.microsoft.com/global-infrastructure/services/?products=virtual-machines). 

      - question: |
          What happens if I need Microsoft to help me service or access data on my confidential VM?
        answer: |
          Azure doesn't have operating procedures for granting confidential VM access to its employees, even if a customer authorizes the access. As a result, various recovery and support scenarios aren't available for confidential VMs.

      - question: |
          Do confidential VMs support virtualization, such as Azure VMware Solution?
        answer: |
          No, confidential VMs don't currently support nested virtualization, such as the ability to run a hypervisor inside a VM. 

      - question: |
          Is there an extra cost for using confidential VMs?
        answer: |
          Billing for confidential VMs depends on your usage and storage, and the size and region of the VM. 
          Confidential VMs use a small encrypted virtual machine guest state (VMGS) disk of several megabytes. VMGS encapsulates the VM security state of components such the vTPM and UEFI bootloader. This disk might result in a monthly storage fee.
          Also, if you choose to enable the optional full-disk encryption, encrypted OS disks incur higher costs.
          For more information on storage fees, see the [pricing guide for managed disks](https://azure.microsoft.com/pricing/details/managed-disks/).
          Lastly, for some high security and privacy settings, you might choose to create linked resources, such as a [Managed HSM Pool](/azure/key-vault/managed-hsm/overview). 
          Azure bills such resources separately from the confidential VM costs.

      - question: |
          What can I do if the time on my DCesv5/ECesv5-series VM differs from UTC?
        answer: |
          Rarely some DCesv5/ECesv5-series VMs may experience a small time difference from UTC. A long term fix is available for this soon. In the meantime here are the workarounds for Windows and Ubuntu Linux VMs:

            ``` Windows
            sc config vmictimesync start=disabled
            sc stop vmictimesync
            ```
          For Ubuntu Linux images, run the following script:
          
            ``` Ubuntu Linux
            #!/bin/bash

            # Backup the original chrony.conf file
            cp /etc/chrony/chrony.conf /etc/chrony/chrony.conf.bak

            # check chronyd.service status
            status=$(systemctl is-active chronyd.service)

            # check chronyd.service status is "active" or not
            if [ "$status" == "active" ]; then
              echo "chronyd.service is active."
            else
              echo "chronyd.service is not active. Exiting script."
              exit 1
            fi

            # Comment out the line with 'refclock PHC /dev/ptp_hyperv'
            sed -i '/refclock PHC \/dev\/ptp_hyperv/ s/^/#/' /etc/chrony/chrony.conf

            # Uncomment the lines with 'pool ntp.ubuntu.com' and other pool entries
            sed -i '/#pool ntp.ubuntu.com/ s/^#//' /etc/chrony/chrony.conf
            sed -i '/#pool 0.ubuntu.pool.ntp.org/ s/^#//' /etc/chrony/chrony.conf
            sed -i '/#pool 1.ubuntu.pool.ntp.org/ s/^#//' /etc/chrony/chrony.conf
            sed -i '/#pool 2.ubuntu.pool.ntp.org/ s/^#//' /etc/chrony/chrony.conf

            echo "Changes applied to /etc/chrony/chrony.conf. Backup created at /etc/chrony/chrony.conf.bak."

            echo "Restart chronyd service"
            systemctl restart chronyd.service


            echo "Check chronyd status"
            systemctl status chronyd.service
            ```

          
