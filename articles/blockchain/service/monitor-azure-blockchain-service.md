---
title: Monitoring Azure Blockchain Service (ABS)
description: Monitoring Azure Blockchain Service through Azure Monitor
ms.date: 01/08/2020
ms.topic: article
ms.reviewer: v-umha
---

# Monitor Azure Blockchain Service through Azure Monitor  

As customers run production grade blockchain scenarios on Azure Blockchain Service (ABS), it becomes critical to monitor the resources for availability, performance, and operations. This article describes the monitoring data generated by Azure Blockchain Service and how one can use the various features and integrations of Azure Monitor to analyze and alert on, to manage production grade environments.  

## What is Azure Monitor?

Azure Blockchain Service creates monitoring data using Azure Monitor, which is a full stack monitoring service in Azure that provides a complete set of features to monitor your Azure resources. For more information about Azure Monitor, see [Monitoring Azure resources with Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/insights/monitor-azure-resource).
 

The following sections build on this article by describing the specific data gathered from Azure Blockchain Service and providing examples for configuring data collection and analyzing this data with Azure tools.

## Monitor data collected from Azure Blockchain Service  

Azure Blockchain Service collects the same kind of monitoring data as other Azure resources, which are described in [Monitoring data](https://docs.microsoft.com/azure/azure-monitor/insights/monitor-azure-resource#monitoring-data) from Azure resources. See [Monitor Azure Blockchain Service data reference](#monitor-azure-blockchain-service-data-reference) for a detailed reference of the logs and metrics created by Azure Blockchain Service.

The overview page in the Azure portal for each Azure Blockchain Service member resource includes a brief view of the transactions including the requests handled and processed blocks. Some of this data is collected automatically and available for analysis once you create the Azure Blockchain Service member resource, while you can enable additional data collection with additional configuration.

## Diagnostic settings  

Platform metrics and the Activity log are collected automatically, but you must create a diagnostic setting to collect resource logs or forward them outside of Azure Monitor. See [Create diagnostic setting to collect platform logs and metrics in Azure](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostic-settings) for the detailed process for creating a diagnostic setting using the Azure portal, CLI, or PowerShell.

When you create a diagnostic setting, you specify which categories of logs to collect. The categories for Azure Blockchain Service are listed below.

**Blockchain proxy logs** – Select the category if you want to monitor the NGNIX proxy logs. All the customer transaction details are available for audit and debug purpose.  

**Blockchain application logs** – Select the category to get logs of the blockchain application hosted by the managed service. For example, for an ABS-Quorum member, these logs would be the logs from Quorum itself.  

**Metric requests**: Select the option to collect metric data from Azure Cosmos DB to the destinations in the diagnostic setting, which is collected automatically in Azure Metrics. Collect metric data with resource logs to analyze both kinds of data together and to send metric data outside of Azure Monitor.

## Analyze metric data  

You can analyze metrics for Azure Blockchain Service with Metrics explorer, navigate to Metrics tab under Monitoring section in ABS resource blade. See [Getting started with Azure Metrics Explorer](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-getting-started) for details on using the tool. The complete metrics for Azure Blockchain Service are in the namespace Azure Blockchain Service standard metrics.

You can use **node** dimension when adding a filter or splitting the metrics, which basically provides metric values per transaction nodes and validator nodes of the ABS member.

## Analyze log data

Here are some queries that you can enter in the Log search bar to help you monitor your Azure Blockchain Service members. These queries work with the [new language](https://docs.microsoft.com/azure/azure-monitor/log-query/log-query-overview).

To query the error conditions in the Blockchain application logs, use the below query:

```
BlockchainApplicationLog | where BlockchainMessage contains "ERROR" or BlockchainMessage contains "fatal"

```

To query the error conditions in the Blockchain proxy logs, use the below query  


```
BlockchainProxyLog
| filter Code != 200
| limit 500

```
You can use the time filters available in Azure logs to filter the query for a specific time range.

## Monitor Azure Blockchain Service data reference  

This article provides a reference of log and metric data collected to analyze the performance and availability of Azure Blockchain Service.  

### Resource logs

All resource logs share a top-level common schema with few unique properties specific to the blockchain service. You can refer to the article [Top-level resource logs schema](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostic-logs-schema#top-level-resource-logs-schema), details of the Azure Blockchain Service specific properties are covered below  

The following table lists the properties for Azure Blockchain proxy logs when they're collected in Azure Monitor Logs or Azure Storage.  


| Property name  | Description |
|:---|:---|
| time | The date and time (UTC) when the operation occurred. |
| resourceID  | The Azure Blockchain Service resource for which logs are enabled.  |
| category  |For Azure Blockchain Service, the values possible are **Proxylogs** and **Applicationlogs**. |
| operationName  | The name of the operation represented by this event.   |
| Log level  | By default, Azure Blockchain Service enables **Informational** log level.   |
| NodeLocation  | Azure region where the blockchain member is deployed.  |
| BlockchainNodeName  | The name of the node of the Azure Blockchain Service member on which operation is performed.   |
| EthMethod  | The method, which is called by the underlying blockchain protocol, in Quorum, it could be eth_sendTransactions, eth_getBlockByNumber etc.  |
| Agent  | The user agent that is acting on behalf of a user, such as web browser  Mozilla, Edge etc. Examples of the values are: "Mozilla/5.0 (Linux x64) node.js/8.16.0 v8/6.2.414.77"  |
| Code   | HTTP error codes. Usually 4XX and 5XX are error conditions.  |
| NodeHost  | The DNS name of the node.   |
| RequestMethodName | HTTP method called, the possible values here are PUT for create member, GET for getting details of existing member, DELETE for delete member, PATCH for updating member.   |
| BlockchainMemberName  | Azure Blockchain Service member name provided by the user.  |
| Consortium | Name of the consortium as provided by the user.   |
| Remote  | The IP of the client where the request is coming.  |
| RequestSize  | Size of the request made in bytes.  |
| RequestTime  | The duration of the request in milliseconds.|




The following table lists the properties for Azure Blockchain application logs.


| Property name  | Description |
|:---|:---|
| time | The date and time (UTC) when the operation occurred. |
| resourceID  | The Azure Blockchain Service resource for which logs are enabled.|
| category  |For Azure Blockchain Service, the value possible are **Proxylogs** and **Applicationlogs**.  |
| operationName  | The name of the operation represented by this event.   |
| Log level  | By default, Azure Blockchain Service enables **Informational** log level.   |
| NodeLocation  | Azure region where the blockchain member is deployed.  |
| BlockchainNodeName  | The name of the node of the Azure Blockchain Service member on which operation is performed.   |
| BlockchainMessage    | This field will contain the Blockchain application log that is the data plain logs. For ABS-Quorum, this would have Quorum logs. It has information about what type of log entry is it that is informational, error, warning and a string that gives more information on the action executed.   |
| TenantID    | The region-specific tenant of the Azure Blockchain Service. The format of this field is https://westlake-rp-prod.<region>.cloudapp.azure.com where region specifies the Azure region of the member deployed.       |
| SourceSystem   | The system populates the logs, in this case it is **Azure**.    |



### Metrics

The following tables lists the platform metrics collected for Azure Blockchain Service. All metrics are stored in the namespace **Azure Blockchain Service** standard metrics.

For a list of all Azure Monitor supported metrics (including Azure Blockchain Service), see [Azure Monitor supported metrics](https://docs.microsoft.com/azure/azure-monitor/platform/metrics-supported).

### Blockchain metrics

The following table specifies the list of Blockchain metrics that are collected for the Azure Blockchain Service member resource.


| Metric name | Unit  |  Aggregation type| Description   |
|---|---|---|---|
| Pending Transactions   | Count  |  Average | The number of transactions that are waiting to be mined.   |
| Processed Blocks   | Count  | Sum  |  The number of blocks processed in each time interval. Currently the block size is 5 seconds, hence in a minute each node will process 12 blocks and 60 blocks in 5 minutes.   |
|Processed Transactions    | Count  | Sum  | The number of transactions processed in a block.    |
|Queued Transactions    |  Count | Average  | The number of transactions that cannot be immediately mined. It can be because they arrived out of order and the future one is waiting for previous transaction to arrive. Or, it can be two transactions have the same number only used once (nonce) and the same gas value, hence the second one cannot be mined.   |

### Connection metrics  

The following table lists the different connection metrics that are collected for the Azure Blockchain Service member resource. These are NGINX proxy metrics.


| Metric name | Unit  |  Aggregation type| Description |
|---|---|---|---|
| Accepted Connections   | Count  |  Sum | The total number of accepted client connections.   |
| Active Connections  | Count  | Average  |  The current number of active client connections including Waiting connections.    |
|Handled Connections    | Count  | Sum  | The total number of handled connections. Generally, the parameter value is the same as accepted connections unless some resource limits have been reached.     |
|Handled Requests     |  Count | Sum  | The total number of client requests.  |


### Performance Metrics

The following table lists the performance metrics that are collected for each of the nodes of the Azure Blockchain member resource.  


| Metric name | Unit  |  Aggregation type| Description   |
|---|---|---|---|
| CPU Usage percentage   | Percentage  |  Max | The percentage of the CPU usage.     |
| IO Read Bytes   | Kilobytes   | Sum  |  The sum of IO read bytes across all nodes of the blockchain member resource.      |
|IO Write Bytes     | Kilobytes   | Sum  | The sum of IO writes bytes across all nodes of the blockchain member resource.     |
|Memory Limit       |  Gigabytes   | Average    | Maximum memory available for the blockchain process per node. |
|Memory Usage     | Gigabytes  |  Average | The amount of memory used averaged across all nodes.  |
| Memory Usage Percentage     | Percentage   | Average  |  The percentage of the memory used averaged across all nodes.       |
|Storage Usage      | Gigabytes   | Average  | The GB of storage used averaged across all nodes.       |


## Next Steps

Learn more about [Blockchain Data Manager](https://docs.microsoft.com/azure/blockchain/service/data-manager) to capture and transform blockchain data to Azure Event Grid.
