---
title: Delete image resources in Azure Container Registry
description: Details on how to effectively managed registry size by deleting container image data.
services: container-registry
author: mmacy
manager: jeconnoc

ms.service: container-registry
ms.topic: article
ms.date: 07/14/2018
ms.author: marsma
---

# Delete container images in Azure Container Registry

Periodic deletion of stale or unused container image data should be included as part of your regular container registry maintenance routine. Because you can initiate deletion on several different resource types (like repositories, images, and manifest digests), it's important to understand how each delete operation affects the space usage of your registry. This article starts by introducing the components of a Docker registry and its images, explains how to delete those components, and how deleting each affects the size of your registry.

## Components of a registry

Because Docker container images share layer data and include several components by which delete operations can be made, managing registry size requires some knowledge of registry layout and how container images are constructed.

### Registry

A container registry is a service that stores and distributes container images. For example, Docker Hub is a public Docker container registry, while Azure Container Registry provides private container registries in Azure.

### Repository

Within each registry are image *repositories*, collections of container images with the same name, but different tags. The name of an image is defined by the repository name, followed by a tag:

`repository:tag`

For example, these three images reside within the `acr-helloworld` repository, each with a different tag:

```
acr-helloworld:latest
acr-helloworld:v1
acr-helloworld:v2
```

## Components of an image

A container image consists of several components, many of which support deletion. Understanding how these components relate to one another can help you determine what to delete, and in which situations they should be deleted.

### Tag

An image's *tag* specifies its version. Images within a repository can also be "untagged." That is, you can delete a tag, while leaving the image data (its layers) within the registry.

You can push and pull an image by specifying its `repository:tag` in the push or pull operation.

### Layer

Images are made up of one or more *layers*, each of which corresponds to a line in the Dockerfile that defines the image. Images within a repository can share layers, reducing the storage required for those images sharing layers. Network traffic is also minimized, since layers already existing in the local filesystem do not need to be pulled again; only new or modified layers are pulled from the registry.

### Manifest

Within a container registry, an image *manifest* provides the identification for the image and specifies the layers that make up an image within the registry.

### Manifest digest

Manifests are identified by a unique SHA256 hash, or *digest*. A unique digest is generated by the registry each time you push an image to it. This is what allows you repeatedly push an identically tagged image to a registry. For example, you can repeatedly push `myimage:latest` to your registry without error because each image is identified by its unique digest.

This mechanism uniquely identifies the image even if its layer data is identical to that of another image in the registry, or multiple images with the same tag have been pushed. In addition, you can pull an image from a registry by specifying its digest in the pull operation. Some systems may be configured to pull by digest because it guarantees the image version being pulled, even if an identically tagged image is subsequently pushed to the registry.

> [!IMPORTANT]
> If you repeatedly push identically tagged images, you create orphaned images--images which are untagged, but not deleted. This can cause "hidden" storage usage because the untagged images are not displayed when listing images in the Azure CLI or Azure portal. However, their layers still exist and consume space in your registry. For information about deleting orphaned image data, see [Delete by manifest digest](#delete-by-manifest-digest).

## Delete image data

### Delete repository

Deleting a repository deletes all of the images in the repository, including all tags, layers, and manifests. When you delete a repository, you recover the storage space used by the images that were in that repository.

The following Azure CLI command deletes the `acr-helloworld` repository and all tags and manifests within the repository. If layers referenced by the deleted manifests are not referenced by any other images in the registry, their layer data is also deleted.

```azurecli
 az acr repository delete --name myregistry --repository acr-helloworld
```

### Delete by tag

You can delete individual images from a repository by specifying the repository name and tag in the delete operation. When you delete by tag, you recover the storage space used by the image if its layers are not shared with any other images in the registry.

```azurecli
az acr repository delete --name myregistry --image acr-helloworld:latest
```

### Delete by manifest digest

A manifest digest can be associated with one, multiple, or no tags. When you delete by digest, all tags referenced by the manifest are deleted, as is layer data for any unique layers referenced by the manifest.

To delete by digest, first display the digests for the repository's images you wish to delete:

```azurecli
az acr repository show-manifests --name myregistry --repository myrepository
```

For example, listing the manifest digests for the `acr-helloworld` repository:

```console
$ az acr repository show-manifests --name myregistry --repository myrepository
[
  {
    "digest": "sha256:37c989e19592d5a63a64f870a62da16c893b1d35832262ba576d29a0e52ceada",
    "tags": [
      "v3"
    ],
    "timestamp": "2018-05-03T18:27:53.5818911Z"
  },
  {
    "digest": "sha256:565dba8ce20ca1a311c2d9485089d7ddc935dd50140510050345a1b0ea4ffa6e",
    "tags": [
      "v4",
      "v5"
    ],
    "timestamp": "2018-06-14T14:44:18.7662996Z"
  },
  {
    "digest": "sha256:a86151c1efeb43ad7ca7de020ffcf1973aca0b5cef832c498b96e687b5f2a028",
    "tags": [
      "v2"
    ],
    "timestamp": "2018-02-24T00:11:11.0507147Z"
  }
]
```

Next, specify the digest you wish to delete to the [az acr repository delete]() command. For example, deleting the first manifest shown in the preceding example:

```azurecli
$ az acr repository delete --name myregistry --image acr-helloworld@sha256:37c989e19592d5a63a64f870a62da16c893b1d35832262ba576d29a0e52ceada
This operation will delete the manifest 'sha256:37c989e19592d5a63a64f870a62da16c893b1d35832262ba576d29a0e52ceada' and all the following images: 'aci-helloworld:v3'.
Are you sure you want to continue? (y/n): y
```

**Delete orphaned images**

Because the push of an already existing tag **untags** the previously pushed image, the previously push image's manifest--and its layer data--remains. However... TODO

## Next steps

For more information about how images are stored in Azure Container Registry see [Container image storage in Azure Container Registry](container-registry-storage.md).

<!-- IMAGES -->

<!-- LINKS - External -->
[portal]: https://portal.azure.com

<!-- LINKS - Internal -->
